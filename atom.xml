<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ï¼ƒ TODOï¼š</title>
  <subtitle>å­¦æœ‰æ‰€è·ï¼Œä¹ æœ‰æ‰€å¾—</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-02-13T09:04:28.339Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>ifelseboyxx</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Objective-C ä¸­å»¶è¿Ÿæ‰§è¡Œå’Œå–æ¶ˆ</title>
    <link href="http://yoursite.com/2018/01/08/objc_delay/"/>
    <id>http://yoursite.com/2018/01/08/objc_delay/</id>
    <published>2018-01-08T09:00:00.000Z</published>
    <updated>2018-02-13T09:04:28.339Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ Objective-C ä¸­å»¶è¿Ÿæ‰§è¡Œè¿˜æ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œé€šå¸¸æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼å¯ä¾›é€‰æ‹©ï¼š</p>
<h2 id="performSelectorï¼š"><a href="#performSelectorï¼š" class="headerlink" title="performSelectorï¼š"></a>performSelectorï¼š</h2><p>æƒ³è¦å»¶è¿Ÿè°ƒç”¨æŸä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(delay) withObject:<span class="literal">nil</span> afterDelay:<span class="number">3.0</span>];</div></pre></td></tr></table></figure>
<p>å–æ¶ˆå»¶è¿Ÿçš„æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="built_in">NSObject</span> cancelPreviousPerformRequestsWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(delay) object:<span class="literal">nil</span>];</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œéœ€è¦æ³¨æ„å‚æ•°éœ€è¦ä¿æŒä¸€è‡´ï¼Œå¦åˆ™å–æ¶ˆå¤±è´¥ã€‚</p>
</blockquote>
<h2 id="NSTimer"><a href="#NSTimer" class="headerlink" title="NSTimer"></a>NSTimer</h2><p>æƒ³è¦å»¶è¿Ÿè°ƒç”¨æŸä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">2.0</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(delay) userInfo:<span class="literal">nil</span> repeats:<span class="literal">NO</span>];</div></pre></td></tr></table></figure>
<p>å–æ¶ˆå»¶è¿Ÿçš„æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span>.timer invalidate];</div></pre></td></tr></table></figure>
<h2 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><code>dispatch_after</code> æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•ï¼Œä½†æ˜¯ Objective-C ä¸­å¹¶æ²¡æœ‰æä¾›å–æ¶ˆæ‰§è¡Œçš„ç›¸å…³ APIã€‚æˆ‘ä»¬åªèƒ½è‡ªå·±å®ç°è¿™ä¸ªå–æ¶ˆçš„é€»è¾‘ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^Task)(<span class="built_in">BOOL</span> cancel);</div><div class="line">Task delay(<span class="built_in">NSTimeInterval</span> time,<span class="keyword">void</span> (^task)()) &#123;</div><div class="line">    __block <span class="keyword">void</span> (^closure)() = task;</div><div class="line">    __block Task result;</div><div class="line">    Task delayedClosure = ^(<span class="built_in">BOOL</span> cancel)&#123;</div><div class="line">        <span class="keyword">if</span> (closure) &#123;</div><div class="line">            <span class="keyword">void</span> (^internalClosure)() = closure;</div><div class="line">            <span class="keyword">if</span> (!cancel) &#123;</div><div class="line">                <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), internalClosure);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        closure = <span class="literal">nil</span>;</div><div class="line">        result = <span class="literal">nil</span>;</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    result = delayedClosure;</div><div class="line">    </div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(time * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        <span class="keyword">if</span> (delayedClosure) &#123;</div><div class="line">            delayedClosure(<span class="literal">NO</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨çš„è¯å¯ä»¥è¿™æ ·ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">delay(<span class="number">60</span>, ^&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³è¦å»¶è¿Ÿï¼Œå¯ä»¥å…ˆå£°æ˜æˆæˆå‘˜å˜é‡å¹¶èµ‹å€¼ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) Task task;</div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.task = delay(<span class="number">60</span>, ^&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>æœ€ååœ¨éœ€è¦çš„åœ°æ–¹å–æ¶ˆå°±è¡Œï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.task(<span class="literal">YES</span>);</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ç§å†™æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ ¹æ®ä¼ å…¥çš„ <code>Bool</code> å€¼ï¼Œæ¥æ§åˆ¶ <code>dispatch_after</code> å›è°ƒ <code>block</code> ä¸­çš„æ–¹æ³•æ˜¯å¦éœ€è¦æ‰§è¡Œã€‚çœ‹èµ·æ¥æ˜¯å–æ¶ˆäº†ï¼Œä½†å®é™…ä¸Šè¿˜æ˜¯è¢« GCD æ”¾åˆ° RunLoop é‡Œå»å ç”¨ä¸»çº¿ç¨‹èµ„æºäº†ã€‚</p>
</blockquote>
<h2 id="dispatch-source"><a href="#dispatch-source" class="headerlink" title="dispatch_source"></a>dispatch_source</h2><p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨ <code>dispatch_source</code> ä¸­çš„å®šæ—¶å™¨ï¼Œæ¥å®ç°å»¶æ—¶ï¼å–æ¶ˆæ“ä½œï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) dispatch_source_t timer;</div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// é˜Ÿåˆ—</span></div><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</div><div class="line"><span class="comment">// åˆ›å»º dispatch_source</span></div><div class="line">dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="number">0</span>, <span class="number">0</span>, queue);</div><div class="line"><span class="comment">// å£°æ˜æˆå‘˜å˜é‡</span></div><div class="line"><span class="keyword">self</span>.timer = timer;</div><div class="line"><span class="comment">// è®¾ç½®ä¸¤ç§’åè§¦å‘</span></div><div class="line">dispatch_time_t startTime = dispatch_time(DISPATCH_TIME_NOW, <span class="number">3.0</span> * <span class="built_in">NSEC_PER_SEC</span>);</div><div class="line"><span class="comment">// è®¾ç½®ä¸‹æ¬¡è§¦å‘äº‹ä»¶ä¸º DISPATCH_TIME_FOREVER</span></div><div class="line">dispatch_time_t nextTime = DISPATCH_TIME_FOREVER;</div><div class="line"><span class="comment">// è®¾ç½®ç²¾ç¡®åº¦</span></div><div class="line">dispatch_time_t leeway = <span class="number">0.1</span> * <span class="built_in">NSEC_PER_SEC</span>;</div><div class="line"><span class="comment">// é…ç½®æ—¶é—´</span></div><div class="line">dispatch_source_set_timer(timer, startTime, nextTime, leeway);</div><div class="line"><span class="comment">// å›è°ƒ</span></div><div class="line">dispatch_source_set_event_handler(timer, ^&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;);</div><div class="line"><span class="comment">// æ¿€æ´»</span></div><div class="line">dispatch_resume(timer);</div></pre></td></tr></table></figure>
<p>éœ€è¦å–æ¶ˆçš„è¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dispatch_source_cancel(<span class="keyword">self</span>.timer);</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ Objective-C ä¸­å»¶è¿Ÿæ‰§è¡Œè¿˜æ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œé€šå¸¸æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼å¯ä¾›é€‰æ‹©ï¼š&lt;/p&gt;
&lt;h2 id=&quot;performSelectorï¼š&quot;&gt;&lt;a href=&quot;#performSelectorï¼š&quot; class=&quot;headerlink&quot; title=&quot;performSel
    
    </summary>
    
    
      <category term="ObjC" scheme="http://yoursite.com/tags/ObjC/"/>
    
  </entry>
  
  <entry>
    <title>RxSwift å…¥å‘-éœ€è¦çŸ¥é“çš„åŸºç¡€æ¦‚å¿µ</title>
    <link href="http://yoursite.com/2018/01/02/RxSwift_1/"/>
    <id>http://yoursite.com/2018/01/02/RxSwift_1/</id>
    <published>2018-01-02T13:55:23.000Z</published>
    <updated>2018-02-13T09:03:20.213Z</updated>
    
    <content type="html"><![CDATA[<p>ç¯å¢ƒï¼š</p>
<blockquote>
<p>Xcode 9.1<br>Swift 4.0<br>RxSwift 4.0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </p>
</blockquote>
<p>ç›®å½•ï¼š</p>
<blockquote>
<p><a href="#1.0">ä»€ä¹ˆæ˜¯ RxSwift</a><br><a href="#1.1">å“åº”å¼ç¼–ç¨‹</a><br><a href="#1.2">RxSwift æ ¸å¿ƒæ¦‚å¿µ</a><br><a href="#1.3">Hot and Cold Observables</a></p>
</blockquote>
<h2 id="1.0"> ä»€ä¹ˆæ˜¯ RxSwift </h2>

<p><a href="https://github.com/ReactiveX/RxSwift" target="_blank" rel="external">RxSwift</a> æ˜¯ <a href="http://reactivex.io/" target="_blank" rel="external">ReactiveX</a> çš„ Swift ç‰ˆæœ¬ï¼Œå…¨ç§° Reactive Extensions Swiftï¼Œæ˜¯ä¸€ä¸ªå“åº”å¼ç¼–ç¨‹çš„åŸºç¡€æ¡†æ¶ã€‚</p>
<h2 id="1.1"> å“åº”å¼ç¼–ç¨‹ </h2>

<p>åœ¨é¢å‘å¯¹è±¡æ—¶ä»£ï¼Œå¤§å¤šæ•°ç¨‹åºéƒ½åƒè¿™æ ·è¿è¡Œï¼šä½ çš„ä»£ç å‘Šè¯‰ä½ çš„ç¨‹åºéœ€è¦åšä»€ä¹ˆï¼Œå¹¶ä¸”æœ‰å¾ˆå¤šæ–¹æ³•æ¥ç›‘å¬å˜åŒ–â€“ä½†åŒæ—¶ä½ åˆå¿…é¡»ä¸»åŠ¨å‘Šè¯‰ç³»ç»Ÿä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„å˜åŒ–ã€‚</p>
<p>å“åº”å¼ç¼–ç¨‹çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šä½ çš„ç¨‹åºå¯ä»¥å¯¹åº•å±‚æ•°æ®çš„å˜åŒ–åšå‡ºå“åº”ï¼Œè€Œä¸éœ€è¦ä½ ç›´æ¥å‘Šè¯‰å®ƒã€‚è¿™æ ·ï¼Œä½ å¯ä»¥æ›´ä¸“æ³¨äºæ‰€éœ€è¦å¤„ç†çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸éœ€è¦å»ç»´æŠ¤ç‰¹å®šçš„çŠ¶æ€ã€‚</p>
<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<blockquote>
<p>a ï¼ b ï¼‹ c<br>èµ‹å€¼ä¹‹å b æˆ–è€… c çš„å€¼å˜åŒ–åï¼Œa çš„å€¼ä¸ä¼šè·Ÿç€å˜åŒ–<br>å“åº”å¼ç¼–ç¨‹ï¼Œç›®æ ‡å°±æ˜¯ï¼Œå¦‚æœ b æˆ–è€… c çš„æ•°å€¼å‘ç”Ÿå˜åŒ–ï¼Œa çš„æ•°å€¼ä¼šåŒæ—¶å‘ç”Ÿå˜åŒ–ï¼›</p>
</blockquote>
<p>å¦å¤–æ¨èçœ‹çœ‹è¿™ç¯‡ <a href="http://blog.mrriddler.com/" target="_blank" rel="external">iOS å“åº”å¼æ¶æ„</a></p>
<h2 id="1.2"> RxSwift çš„æ ¸å¿ƒ </h2>

<p>RxSwift æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼ˆObserverï¼‰è®¢é˜…ä¸€ä¸ªå¯è¢«è§‚å¯Ÿåºåˆ—ï¼ˆObservableï¼‰ã€‚è§‚å¯Ÿè€…å¯¹å¯è¢«è§‚å¯Ÿåºåˆ—å‘å°„çš„æ•°æ®æˆ–æ•°æ®åºåˆ—ä½œå‡ºå“åº”ã€‚</p>
<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå½“åˆ«äººåœ¨è·Ÿä½ è¯´è¯æ—¶ï¼Œä½ å°±æ˜¯é‚£ä¸ªè§‚å¯Ÿè€…ï¼ˆObserverï¼‰ï¼Œåˆ«äººå°±æ˜¯é‚£ä¸ªï¼ˆObservableï¼‰ï¼Œå®ƒæœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li>å¯èƒ½ä¼šä¸æ–­åœ°è·Ÿä½ è¯´è¯ã€‚ï¼ˆ<code>onNext</code>ï¼‰</li>
<li>å¯èƒ½ä¼šè¯´é”™è¯ã€‚ï¼ˆ<code>onError</code>ï¼‰</li>
<li>ç»“æŸè¯´è¯ã€‚ï¼ˆ<code>onCompleted</code>ï¼‰</li>
</ul>
<p>ä½ åœ¨å¬åˆ°å¯¹æ–¹è¯´çš„è¯åï¼Œä¹Ÿå¯ä»¥æœ‰å‡ ç§ååº”ï¼š</p>
<ul>
<li>æ ¹æ®è¯´çš„è¯ï¼Œåšç›¸åº”çš„äº‹ï¼Œæ¯”å¦‚å¯¹æ–¹è®©ä½ å€Ÿé’±ç»™ä»–ã€‚ï¼ˆ<code>subscribe</code>ï¼‰</li>
<li>æŠŠå¯¹æ–¹è¯´çš„è¯ï¼ŒåŠ å·¥ä¸‹å†ä¼ è¾¾ç»™å…¶ä»–äººï¼Œæ¯”å¦‚å¯¹æ–¹è¯´å°æå¥½åƒä¸å¤ªèˆ’æœï¼Œä½ ä¼ è¾¾ç»™å…¶ä»–äººæ—¶å°±å˜æˆäº†å°æå¤±æ‹äº†ã€‚ï¼ˆ<code>map:</code>ï¼‰</li>
<li>å‚è€ƒå…¶ä»–äººè¯´çš„è¯å†åšå¤„ç†ï¼Œæ¯”å¦‚å°æè¯´æŸå®¶åº—å¾ˆå¥½åƒï¼Œå°é»„è¯´æŸå®¶åº—ä¸€èˆ¬èˆ¬ï¼Œä½ éœ€è¦ç»“åˆä¸¤ä¸ªäººçš„æ„è§å†åšå®šå¤ºã€‚ï¼ˆ<code>zip:</code>ï¼‰</li>
</ul>
<h3 id="Observable-å¯è¢«è§‚å¯Ÿçš„åºåˆ—"><a href="#Observable-å¯è¢«è§‚å¯Ÿçš„åºåˆ—" class="headerlink" title="Observable - å¯è¢«è§‚å¯Ÿçš„åºåˆ—"></a>Observable - å¯è¢«è§‚å¯Ÿçš„åºåˆ—</h3><h4 id="Observable-çš„ä¸‰ç§äº‹ä»¶"><a href="#Observable-çš„ä¸‰ç§äº‹ä»¶" class="headerlink" title="Observable çš„ä¸‰ç§äº‹ä»¶"></a>Observable çš„ä¸‰ç§äº‹ä»¶</h4><ul>
<li>next - åºåˆ—äº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„å…ƒç´ </li>
<li>error - åˆ›å»ºåºåˆ—æ—¶äº§ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œå¯¼è‡´åºåˆ—ç»ˆæ­¢</li>
<li>completed - åºåˆ—çš„æ‰€æœ‰å…ƒç´ éƒ½å·²ç»æˆåŠŸäº§ç”Ÿï¼Œæ•´ä¸ªåºåˆ—å·²ç»å®Œæˆ</li>
</ul>
<h4 id="åŸºæœ¬åˆ›å»ºæ–¹å¼"><a href="#åŸºæœ¬åˆ›å»ºæ–¹å¼" class="headerlink" title="åŸºæœ¬åˆ›å»ºæ–¹å¼"></a>åŸºæœ¬åˆ›å»ºæ–¹å¼</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">enum</span> <span class="title">MyError</span>: <span class="title">Error</span> </span>&#123;</div><div class="line">    <span class="keyword">case</span> anError</div><div class="line">&#125;</div><div class="line">        </div><div class="line"><span class="keyword">let</span> message: <span class="type">Observable</span>&lt;<span class="type">String</span>&gt; = <span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.create &#123; (observer) -&gt; <span class="type">Disposable</span> <span class="keyword">in</span></div><div class="line">            </div><div class="line">    observer.onNext(<span class="string">"ğŸ˜„"</span>)</div><div class="line">    observer.onError(<span class="type">MyError</span>.anError)</div><div class="line">    observer.onCompleted()</div><div class="line">        </div><div class="line">    <span class="keyword">return</span> <span class="type">Disposables</span>.create()</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="å°è£…å¥½æ“ä½œç¬¦åˆ›å»ºæ–¹å¼"><a href="#å°è£…å¥½æ“ä½œç¬¦åˆ›å»ºæ–¹å¼" class="headerlink" title="å°è£…å¥½æ“ä½œç¬¦åˆ›å»ºæ–¹å¼"></a>å°è£…å¥½æ“ä½œç¬¦åˆ›å»ºæ–¹å¼</h4><ul>
<li>just - å°†æŸä¸€ä¸ªå…ƒç´ è½¬æ¢ä¸º <code>Observable</code> å¹¶å‘å‡ºå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ </li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> id = <span class="type">Observable</span>.just(<span class="number">0</span>)</div><div class="line"></div><div class="line">ç›¸å½“äºï¼š</div><div class="line"></div><div class="line"><span class="keyword">let</span> id = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.create &#123; observer <span class="keyword">in</span></div><div class="line">    observer.onNext(<span class="number">0</span>)</div><div class="line">    observer.onCompleted()</div><div class="line">    <span class="keyword">return</span> <span class="type">Disposables</span>.create()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>from - å°†å…¶ä»–ç±»å‹æˆ–è€…æ•°æ®ç»“æ„è½¬æ¢ä¸º <code>Observable</code> </li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">å°†ä¸€ä¸ªæ•°ç»„è½¬æ¢ä¸º <span class="type">Observable</span>ï¼š</div><div class="line"></div><div class="line"><span class="keyword">let</span> numbers = <span class="type">Observable</span>.from([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>])</div><div class="line"></div><div class="line">ç›¸å½“äºï¼š</div><div class="line"></div><div class="line"><span class="keyword">let</span> numbers = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.create &#123; observer <span class="keyword">in</span></div><div class="line">    observer.onNext(<span class="number">0</span>)</div><div class="line">    observer.onNext(<span class="number">1</span>)</div><div class="line">    observer.onNext(<span class="number">2</span>)</div><div class="line">    observer.onCompleted()</div><div class="line">    <span class="keyword">return</span> <span class="type">Disposables</span>.create()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…·ä½“æ›´å¤šçš„æ“ä½œç¬¦ï¼Œå¤§å®¶å¯ä»¥çœ‹çœ‹è¿™ä¸ªæ–‡æ¡£çš„ <a href="https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/decision_tree.html" target="_blank" rel="external">å¦‚ä½•é€‰æ‹©æ“ä½œç¬¦ï¼Ÿ</a>ã€‚ä¹Ÿå¯ä»¥çœ‹çœ‹å®˜æ–¹ç¤ºä¾‹é‡Œçš„ <code>playground</code> ï¼š<a href="https://github.com/ReactiveX/RxSwift/tree/master/Rx.playground" target="_blank" rel="external">Rx.playground</a></p>
<h3 id="Observer-è§‚å¯Ÿè€…"><a href="#Observer-è§‚å¯Ÿè€…" class="headerlink" title="Observer - è§‚å¯Ÿè€…"></a>Observer - è§‚å¯Ÿè€…</h3><h4 id="åŸºæœ¬åˆ›å»ºæ–¹å¼-1"><a href="#åŸºæœ¬åˆ›å»ºæ–¹å¼-1" class="headerlink" title="åŸºæœ¬åˆ›å»ºæ–¹å¼"></a>åŸºæœ¬åˆ›å»ºæ–¹å¼</h4><p>ç†è§£è§‚å¯Ÿè€…çš„æ„æ€åï¼Œé‚£æˆ‘ä»¬å¦‚ä½•åˆ›å»ºå‘¢ï¼Ÿå¯¹åº” Observable ä¸€èŠ‚ä¸­çš„ â€œåŸºæœ¬åˆ›å»ºæ–¹å¼â€ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º <code>message: Observable&lt;String&gt;</code> åˆ›å»ºä¸€ä¸ªè§‚å¯Ÿè€…ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">message.subscribe(onNext: &#123; str <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"è§‚å¯Ÿä¿¡æ¯"</span>)</div><div class="line">    &#125;, onError: &#123; error <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"å‘ç”Ÿé”™è¯¯"</span>)</div><div class="line">    &#125;, onCompleted: &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"å®Œæˆ"</span>)</div><div class="line">&#125;).dispose()</div></pre></td></tr></table></figure>
<p>åˆ›å»ºè§‚å¯Ÿè€…æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯åœ¨ <code>Observable</code> çš„ <code>subscribe</code> æ–¹æ³•åé¢æè¿°ï¼Œäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œéœ€è¦å¦‚ä½•åšå‡ºå“åº”ã€‚è€Œè§‚å¯Ÿè€…å°±æ˜¯ç”±åé¢çš„ <code>onNext</code>ï¼Œ<code>onError</code>ï¼Œ<code>onCompleted</code> çš„è¿™äº›é—­åŒ…æ„å»ºå‡ºæ¥çš„ã€‚</p>
<h4 id="ä¸€äº›å°è£…"><a href="#ä¸€äº›å°è£…" class="headerlink" title="ä¸€äº›å°è£…"></a>ä¸€äº›å°è£…</h4><p>RxSwift ä¹Ÿå¸®æˆ‘ä»¬å°è£…äº†å¾ˆå¤šè®¸å¤šå¸¸ç”¨çš„è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ï¼Œæ¯”å¦‚ <code>button</code> çš„ç‚¹å‡»ï¼Œé€šçŸ¥ä»¥åŠä»£ç†ç­‰ç­‰ã€‚</p>
<p>æˆ‘ä»¬å…ˆå¯¼å…¥å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> RxCocoa</div></pre></td></tr></table></figure>
<p>åŸå…ˆç›‘å¬æŒ‰é’®ç‚¹å‡»éœ€è¦è¿™ä¹ˆåšï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">    </div><div class="line">        <span class="keyword">let</span> btn = <span class="type">UIButton</span>.<span class="keyword">init</span>(frame: <span class="type">CGRect</span>(x: <span class="number">100</span>, y: <span class="number">100</span>, width: <span class="number">150</span>, height: <span class="number">50</span>))</div><div class="line">        btn.backgroundColor = <span class="type">UIColor</span>.brown</div><div class="line">        btn.addTarget(<span class="keyword">self</span>, action: #selector(btnClick), <span class="keyword">for</span>: .touchUpInside)</div><div class="line">        view.addSubview(btn)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// å›è°ƒç›‘å¬</span></div><div class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">btnClick</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"btn click !"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç”¨ RxSwift æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> btn = <span class="type">UIButton</span>.<span class="keyword">init</span>(frame: <span class="type">CGRect</span>(x: <span class="number">100</span>, y: <span class="number">100</span>, width: <span class="number">150</span>, height: <span class="number">50</span>))</div><div class="line">        btn.backgroundColor = <span class="type">UIColor</span>.brown</div><div class="line">        view.addSubview(btn)</div><div class="line">        </div><div class="line">        <span class="comment">// å›è°ƒç›‘å¬</span></div><div class="line">        btn.rx.tap.subscribe(onNext: &#123;</div><div class="line">    </div><div class="line">            <span class="built_in">print</span>(<span class="string">"btn click !"</span>)</div><div class="line">            </div><div class="line">        &#125;).disposed(by: disposeBag)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å†çœ‹çœ‹ä»£ç†ï¼ŒåŸå…ˆæˆ‘ä»¬éœ€è¦è¿™ä¹ˆåšï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> textView: <span class="type">UITextView</span>!</div><div class="line"></div><div class="line">    <span class="keyword">var</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        <span class="comment">// è®¾ç½®ä»£ç†</span></div><div class="line">        textView.delegate = <span class="keyword">self</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIViewController</span>: <span class="title">UITextViewDelegate</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">scrollViewDidScroll</span><span class="params">(<span class="number">_</span> scrollView: UIScrollView)</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"yåæ ‡ï¼š\(offset.y)"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç”¨ RxSwift æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> textView: <span class="type">UITextView</span>!</div><div class="line"></div><div class="line">    <span class="keyword">var</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        </div><div class="line">        textView.rx.contentOffset.subscribe(onNext: &#123; offset <span class="keyword">in</span></div><div class="line">            </div><div class="line">            <span class="built_in">print</span>(<span class="string">"yåæ ‡ï¼š\(offset.y)"</span>)</div><div class="line">            </div><div class="line">        &#125;).disposed(by: disposeBag)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ï¼ŒRxSwift ä½¿ä¸€äº›ç³»ç»Ÿçš„æ–¹æ³•ï¼Œä½¿ç”¨ä¸Šå˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚</p>
<h3 id="Subjects-æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€…"><a href="#Subjects-æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€…" class="headerlink" title="Subjects - æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€…"></a>Subjects - æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€…</h3><p>Subject æ˜¯ observable å’Œ Observer ä¹‹é—´çš„æ¡¥æ¢ã€‚ä¸€ä¸ª Subject æ—¢æ˜¯ä¸€ä¸ª Obserable ä¹Ÿæ˜¯ä¸€ä¸ª Observerï¼Œæ—¢å¯ä»¥å‘å‡ºäº‹ä»¶ï¼Œä¹Ÿå¯ä»¥ç›‘å¬äº‹ä»¶ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>UITextField</code> çš„å½“å‰æ–‡æœ¬ã€‚å®ƒå¯ä»¥çœ‹æˆæ˜¯ç”±ç”¨æˆ·è¾“å…¥ï¼Œè€Œäº§ç”Ÿçš„ä¸€ä¸ªæ–‡æœ¬åºåˆ—ã€‚ä¹Ÿå¯ä»¥æ˜¯ç”±å¤–éƒ¨æ–‡æœ¬åºåˆ—ï¼Œæ¥æ§åˆ¶å½“å‰æ˜¾ç¤ºå†…å®¹çš„è§‚å¯Ÿè€…ï¼š</p>
<ul>
<li>ä½œä¸ºå¯è¢«ç›‘å¬çš„åºåˆ—ï¼ˆ<code>observable</code>ï¼‰</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> tf: <span class="type">UITextField</span>!</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        </div><div class="line">        <span class="comment">// ä½œä¸ºå¯è¢«ç›‘å¬çš„åºåˆ—</span></div><div class="line">        <span class="keyword">let</span> observable_tf = tf.rx.text</div><div class="line">    </div><div class="line">        observable_tf.subscribe(onNext:&#123; text <span class="keyword">in</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> t = text &#123;</div><div class="line">                <span class="type">DebugPrint</span>(t)</div><div class="line">            &#125;</div><div class="line">        &#125;).disposed(by: disposeBag)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ä½œä¸ºè§‚å¯Ÿè€…ï¼ˆ<code>Observer</code>ï¼‰</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> tf: <span class="type">UITextField</span>!</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">                </div><div class="line">        <span class="comment">// ä½œä¸ºè§‚å¯Ÿè€…</span></div><div class="line">        <span class="keyword">let</span> observer_tf = tf.rx.text</div><div class="line">        <span class="keyword">let</span> text: <span class="type">Observable</span>&lt;<span class="type">String</span>?&gt; = <span class="type">Observable</span>.just(<span class="string">"Atom."</span>)</div><div class="line">        </div><div class="line">        text.bind(to: observer_tf).disposed(by: disposeBag)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>RxSwift ä¸­ä¹Ÿå®šä¹‰äº†ä¸€äº›è¾…åŠ©ç±»å‹ï¼Œå®ƒä»¬æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€…ã€‚è¿™é‡Œå°±ä¸å¤šè®²äº†ï¼Œå…·ä½“å¯ä»¥çœ‹çœ‹è¿™é‡Œ <a href="https://beeth0ven.github.io/RxSwift-Chinese-Documentation/content/rxswift_core/observable_and_observer.html" target="_blank" rel="external">Observable &amp; Observer æ—¢æ˜¯å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€…</a>ã€‚</p>
<h3 id="Disposable-å¯è¢«æ¸…é™¤çš„èµ„æº"><a href="#Disposable-å¯è¢«æ¸…é™¤çš„èµ„æº" class="headerlink" title="Disposable - å¯è¢«æ¸…é™¤çš„èµ„æº"></a>Disposable - å¯è¢«æ¸…é™¤çš„èµ„æº</h3><p>å½“ç›‘å¬ä¸€ä¸ªäº‹ä»¶åºåˆ—çš„æ—¶å€™ï¼Œæœ‰æ¶ˆæ¯äº‹ä»¶æ¥äº†ï¼Œæˆ‘ä»¬åšæŸäº›äº‹æƒ…ã€‚ä½†æ˜¯è¿™ä¸ªäº‹ä»¶åºåˆ—ä¸å†å‘å‡ºæ¶ˆæ¯äº†ï¼Œæˆ‘ä»¬çš„ç›‘å¬ä¹Ÿå°±æ²¡æœ‰ä»€ä¹ˆå­˜åœ¨ä»·å€¼äº†ï¼Œä¸ºäº†ä¸æ¶ˆè€—å†…å­˜ï¼Œéœ€è¦é‡Šæ”¾è¿™äº›ç›‘å¬èµ„æºã€‚</p>
<p>ä¸€ä¸ª Observable è¢«è§‚å¯Ÿè®¢é˜…åï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ª <code>Disposable</code> å®ä¾‹ï¼Œè¡¨ç¤ºã€Œå¯æ‰”æ‰ã€çš„ï¼Œæ€ä¹ˆæ‰”æ‰å‘¢ï¼Ÿæœ‰ä¸‹é¢å‡ ç§æ–¹å¼ï¼š</p>
<ul>
<li>è°ƒç”¨ <code>dispose()</code> æ˜¾å¼é‡Šæ”¾</li>
<li>é€šè¿‡ DisposeBag ä¹Ÿå°±æ˜¯ <code>disposed()</code> éšå¼é‡Šæ”¾ã€‚</li>
<li>åˆ©ç”¨ <code>takeUntil</code> æ“ä½œç¬¦ï¼Œéšå¼é‡Šæ”¾ã€‚</li>
</ul>
<h4 id="Dispose"><a href="#Dispose" class="headerlink" title="Dispose"></a>Dispose</h4><p>æˆ‘ä»¬ç›´æ¥çœ‹ä¸ª ğŸŒ° ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">    </div><div class="line">        <span class="keyword">let</span> subscription = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.interval(<span class="number">1.0</span>, scheduler: <span class="type">SerialDispatchQueueScheduler</span>.<span class="keyword">init</span>(internalSerialQueueName: <span class="string">"serial"</span>))</div><div class="line">            .subscribe &#123; event <span class="keyword">in</span></div><div class="line">                <span class="built_in">print</span>(<span class="string">"\(event)"</span>)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="type">Thread</span>.sleep(forTimeInterval: <span class="number">4.0</span>)</div><div class="line">        </div><div class="line">        <span class="type">DebugPrint</span>(<span class="string">"æ‰‹åŠ¨é‡Šæ”¾"</span>)</div><div class="line">        subscription.dispose()</div><div class="line">    </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">16</span>:<span class="number">47</span>:<span class="number">49</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">39</span>]ï¼šnext(<span class="number">0</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">16</span>:<span class="number">47</span>:<span class="number">50</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">39</span>]ï¼šnext(<span class="number">1</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">16</span>:<span class="number">47</span>:<span class="number">51</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">39</span>]ï¼šnext(<span class="number">2</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">16</span>:<span class="number">47</span>:<span class="number">52</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">39</span>]ï¼šnext(<span class="number">3</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">16</span>:<span class="number">47</span>:<span class="number">52</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">44</span>]ï¼šæ‰‹åŠ¨é‡Šæ”¾</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä¾‹å­ç±»ä¼¼å®šæ—¶å™¨ï¼Œæ¯ç§’ä¼šè°ƒä¸€æ¬¡å›è°ƒã€‚æˆ‘ä»¬ <code>sleep</code> 4 ç§’åï¼Œè°ƒä¸‹ <code>dispose()</code>ï¼Œå¯ä»¥å‘ç°å›è°ƒå°±åœæ­¢äº†ï¼Œå› ä¸ºè¿™ä¸ªè®¢é˜…è¢«é‡Šæ”¾äº†ã€‚</p>
<blockquote>
<p><code>dispose()</code> è¿™ç§æ˜¾ç¤ºé‡Šæ”¾èµ„æºçš„æ–¹å¼ä¸€èˆ¬ä¸æ¨èï¼Œä¸‹é¢ä»‹ç»çš„ DisposeBag æ˜¯æ¯”è¾ƒæ¨èçš„æ–¹å¼ï¼</p>
</blockquote>
<h4 id="DisposeBag"><a href="#DisposeBag" class="headerlink" title="DisposeBag"></a>DisposeBag</h4><p>DisposeBag æ˜¯æ¯”è¾ƒæ¨èçš„æ–¹å¼ã€‚çœ‹åå­—ä¹Ÿå¾ˆå¥½ç†è§£ -ã€Œå¤„ç†è¢‹ã€ï¼ŒæŠŠéœ€è¦é‡Šæ”¾çš„ <code>Disposable</code> å®ä¾‹ï¼Œæ‰”åˆ°è¢‹å­é‡Œã€‚åœ¨è¢‹å­è¢«å›æ”¶ï¼ˆ<code>deinit</code>ï¼‰æ—¶ï¼Œä¼šé¡ºä¾¿æ‰§è¡Œä¸€ä¸‹ <code>Disposable.dispose()</code>ï¼Œä¹‹å‰åˆ›å»º <code>Disposable</code> æ—¶ç”³è¯·çš„èµ„æºå°±ä¼šè¢«ä¸€å¹¶é‡Šæ”¾æ‰ã€‚å¬èµ·æ¥æœ‰ç‚¹åƒ ARCã€‚ä¸è¿‡åœ¨åˆ›å»ºè¿™ä¸ªã€Œå¤„ç†è¢‹ã€æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯å®ƒä¸é‚£ä¹ˆå¿«è¢«é‡Šæ”¾æ‰ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯å£°æ˜æˆå®ä¾‹çš„æˆå‘˜å˜é‡ï¼Œå’Œå®ä¾‹ç»‘å®šèµ·æ¥ï¼Œå®ä¾‹é”€æ¯ï¼Œå®ƒä¹Ÿå°±é”€æ¯ã€‚æˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸ª ğŸŒ°ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewControllerTwo</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// åˆ›å»ºã€Œå¤„ç†è¢‹ï¼Œå£°æ˜æˆå®ä¾‹çš„æˆå‘˜å˜é‡</span></div><div class="line">    <span class="keyword">var</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line"></div><div class="line">        <span class="keyword">let</span> subscription = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.interval(<span class="number">1.0</span>, scheduler: <span class="type">SerialDispatchQueueScheduler</span>.<span class="keyword">init</span>(internalSerialQueueName: <span class="string">"haha"</span>))</div><div class="line">            .subscribe &#123; event <span class="keyword">in</span></div><div class="line">                <span class="type">DebugPrint</span>(<span class="string">"\(event)"</span>)</div><div class="line">        &#125;</div><div class="line">        subscription.disposed(by: disposeBag)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">deinit</span> &#123;</div><div class="line">        <span class="type">DebugPrint</span>(<span class="string">"é‡Šæ”¾äº†"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">03</span> <span class="type">ViewControllerTwo</span>.swift viewDidLoad() <span class="number">23</span>]ï¼šnext(<span class="number">0</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">04</span> <span class="type">ViewControllerTwo</span>.swift viewDidLoad() <span class="number">23</span>]ï¼šnext(<span class="number">1</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">05</span> <span class="type">ViewControllerTwo</span>.swift viewDidLoad() <span class="number">23</span>]ï¼šnext(<span class="number">2</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">06</span> <span class="type">ViewControllerTwo</span>.swift viewDidLoad() <span class="number">23</span>]ï¼šnext(<span class="number">3</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">07</span> <span class="type">ViewControllerTwo</span>.swift viewDidLoad() <span class="number">23</span>]ï¼šnext(<span class="number">4</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">17</span>:<span class="number">57</span>:<span class="number">08</span> <span class="type">ViewControllerTwo</span>.swift <span class="keyword">deinit</span> <span class="number">29</span>]ï¼šé‡Šæ”¾äº†</div></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ï¼Œåœ¨ <code>ViewControllerTwo</code> é‡Šæ”¾ï¼ˆ<code>deinit</code>ï¼‰åï¼Œå›è°ƒä¹Ÿåœæ­¢äº†ï¼</p>
<h4 id="takeUntil"><a href="#takeUntil" class="headerlink" title="takeUntil"></a>takeUntil</h4><p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨ <code>takeUntil</code> æ“ä½œç¬¦ï¼ŒæŠŠè®¢é˜…ç»‘å®šåœ¨ <code>deallocated</code>ï¼Œæ¥å®ç°è‡ªåŠ¨æ¸…ç†ã€‚æˆ‘ä»¬ç›´æ¥çœ‹ ğŸŒ°ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewControllerTwo</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line"></div><div class="line">        <span class="number">_</span> = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;</div><div class="line">            .interval(<span class="number">1.0</span>, scheduler: <span class="type">SerialDispatchQueueScheduler</span>.<span class="keyword">init</span>(internalSerialQueueName: <span class="string">"haha"</span>))</div><div class="line">            .takeUntil(<span class="keyword">self</span>.rx.deallocated) <span class="comment">// ç»‘å®š deallocated</span></div><div class="line">            .subscribe &#123; event <span class="keyword">in</span></div><div class="line">                <span class="type">DebugPrint</span>(<span class="string">"\(event)"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">deinit</span> &#123;</div><div class="line">        <span class="type">DebugPrint</span>(<span class="string">"é‡Šæ”¾äº†"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">29</span> <span class="type">ViewControllerTwo</span>.swift viewDidLoad() <span class="number">22</span>]ï¼šnext(<span class="number">0</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">30</span> <span class="type">ViewControllerTwo</span>.swift viewDidLoad() <span class="number">22</span>]ï¼šnext(<span class="number">1</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">31</span> <span class="type">ViewControllerTwo</span>.swift viewDidLoad() <span class="number">22</span>]ï¼šnext(<span class="number">2</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">32</span> <span class="type">ViewControllerTwo</span>.swift viewDidLoad() <span class="number">22</span>]ï¼šnext(<span class="number">3</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">33</span> <span class="type">ViewControllerTwo</span>.swift viewDidLoad() <span class="number">22</span>]ï¼šnext(<span class="number">4</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">34</span> <span class="type">ViewControllerTwo</span>.swift viewDidLoad() <span class="number">22</span>]ï¼šnext(<span class="number">5</span>)</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">35</span> <span class="type">ViewControllerTwo</span>.swift <span class="keyword">deinit</span> <span class="number">27</span>]ï¼šé‡Šæ”¾äº†</div><div class="line">[<span class="number">2017</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">35</span> <span class="type">ViewControllerTwo</span>.swift viewDidLoad() <span class="number">22</span>]ï¼šcompleted</div></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°åœ¨ <code>ViewControllerTwo</code> é‡Šæ”¾ï¼ˆ<code>deinit</code>ï¼‰åï¼Œå›è°ƒä¹Ÿåœæ­¢äº†ï¼</p>
<h2 id="1.3"> Hot and Cold Observables </h2>

<h3 id="Cold-Observables"><a href="#Cold-Observables" class="headerlink" title="Cold Observables"></a>Cold Observables</h3><p>åªæœ‰åœ¨è¢«è®¢é˜…çš„æ—¶å€™æ‰ä¼šå‘å°„äº‹ä»¶ã€‚æ¯æ¬¡æœ‰æ–°çš„è®¢é˜…è€…éƒ½ä¼šæŠŠä¹‹å‰æ‰€æœ‰çš„äº‹ä»¶éƒ½é‡æ–°å‘å°„ä¸€éï¼Œæ¢å¥è¯è¯´ï¼Œæ¯ä¸ªè®¢é˜…è€…éƒ½ä¼šç‹¬ç«‹çš„æ”¶åˆ°è®¢é˜…è€…å‘å°„çš„æ•°æ®ã€‚</p>
<p>ä¸¾ä¸ª ğŸŒ° ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">let</span> intSequence = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.create &#123; (observer) -&gt; <span class="type">Disposable</span> <span class="keyword">in</span></div><div class="line"></div><div class="line">        observer.onNext(<span class="number">1</span>)</div><div class="line">        observer.onNext(<span class="number">2</span>)</div><div class="line">        observer.onNext(<span class="number">3</span>)</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> <span class="type">Disposables</span>.create()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ <code>Observable</code> åœ¨æ²¡è®¢é˜…ä¹‹å‰ï¼Œ<code>create</code> æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ã€‚å½“æˆ‘ä»¬è®¢é˜…æ—¶æ‰ä¼šæ‰§è¡Œï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">intSequence.subscribe(onNext:&#123; value <span class="keyword">in</span></div><div class="line">            </div><div class="line">    <span class="type">DebugPrint</span>(<span class="string">"subscribe1 : \(value)"</span>);</div><div class="line">            </div><div class="line">&#125;).disposed(by: disposeBag)</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">76</span>]ï¼šsubscribe1 : <span class="number">1</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">76</span>]ï¼šsubscribe1 : <span class="number">2</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">76</span>]ï¼šsubscribe1 : <span class="number">3</span></div></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬æ¥ç€ä¸Šé¢çš„ä»£ç å†å¤šæ·»åŠ å‡ ä¸ªè®¢é˜…ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">2</span>...<span class="number">4</span> &#123;</div><div class="line">    <span class="comment">// ç¬¬ä¸‰ä¸ªè®¢é˜…å»¶è¿Ÿä¸¤ç§’</span></div><div class="line">    <span class="keyword">if</span> i == <span class="number">3</span> &#123;</div><div class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + <span class="number">2</span>, execute: &#123;</div><div class="line">            intSequence.subscribe(onNext:&#123; value <span class="keyword">in</span></div><div class="line">                </div><div class="line">                <span class="type">DebugPrint</span>(<span class="string">"subscribe\(i) : \(value)"</span>)</div><div class="line">                </div><div class="line">            &#125;).disposed(by: <span class="keyword">self</span>.disposeBag)</div><div class="line">        &#125;)</div><div class="line">        <span class="keyword">continue</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    intSequence.subscribe(onNext:&#123; value <span class="keyword">in</span></div><div class="line">        </div><div class="line">        <span class="type">DebugPrint</span>(<span class="string">"subscribe\(i) : \(value)"</span>)</div><div class="line">        </div><div class="line">    &#125;).disposed(by: disposeBag)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">76</span>]ï¼šsubscribe1 : <span class="number">1</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">76</span>]ï¼šsubscribe1 : <span class="number">2</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">76</span>]ï¼šsubscribe1 : <span class="number">3</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">96</span>]ï¼šsubscribe2 : <span class="number">1</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">96</span>]ï¼šsubscribe2 : <span class="number">2</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">96</span>]ï¼šsubscribe2 : <span class="number">3</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">96</span>]ï¼šsubscribe4 : <span class="number">1</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">96</span>]ï¼šsubscribe4 : <span class="number">2</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">24</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">96</span>]ï¼šsubscribe4 : <span class="number">3</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">26</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">86</span>]ï¼šsubscribe3 : <span class="number">1</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">26</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">86</span>]ï¼šsubscribe3 : <span class="number">2</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">17</span>:<span class="number">05</span>:<span class="number">26</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">86</span>]ï¼šsubscribe3 : <span class="number">3</span></div></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°æ¯æ¬¡æ•°æ®éƒ½ä¼šé‡æ–°å‘å°„ä¸€éï¼Œæ˜¯ç‹¬ç«‹çš„ï¼Œå³ Observable ä¼šä¸ºæ¯ä¸ªè®¢é˜…è€…å•ç‹¬æ‰§è¡Œä¸€æ¬¡å‘å°„æ•°æ®çš„ä»£ç ã€‚</p>
<h3 id="Hot-Observables"><a href="#Hot-Observables" class="headerlink" title="Hot Observables"></a>Hot Observables</h3><p>æœ‰æ–°çš„äº‹ä»¶å®ƒå°±å‘å°„ï¼Œä¸è€ƒè™‘æ˜¯å¦æœ‰è®¢é˜…è€…è®¢é˜…ã€‚è€Œæ–°çš„è®¢é˜…è€…å¹¶ä¸ä¼šæ¥æ”¶åˆ°è®¢é˜…å‰å·²ç»å‘å°„è¿‡çš„äº‹ä»¶ã€‚</p>
<p>è¿™é‡Œæ€ä¹ˆç†è§£å‘¢ï¼ŸæŒ‰é’®çš„ç‚¹å‡»å°±æ˜¯ä¸ªç»å…¸çš„ ğŸŒ°ã€‚å±å¹•ä¸Šçš„ä¸€ä¸ªæŒ‰é’®ï¼Œä¸ç®¡æœ‰æ²¡æœ‰è®¢é˜…è€…è®¢é˜…å®ƒçš„ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»äº‹ä»¶éƒ½ä¼šå‘ç”Ÿï¼Œæˆ‘ä»¬éƒ½èƒ½é€šè¿‡æ‰‹æŒ‡ç‚¹å‡»å±å¹•ä¸Šçš„æŒ‰é’®ã€‚å½“æœ‰è®¢é˜…è€…è®¢é˜…è¿™ä¸ªæŒ‰é’®åï¼Œæˆ‘ä»¬å°±èƒ½æ”¶åˆ°æŒ‰é’®ç‚¹å‡»äº‹ä»¶çš„åé¦ˆï¼Œä½†æ˜¯æ²¡è®¢é˜…ä¹‹å‰çš„å›è°ƒåé¦ˆæ˜¯æ²¡æœ‰çš„ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> tap = button.rx.tap</div><div class="line">tap.subscribe(onNext: &#123;</div><div class="line">    <span class="type">DebugPrint</span>(<span class="string">"Tap 1"</span>)</div><div class="line">&#125;).disposed(by: disposeBag)</div><div class="line"></div><div class="line"><span class="type">DispatchQueue</span>.main.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + <span class="number">3</span>) &#123;</div><div class="line">    tap.subscribe(onNext: &#123;</div><div class="line">        <span class="type">DebugPrint</span>(<span class="string">"Tap 2"</span>)</div><div class="line">    &#125;).disposed(by: <span class="keyword">self</span>.disposeBag)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ¯”å¦‚ 3 ç§’å‰ï¼Œæˆ‘ä»¬ç‚¹å‡»äº†ä¸‰æ¬¡ Button ï¼Œæ­¤ååˆç‚¹å‡»äº†ä¸¤æ¬¡ï¼Œæ€»å…±äº”æ¬¡æŒ‰é’®çš„ç‚¹å‡»ã€‚è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[2018-01-02 18:22:51 ViewController.swift viewDidLoad() 45]ï¼šTap 1</div><div class="line">[2018-01-02 18:22:52 ViewController.swift viewDidLoad() 45]ï¼šTap 1</div><div class="line">[2018-01-02 18:22:52 ViewController.swift viewDidLoad() 45]ï¼šTap 1</div><div class="line">[2018-01-02 18:22:56 ViewController.swift viewDidLoad() 45]ï¼šTap 1</div><div class="line">[2018-01-02 18:22:56 ViewController.swift viewDidLoad() 50]ï¼šTap 2</div><div class="line">[2018-01-02 18:22:56 ViewController.swift viewDidLoad() 45]ï¼šTap 1</div><div class="line">[2018-01-02 18:22:56 ViewController.swift viewDidLoad() 50]ï¼šTap 2</div></pre></td></tr></table></figure>
<p>3 ç§’å‰ç¬¬äºŒä¸ªè®¢é˜…è€…å¹¶æ²¡æœ‰è®¢é˜… tap ï¼Œæ•…ä¸ä¼šæœ‰ Tap 2 çš„è¾“å‡ºã€‚3 ç§’åç¬¬äºŒä¸ªè®¢é˜…è€…è®¢é˜…äº† tap ï¼Œæ­¤æ—¶ç‚¹å‡» Button ï¼Œå¯ä»¥çœ‹åˆ°æ‰“å°ç»“æœå¤šäº† Tap 2ã€‚ä½†ä¸ Cold Observable ä¸åŒçš„æ˜¯ï¼Œç¬¬äºŒä¸ªè®¢é˜…è€…ä¸ä¼šæ”¶åˆ°ä¹‹å‰ä¸‰æ¬¡çš„ç‚¹å‡»äº‹ä»¶ã€‚</p>
<p>æˆ‘ä»¬å¦‚æœå°† <code>button.rx.tap</code> æ›¿æ¢æˆ Cold Observablesï¼Œå¯ä»¥çœ‹åˆ°æ‰“å°ç»“æœæœ‰ 5 ä¸ª Tap 2 ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> tap = <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.create &#123; (observer) -&gt; <span class="type">Disposable</span> <span class="keyword">in</span></div><div class="line">    observer.onNext(<span class="number">1</span>)</div><div class="line">    observer.onNext(<span class="number">2</span>)</div><div class="line">    observer.onNext(<span class="number">3</span>)</div><div class="line">    observer.onNext(<span class="number">4</span>)</div><div class="line">    observer.onNext(<span class="number">5</span>)</div><div class="line">    <span class="keyword">return</span> <span class="type">Disposables</span>.create()</div><div class="line">    &#125;.<span class="built_in">map</span>(&#123;<span class="number">_</span> <span class="keyword">in</span>&#125;)</div><div class="line">    </div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">43</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">47</span>]ï¼š<span class="type">Tap</span> <span class="number">1</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">43</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">47</span>]ï¼š<span class="type">Tap</span> <span class="number">1</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">43</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">47</span>]ï¼š<span class="type">Tap</span> <span class="number">1</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">43</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">47</span>]ï¼š<span class="type">Tap</span> <span class="number">1</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">43</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">47</span>]ï¼š<span class="type">Tap</span> <span class="number">1</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">46</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">52</span>]ï¼š<span class="type">Tap</span> <span class="number">2</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">46</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">52</span>]ï¼š<span class="type">Tap</span> <span class="number">2</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">46</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">52</span>]ï¼š<span class="type">Tap</span> <span class="number">2</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">46</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">52</span>]ï¼š<span class="type">Tap</span> <span class="number">2</span></div><div class="line">[<span class="number">2018</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">18</span>:<span class="number">24</span>:<span class="number">46</span> <span class="type">ViewController</span>.swift viewDidLoad() <span class="number">52</span>]ï¼š<span class="type">Tap</span> <span class="number">2</span></div></pre></td></tr></table></figure>
<p>å‚è€ƒï¼š</p>
<p><a href="https://beeth0ven.github.io/RxSwift-Chinese-Documentation/" target="_blank" rel="external">https://beeth0ven.github.io/RxSwift-Chinese-Documentation/</a><br><a href="https://medium.com/@DianQK/hot-observable%E5%92%8Ccold-observable-c3ba8d07867b" target="_blank" rel="external">https://medium.com/@DianQK/hot-observable%E5%92%8Ccold-observable-c3ba8d07867b</a><br><a href="https://juejin.im/entry/57f29c46da2f60004f68f663" target="_blank" rel="external">https://juejin.im/entry/57f29c46da2f60004f68f663</a><br><a href="https://github.com/ReactiveX/RxSwift/tree/master/Documentation" target="_blank" rel="external">https://github.com/ReactiveX/RxSwift/tree/master/Documentation</a><br><a href="https://github.com/Joe0708/RxSwift-Tutorial" target="_blank" rel="external">https://github.com/Joe0708/RxSwift-Tutorial</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç¯å¢ƒï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Xcode 9.1&lt;br&gt;Swift 4.0&lt;br&gt;RxSwift 4.0                                                                            
    
    </summary>
    
    
      <category term="RxSwift" scheme="http://yoursite.com/tags/RxSwift/"/>
    
  </entry>
  
  <entry>
    <title>Swift çŸ¥è¯†å°é›†</title>
    <link href="http://yoursite.com/2017/12/07/swift-tips/"/>
    <id>http://yoursite.com/2017/12/07/swift-tips/</id>
    <published>2017-12-07T13:28:02.000Z</published>
    <updated>2018-02-13T09:03:28.312Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹å†…å®¹å‡æ˜¯ç¬”è€…å­¦ä¹ è¿‡ç¨‹ä¸­<strong>æ”¶é›†</strong>çš„çŸ¥è¯†ç‚¹ï¼Œé¡ºåºæ¯”è¾ƒè·³è·ƒï¼Œåˆè¡·æ˜¯ä¸ºäº†æ–¹ä¾¿æŸ¥é˜…ï¼Œé¡ºä¾¿åŠ æ·±è®°å¿†ã€‚<strong>å†…å®¹ä¼šä¸æ–­æ›´æ–°</strong>ï¼Œå¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜æˆ–è€…æœ‰å¥½çš„ Swift æ–¹é¢çš„è¯­æ³•ç³–æˆ–è€…çŸ¥è¯†ç‚¹ä¹Ÿå¯ä»¥æå‡ºæ¥ï¼Œæˆ‘ä¼šæŒ‘é€‰æ–Ÿé…Œåæ”¶å½•ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ï½</p>
<p><strong>ç¯å¢ƒï¼š</strong></p>
<blockquote>
<p>Swift 4.0<br>Xcode 9.1</p>
</blockquote>
<p><strong>æœ€è¿‘æ›´æ–°ï¼š2018.01.09</strong></p>
<blockquote>
<p><a href="#1.4.0">å–æ¶ˆ asyncAfter ä¸­å»¶è¿Ÿçš„äº‹ä»¶</a><br><a href="#1.3.9">for in å’Œ forEach çš„åŒºåˆ«</a><br><a href="#1.3.8">è®¿é—®çº§åˆ«</a><br><a href="#1.3.7">å‡ ç§éå†æ–¹å¼</a><br><a href="#1.3.6">weakSelf å’Œ strongSelf</a></p>
</blockquote>
<p><strong>æ›´æ–°ï¼š2017.12.13</strong></p>
<blockquote>
<p><a href="#1.3.5">ä¼˜é›…çš„å®šä¹‰é€šçŸ¥åç§°</a></p>
</blockquote>
<p><strong>æ›´æ–°ï¼š2017.12.11</strong></p>
<blockquote>
<p><a href="#1.3.4">æ ‡ç­¾è¯­å¥ï¼šæŒ‡å®šè·³å‡ºæŸä¸ªæ¡ä»¶è¯­å¥</a><br><a href="#1.3.3">å€’åº reversed()</a><br><a href="#1.3.2">ä½œç”¨åŸŸï¼šdo è¯­å¥å—</a></p>
</blockquote>
<p><strong>æ›´æ–°ï¼š2017.12.08</strong></p>
<blockquote>
<p><a href="#1.3.1">Swift ä¸­çš„ â€œreadonlyâ€</a><br><a href="#1.3.0">è‡ªå®šä¹‰æ—¥å¿—è¾“å‡º</a><br><a href="#1.2.9">Swift ä¸­çš„ â€œ@synchronizedâ€</a></p>
</blockquote>
<p><strong>ç›®å½•ï¼š</strong></p>
<blockquote>
<p><a href="#1.1.1">Associated Object</a><br><a href="#1.1.2">Delegate å£°æ˜ä¸º weak</a><br><a href="#1.1.3">å¯é€‰åè®®å’Œåè®®æ‰©å±•</a><br><a href="#1.1.4">å•ä¾‹</a><br><a href="#1.1.5">è¾“å‡ºæ ¼å¼åŒ–</a><br><a href="#1.1.6">Selector</a><br><a href="#1.1.7">å°† protocol çš„æ–¹æ³•å£°æ˜ä¸º mutating</a><br><a href="#1.1.8">æ•°ç»„éå† enumerate</a><br><a href="#1.1.9">è¾“å…¥è¾“å‡ºå‚æ•° inout</a><br><a href="#1.2.0">Default å‚æ•°</a><br><a href="#1.2.1">å»¶è¿ŸåŠ è½½ lazy</a><br><a href="#1.2.2">ç¼–è¯‘æ ‡è®°</a><br><a href="#1.2.3">æ¢è¡Œç¬¦</a><br><a href="#1.2.4">å­—ç¬¦ä¸²åˆ‡å‰² split</a><br><a href="#1.2.5">KVC</a><br><a href="#1.2.6">Swift ä¸­å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹æ³¨æ„ç‚¹</a><br><a href="#1.2.7">KVO</a><br><a href="#1.2.8">Swift UIButton çŠ¶æ€çš„å åŠ </a><br><a href="#1.2.9">Swift ä¸­çš„ â€œ@synchronizedâ€</a><br><a href="#1.3.0">è‡ªå®šä¹‰æ—¥å¿—è¾“å‡º</a><br><a href="#1.3.1">Swift ä¸­çš„ â€œreadonlyâ€</a><br><a href="#1.3.2">ä½œç”¨åŸŸï¼šdo è¯­å¥å—</a><br><a href="#1.3.3">å€’åº reversed()</a><br><a href="#1.3.4">æ ‡ç­¾è¯­å¥ï¼šæŒ‡å®šè·³å‡ºæŸä¸ªæ¡ä»¶è¯­å¥</a><br><a href="#1.3.5">ä¼˜é›…çš„å®šä¹‰é€šçŸ¥åç§°</a><br><a href="#1.3.6">weakSelf å’Œ strongSelf</a><br><a href="#1.3.7">å‡ ç§éå†æ–¹å¼</a><br><a href="#1.3.8">è®¿é—®çº§åˆ«</a><br><a href="#1.3.9">for in å’Œ forEach çš„åŒºåˆ«</a><br><a href="#1.4.0">å–æ¶ˆ asyncAfter ä¸­å»¶è¿Ÿçš„äº‹ä»¶</a></p>
</blockquote>
<h2 id="1.1.1"> Associated Object </h2>

<p>Objective-C çš„ runtime é‡Œçš„ Associated Object å…è®¸æˆ‘ä»¬åœ¨ä½¿ç”¨ Category æ‰©å±•ç°æœ‰çš„ç±»çš„åŠŸèƒ½çš„æ—¶å€™ï¼Œç›´æ¥æ·»åŠ å®ä¾‹å˜é‡ã€‚åœ¨ Swift ä¸­ extension ä¸èƒ½æ·»åŠ <strong>å­˜å‚¨å±æ€§</strong>ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Associated Object æ¥å®ç°ï¼Œæ¯”å¦‚ä¸‹é¢çš„ <code>title</code> ã€Œå®é™…ä¸Šã€æ˜¯ä¸€ä¸ªå­˜å‚¨å±æ€§ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// MyClass.swift</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="comment">// MyClassExtension.swift</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">var</span> key: <span class="type">Void</span>?</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MyClass</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> title: <span class="type">String</span>? &#123;</div><div class="line">        <span class="keyword">get</span> &#123;</div><div class="line">            <span class="keyword">return</span> swift_getAssociatedObject(<span class="keyword">self</span>, &amp;key) <span class="keyword">as</span>? <span class="type">String</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">set</span> &#123;</div><div class="line">            swift_setAssociatedObject(<span class="keyword">self</span>,</div><div class="line">                &amp;key, newValue,</div><div class="line">                .swift_ASSOCIATION_RETAIN_NONATOMIC)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æµ‹è¯•</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">printTitle</span><span class="params">(<span class="number">_</span> input: MyClass)</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> <span class="keyword">let</span> title = input.title &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"Title: \(title)"</span>)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"æ²¡æœ‰è®¾ç½®"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> a = <span class="type">MyClass</span>()</div><div class="line">printTitle(a)</div><div class="line">a.title = <span class="string">"Swifter.tips"</span></div><div class="line">printTitle(a)</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// æ²¡æœ‰è®¾ç½®</span></div><div class="line"><span class="comment">// Title: Swifter.tipsâ€</span></div></pre></td></tr></table></figure>
<h2 id="1.1.2"> Delegate å£°æ˜ä¸º weak </h2>

<p>Swift ä¸­ Delegate éœ€è¦è¢«å£°æ˜æˆ <code>weak</code>ï¼Œæ¥é¿å…è®¿é—®åˆ°å·²è¢«å›æ”¶çš„å†…å­˜è€Œå¯¼è‡´å´©æºƒï¼Œå¦‚æœæˆ‘ä»¬åƒä¸‹é¢è¿™æ ·ï¼Œæ˜¯ç¼–è¯‘ä¸è¿‡çš„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">MyClassDelegate</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">method</span><span class="params">()</span></span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</div><div class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> delegate: <span class="type">MyClassDelegate</span>?</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">MyClassDelegate</span> </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="keyword">var</span> someInstance: <span class="type">MyClass</span>!</div><div class="line"></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line"></div><div class="line">        someInstance = <span class="type">MyClass</span>()</div><div class="line">        someInstance.delegate = <span class="keyword">self</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">method</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"Do something"</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘å¤±è´¥</span></div><div class="line"><span class="comment">// 'weak' may only be applied to class and class-bound protocol types, not 'MyClassDelegate'</span></div></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸º Swift çš„ protocol æ˜¯å¯ä»¥è¢«é™¤äº† class ä»¥å¤–çš„å…¶ä»–ç±»å‹éµå®ˆçš„ï¼Œè€Œå¯¹äºåƒ <code>struct</code> æˆ–æ˜¯ <code>enum</code> è¿™æ ·çš„ç±»å‹ï¼Œæœ¬èº«å°±ä¸é€šè¿‡å¼•ç”¨è®¡æ•°æ¥ç®¡ç†å†…å­˜ï¼Œæ‰€ä»¥ä¹Ÿä¸å¯èƒ½ç”¨ <code>weak</code> è¿™æ ·çš„ ARC çš„æ¦‚å¿µæ¥è¿›è¡Œä¿®é¥°ã€‚</p>
<p>æƒ³è¦åœ¨ Swift ä¸­ä½¿ç”¨ weak delegateï¼Œæˆ‘ä»¬å°±éœ€è¦å°† protocol é™åˆ¶åœ¨ class å†…ï¼š</p>
<ul>
<li>ä¸€ç§åšæ³•æ˜¯å°† protocol å£°æ˜ä¸º Objective-C çš„ï¼Œè¿™å¯ä»¥é€šè¿‡åœ¨ protocol å‰é¢åŠ ä¸Š <code>@objc</code> å…³é”®å­—æ¥è¾¾åˆ°ï¼ŒObjective-C çš„ protocol éƒ½åªæœ‰ç±»èƒ½å®ç°ï¼Œå› æ­¤ä½¿ç”¨ weak æ¥ä¿®é¥°å°±åˆç†äº†ï¼š</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@objc</span> <span class="class"><span class="keyword">protocol</span> <span class="title">MyClassDelegate</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">method</span><span class="params">()</span></span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>å¦ä¸€ç§<strong>å¯èƒ½æ›´å¥½</strong>çš„åŠæ³•æ˜¯åœ¨ protocol å£°æ˜çš„åå­—åé¢åŠ ä¸Š <code>class</code>ï¼Œè¿™å¯ä»¥ä¸ºç¼–è¯‘å™¨æ˜¾å¼åœ°æŒ‡æ˜è¿™ä¸ª protocol åªèƒ½ç”± <code>class</code> æ¥å®ç°ï¼Œé¿å…äº†è¿‡å¤šçš„ä¸å¿…è¦çš„ Objective-C å…¼å®¹ï¼š</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">MyClassDelegate</span>: <span class="title">class</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">method</span><span class="params">()</span></span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="1.1.3"> å¯é€‰åè®®å’Œåè®®æ‰©å±• </h2>

<p>Objective-C ä¸­çš„ protocol é‡Œå­˜åœ¨ <code>@optional</code> å…³é”®å­—ï¼Œè¢«è¿™ä¸ªå…³é”®å­—ä¿®é¥°çš„æ–¹æ³•å¹¶éå¿…é¡»è¦è¢«å®ç°ï¼ŒåŸç”Ÿçš„ Swift protocol é‡Œæ²¡æœ‰å¯é€‰é¡¹ï¼Œæ‰€æœ‰å®šä¹‰çš„æ–¹æ³•éƒ½æ˜¯å¿…é¡»å®ç°çš„ï¼Œå¦‚æœä¸æ˜¯å®ç°æ˜¯æ— æ³•ç¼–è¯‘çš„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>,<span class="title">MyProtocol</span> </span>&#123; &#125;</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘å¤±è´¥</span></div><div class="line"><span class="comment">// Type 'ViewController' does not conform to protocol 'MyProtocol'</span></div></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦åƒ Objective-C é‡Œé‚£æ ·å®šä¹‰å¯é€‰çš„åè®®æ–¹æ³•ï¼Œå°±éœ€è¦å°†åè®®æœ¬èº«å’Œå¯é€‰æ–¹æ³•éƒ½å®šä¹‰ä¸º Objective-C çš„ï¼Œä¹Ÿå³åœ¨ protocol å®šä¹‰ä¹‹å‰åŠ ä¸Š <code>@objc</code>ï¼Œæ–¹æ³•ä¹‹å‰åŠ ä¸Š <code>@objc optional</code>ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@objc</span> <span class="class"><span class="keyword">protocol</span> <span class="title">MyProtocol</span> </span>&#123;</div><div class="line">    <span class="meta">@objc</span> <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">myMethod</span><span class="params">()</span></span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œå¯¹äºæ‰€æœ‰çš„å£°æ˜ï¼Œå®ƒä»¬çš„å‰ç¼€ä¿®é¥°æ˜¯å®Œå…¨åˆ†å¼€çš„ï¼Œ<strong>ä¹Ÿå°±æ˜¯è¯´ä½ ä¸èƒ½åƒæ˜¯åœ¨ Objective-C é‡Œé‚£æ ·ç”¨ä¸€ä¸ª <code>@optional</code> æŒ‡å®šæ¥ä¸‹æ¥çš„è‹¥å¹²ä¸ªæ–¹æ³•éƒ½æ˜¯å¯é€‰çš„äº†ï¼Œ</strong>å¿…é¡»å¯¹æ¯ä¸€ä¸ªå¯é€‰æ–¹æ³•æ·»åŠ å‰ç¼€ï¼Œå¯¹äºæ²¡æœ‰å‰ç¼€çš„æ–¹æ³•æ¥è¯´ï¼Œå®ƒä»¬æ˜¯é»˜è®¤å¿…é¡»å®ç°çš„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@objc</span> <span class="class"><span class="keyword">protocol</span> <span class="title">MyProtocol</span> </span>&#123;</div><div class="line">    <span class="meta">@objc</span> <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">optionalMethod</span><span class="params">()</span></span>        <span class="comment">// å¯é€‰</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">necessaryMethod</span><span class="params">()</span></span>                      <span class="comment">// å¿…é¡»</span></div><div class="line">    <span class="meta">@objc</span> <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">anotherOptionalMethod</span><span class="params">()</span></span> <span class="comment">// å¯é€‰</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>ä¸€ä¸ªä¸å¯é¿å…çš„é™åˆ¶æ˜¯</strong>ï¼Œä½¿ç”¨ <code>@objc</code> ä¿®é¥°çš„ protocol å°±åªèƒ½è¢« <code>class</code> å®ç°äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äº <code>struct</code> å’Œ <code>enum</code> ç±»å‹ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•ä»¤å®ƒä»¬æ‰€å®ç°çš„åè®®ä¸­å«æœ‰å¯é€‰æ–¹æ³•æˆ–è€…å±æ€§çš„ã€‚å¦å¤–ï¼Œå®ç°å®ƒçš„ <code>class</code> ä¸­çš„æ–¹æ³•è¿˜å¿…é¡»ä¹Ÿè¢«æ ‡æ³¨ä¸º <code>@objc</code>ï¼Œæˆ–è€…æ•´ä¸ªç±»å°±æ˜¯ç»§æ‰¿è‡ª <code>NSObject</code>ã€‚å¯¹äºè¿™ç§é—®é¢˜ï¼Œåœ¨ Swift 2.0 ä¸­ï¼Œæˆ‘ä»¬æœ‰äº†å¦ä¸€ç§é€‰æ‹©ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ <strong>protocol extension</strong>ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å£°æ˜ä¸€ä¸ª protocol ä¹‹åå†ç”¨ extension çš„æ–¹å¼ç»™å‡ºéƒ¨åˆ†æ–¹æ³•<strong>é»˜è®¤çš„å®ç°</strong>ï¼Œè¿™æ ·è¿™äº›æ–¹æ³•åœ¨å®é™…çš„ç±»ä¸­å°±æ˜¯å¯é€‰å®ç°çš„äº†ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">MyProtocol</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">optionalMethod</span><span class="params">()</span></span>        <span class="comment">// å¯é€‰</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">necessaryMethod</span><span class="params">()</span></span>       <span class="comment">// å¿…é¡»</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">anotherOptionalMethod</span><span class="params">()</span></span> <span class="comment">// å¯é€‰</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MyProtocol</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//é»˜è®¤çš„å¯é€‰å®ç°</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">optionalMethod</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"optionalMethod"</span>)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//é»˜è®¤çš„å¯é€‰å®ç°</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">anotherOptionalMethod</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"anotherOptionalMethod"</span>)</div><div class="line">    &#125;   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>,<span class="title">MyProtocol</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="comment">// å¿…é¡»çš„å®ç°</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">necessaryMethod</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"necessaryMethod"</span>)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        </div><div class="line">        <span class="keyword">self</span>.optionalMethod();</div><div class="line">        <span class="keyword">self</span>.necessaryMethod();</div><div class="line">        <span class="keyword">self</span>.anotherOptionalMethod();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// optionalMethod</span></div><div class="line"><span class="comment">// necessaryMethod</span></div><div class="line"><span class="comment">// necessaryMethod</span></div></pre></td></tr></table></figure>
<h2 id="1.1.4"> å•ä¾‹ </h2>

<p>Swift ä¸­çš„å•ä¾‹éå¸¸ç®€å•ï¼ŒSwift 1.2 ä»¥åŠä¹‹åï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>  </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">let</span> sharedInstance = <span class="type">Singleton</span>()</div><div class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ç§å†™æ³•ä¸ä½†æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿæ˜¯æ‡’åŠ è½½çš„ï¼Œ<code>let</code> å®šä¹‰çš„å±æ€§æœ¬èº«å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒåŒæ—¶ <code>static</code> å®šä¹‰çš„æ˜¯ä¸€ä¸ª class constantï¼Œæ‹¥æœ‰å…¨å±€ä½œç”¨åŸŸå’Œæ‡’åŠ è½½ç‰¹æ€§ã€‚</p>
<p>å¦å¤–ï¼Œè¿™ä¸ªç±»å‹ä¸­åŠ å…¥äº†ä¸€ä¸ªç§æœ‰çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œæ¥è¦†ç›–é»˜è®¤çš„å…¬å¼€åˆå§‹åŒ–æ–¹æ³•ï¼Œè¿™è®©é¡¹ç›®ä¸­çš„å…¶ä»–åœ°æ–¹ä¸èƒ½å¤Ÿé€šè¿‡ init æ¥ç”Ÿæˆè‡ªå·±çš„ <code>Singleton</code> å®ä¾‹ï¼Œä¹Ÿä¿è¯äº†ç±»å‹å•ä¾‹çš„å”¯ä¸€æ€§ã€‚å¦‚æœä½ éœ€è¦çš„æ˜¯ç±»ä¼¼ default çš„å½¢å¼çš„å•ä¾‹ (ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªç±»çš„ä½¿ç”¨è€…å¯ä»¥åˆ›å»ºè‡ªå·±çš„å®ä¾‹) çš„è¯ï¼Œå¯ä»¥å»æ‰è¿™ä¸ªç§æœ‰çš„ <code>init</code> æ–¹æ³•ã€‚</p>
<h2 id="1.1.5"> è¾“å‡ºæ ¼å¼åŒ– </h2>

<p>åœ¨ Objective-C ä¸­çš„ <code>%@</code> è¿™æ ·çš„æ ¼å¼åœ¨æŒ‡å®šçš„ä½ç½®è®¾å®šå ä½ç¬¦ï¼Œç„¶åé€šè¿‡å‚æ•°çš„æ–¹å¼å°†å®é™…è¦è¾“å‡ºçš„å†…å®¹è¡¥å……å®Œæ•´ã€‚ä¾‹å¦‚ Objective-C ä¸­å¸¸ç”¨çš„å‘æ§åˆ¶å°è¾“å‡ºçš„ <code>NSLog</code> æ–¹æ³•å°±ä½¿ç”¨äº†è¿™ç§æ ¼å¼åŒ–æ–¹æ³•ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">float a = <span class="number">1.234567</span>;</div><div class="line"><span class="type">NSString</span> *b = @<span class="string">"Helllo"</span>;</div><div class="line"><span class="type">NSLog</span>(@<span class="string">"floatï¼š%.2f  strï¼š%p"</span>,a,b);</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// floatï¼š1.23  strï¼š0x1024a1078</span></div></pre></td></tr></table></figure>
<p>å¯¹åº” Swift ä¸­æˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> a = <span class="number">1.234567</span></div><div class="line"><span class="keyword">let</span> b = <span class="string">"Helllo"</span></div><div class="line"><span class="keyword">let</span> <span class="built_in">c</span> = <span class="type">String</span>(format:<span class="string">"floatï¼š%.2f strï¼š%p"</span>,a,b)</div><div class="line"><span class="built_in">print</span>(<span class="built_in">c</span>)</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// floatï¼š1.23 strï¼š0x604000249e10</span></div></pre></td></tr></table></figure>
<h2 id="1.1.6"> Selector </h2>

<p><code>@selector</code> æ˜¯ Objective-C æ—¶ä»£çš„ä¸€ä¸ªå…³é”®å­—ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªæ–¹æ³•è½¬æ¢å¹¶èµ‹å€¼ç»™ä¸€ä¸ª SEL ç±»å‹ï¼Œå®ƒçš„è¡¨ç°å¾ˆç±»ä¼¼ä¸€ä¸ªåŠ¨æ€çš„å‡½æ•°æŒ‡é’ˆã€‚åœ¨ Swift ä¸­æ²¡æœ‰ <code>@selector</code> äº†ï¼Œå–è€Œä»£ä¹‹ï¼Œä» Swift 2.2 å¼€å§‹æˆ‘ä»¬ä½¿ç”¨ <code>#selector</code> æ¥ä»æš´éœ²ç»™ Objective-C çš„ä»£ç ä¸­è·å–ä¸€ä¸ª <code>selector</code>ï¼Œå¹¶ä¸”å› ä¸º <code>selector</code> æ˜¯ Objective-C runtime çš„æ¦‚å¿µï¼Œåœ¨ Swift 4 ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„ Swift æ–¹æ³•åœ¨ Objective-C ä¸­éƒ½æ˜¯ä¸å¯è§çš„ï¼Œæ‰€ä»¥ä½ éœ€è¦åœ¨è¿™ç±»æ–¹æ³•å‰é¢åŠ ä¸Š <code>@objc</code> å…³é”®å­—ï¼Œå°†è¿™ä¸ªæ–¹æ³•æš´éœ²ç»™ Objective-Cï¼Œæ‰èƒ½è¿›è¡Œä½¿ç”¨ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> btn = <span class="type">UIButton</span>.<span class="keyword">init</span>(type: .system)</div><div class="line">btn.backgroundColor = <span class="type">UIColor</span>.red</div><div class="line">btn.frame = <span class="type">CGRect</span>(x: <span class="number">100</span>, y: <span class="number">100</span>, width: <span class="number">150</span>, height: <span class="number">40</span>)</div><div class="line">btn.setTitle(<span class="string">"Button"</span>, <span class="keyword">for</span>: .normal)</div><div class="line"><span class="comment">//æ— å‚æ•°</span></div><div class="line">btn.addTarget(<span class="keyword">self</span>, action: #selector(btnClick), <span class="keyword">for</span>: .touchUpInside)</div><div class="line">view.addSubview(btn)</div><div class="line"></div><div class="line"><span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">btnClick</span><span class="params">()</span></span>  &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"button click !"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="comment">//æœ‰å‚æ•°</span></div><div class="line">btn.addTarget(<span class="keyword">self</span>, action: #selector(btnClick(<span class="number">_</span> :)), <span class="keyword">for</span>: .touchUpInside)</div><div class="line">...</div><div class="line"></div><div class="line"><span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">btnClick</span><span class="params">(<span class="number">_</span> button: UIButton)</span></span>  &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"button click !"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="1.1.7"> å°† protocol çš„æ–¹æ³•å£°æ˜ä¸º mutating </h2>

<p>Swift çš„ protocol ä¸ä»…å¯ä»¥è¢« class ç±»å‹å®ç°ï¼Œä¹Ÿé€‚ç”¨äº <code>struct</code> å’Œ <code>enum</code>ï¼Œå› ä¸ºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬åœ¨å†™ç»™åˆ«äººç”¨çš„åè®®æ—¶éœ€è¦å¤šè€ƒè™‘æ˜¯å¦ä½¿ç”¨ <code>mutating</code> æ¥ä¿®é¥°æ–¹æ³•ã€‚Swift çš„ <code>mutating</code> å…³é”®å­—ä¿®é¥°æ–¹æ³•æ˜¯ä¸ºäº†èƒ½åœ¨è¯¥æ–¹æ³•ä¸­ä¿®æ”¹ <code>struct</code> æˆ–æ˜¯ <code>enum</code> çš„å˜é‡ï¼Œæ‰€ä»¥å¦‚æœä½ æ²¡åœ¨åè®®æ–¹æ³•é‡Œå†™ <code>mutating</code> çš„è¯ï¼Œåˆ«äººå¦‚æœç”¨ <code>struct</code> æˆ–è€… <code>enum</code> æ¥å®ç°è¿™ä¸ªåè®®çš„è¯ï¼Œå°±ä¸èƒ½åœ¨æ–¹æ³•é‡Œæ”¹å˜è‡ªå·±çš„å˜é‡äº†ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç æ˜¯ç¼–è¯‘ä¸è¿‡çš„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Vehicle</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">changeColor</span><span class="params">()</span></span></div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyCar</span>: <span class="title">Vehicle</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> color = <span class="string">"blue"</span></div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">changeColor</span><span class="params">()</span></span> &#123;</div><div class="line">        color = <span class="string">"red"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘å¤±è´¥</span></div><div class="line"><span class="comment">// Cannot assign to property: 'self' is immutable</span></div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åº”è¯¥åŠ ä¸Š <code>mutating</code> å…³é”®å­—ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Vehicle</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">changeColor</span><span class="params">()</span></span></div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyCar</span>: <span class="title">Vehicle</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> color = <span class="string">"blue"</span></div><div class="line">    </div><div class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">changeColor</span><span class="params">()</span></span> &#123;</div><div class="line">        color = <span class="string">"red"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">super</span>.viewDidLoad()</div><div class="line"></div><div class="line">    <span class="keyword">var</span> car = <span class="type">MyCar</span>()</div><div class="line">    <span class="built_in">print</span>(car.color)</div><div class="line">    car.changeColor()</div><div class="line">    <span class="built_in">print</span>(car.color)    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// blue</span></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// red</span></div></pre></td></tr></table></figure>
<h2 id="1.1.8"> æ•°ç»„éå† enumerate </h2>

<p>ä½¿ç”¨ NSArray æ—¶ä¸€ä¸ªå¾ˆå¸¸é‡è§çš„çš„éœ€æ±‚æ˜¯åœ¨æšä¸¾æ•°ç»„å†…å…ƒç´ çš„åŒæ—¶ä¹Ÿæƒ³ä½¿ç”¨å¯¹åº”çš„<strong>ä¸‹æ ‡ç´¢å¼•</strong>ï¼Œåœ¨ Objective-C ä¸­æœ€æ–¹ä¾¿çš„æ–¹å¼æ˜¯ä½¿ç”¨ NSArray çš„ <code>enumerateObjectsUsingBlock:</code> ï¼Œåœ¨ Swift ä¸­å­˜åœ¨ä¸€ä¸ªæ•ˆç‡ï¼Œå®‰å…¨æ€§å’Œå¯è¯»æ€§éƒ½å¾ˆå¥½çš„æ›¿ä»£ï¼Œé‚£å°±æ˜¯å¿«é€Ÿæšä¸¾æŸä¸ªæ•°ç»„çš„<code>EnumerateGenerator</code>ï¼Œå®ƒçš„å…ƒç´ æ˜¯åŒæ—¶åŒ…å«äº†å…ƒç´ ä¸‹æ ‡ç´¢å¼•ä»¥åŠå…ƒç´ æœ¬èº«çš„å¤šå…ƒç»„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> arr = [<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"d"</span>,<span class="string">"e"</span>]</div><div class="line"><span class="keyword">for</span> (idx, str) <span class="keyword">in</span> arr.enumerated() &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"idx: \(idx) str: \(str)"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line">idx: <span class="number">0</span> str: a</div><div class="line">idx: <span class="number">1</span> str: b</div><div class="line">idx: <span class="number">2</span> str: <span class="built_in">c</span></div><div class="line">idx: <span class="number">3</span> str: d</div><div class="line">idx: <span class="number">4</span> str: e</div></pre></td></tr></table></figure>
<h2 id="1.1.9"> è¾“å…¥è¾“å‡ºå‚æ•° inout </h2>

<p>å‡½æ•°å‚æ•°é»˜è®¤æ˜¯<strong>å¸¸é‡</strong>ï¼Œå¦‚æœè¯•å›¾åœ¨å‡½æ•°ä½“ä¸­æ›´æ”¹å‚æ•°å€¼å°†ä¼šå¯¼è‡´<strong>ç¼–è¯‘é”™è¯¯</strong>ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­å°è¯•ç€äº¤æ¢å€¼ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">swapTwoInts</span><span class="params">(<span class="number">_</span> a: Int, <span class="number">_</span> b: Int)</span></span> &#123;</div><div class="line">    <span class="keyword">let</span> temporaryA = a</div><div class="line">    a = b</div><div class="line">    b = temporaryA</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘å¤±è´¥</span></div><div class="line"><span class="comment">// Cannot assign to value: 'a' is a 'let' constant</span></div><div class="line"><span class="comment">// Cannot assign to value: 'b' is a 'let' constant</span></div></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³è¦ä¸€ä¸ªå‡½æ•°å¯ä»¥ä¿®æ”¹å‚æ•°çš„å€¼ï¼Œå¹¶ä¸”æƒ³è¦åœ¨è¿™äº›ä¿®æ”¹åœ¨å‡½æ•°è°ƒç”¨ç»“æŸåä»ç„¶å­˜åœ¨ï¼Œé‚£ä¹ˆå°±åº”è¯¥æŠŠè¿™ä¸ªå‚æ•°å®šä¹‰ä¸ºè¾“å…¥è¾“å‡ºå‚æ•°ï¼ˆIn-Out Parametersï¼‰ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">swapTwoInts</span><span class="params">(<span class="number">_</span> a: <span class="keyword">inout</span> Int, <span class="number">_</span> b: <span class="keyword">inout</span> Int)</span></span> &#123;</div><div class="line">    <span class="keyword">let</span> temporaryA = a</div><div class="line">    a = b</div><div class="line">    b = temporaryA</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="1.2.0"> Default å‚æ•° </h2>

<p>Swift çš„æ–¹æ³•æ˜¯æ”¯æŒé»˜è®¤å‚æ•°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å£°æ˜æ–¹æ³•æ—¶ï¼Œå¯ä»¥ç»™æŸä¸ªå‚æ•°æŒ‡å®šä¸€ä¸ªé»˜è®¤ä½¿ç”¨çš„å€¼ã€‚åœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶è¦æ˜¯ä¼ å…¥äº†è¿™ä¸ªå‚æ•°ï¼Œåˆ™ä½¿ç”¨ä¼ å…¥çš„å€¼ï¼Œå¦‚æœç¼ºå°‘è¿™ä¸ªè¾“å…¥å‚æ•°ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨è®¾å®šçš„é»˜è®¤å€¼è¿›è¡Œè°ƒç”¨ã€‚å’Œå…¶ä»–å¾ˆå¤šè¯­è¨€çš„é»˜è®¤å‚æ•°ç›¸æ¯”è¾ƒï¼ŒSwift ä¸­çš„é»˜è®¤å‚æ•°é™åˆ¶æ›´å°‘ï¼Œå¹¶æ²¡æœ‰æ‰€è°“ <strong>â€œé»˜è®¤å‚æ•°ä¹‹åä¸èƒ½å†å‡ºç°æ— é»˜è®¤å€¼çš„å‚æ•°â€</strong>è¿™æ ·çš„è§„åˆ™ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢ä¸¤ç§æ–¹æ³•çš„å£°æ˜åœ¨ Swift é‡Œéƒ½æ˜¯åˆæ³•å¯ç”¨çš„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello1</span><span class="params">(str1: String = <span class="string">"Hello"</span>, str2: String, str3: String)</span></span> &#123;</div><div class="line">    <span class="built_in">print</span>(str1 + str2 + str3)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello2</span><span class="params">(str1: String, str2: String, str3: String = <span class="string">"World"</span>)</span></span> &#123;</div><div class="line">    <span class="built_in">print</span>(str1 + str2 + str3)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sayHello1(str2: <span class="string">" "</span>, str3: <span class="string">"World"</span>)</div><div class="line">sayHello2(str1: <span class="string">"Hello"</span>, str2: <span class="string">" "</span>)</div><div class="line"></div><div class="line"><span class="comment">//è¾“å‡ºéƒ½æ˜¯ Hello World</span></div></pre></td></tr></table></figure>
<h2 id="1.2.1"> å»¶è¿ŸåŠ è½½ lazy </h2>

<p>å»¶æ—¶åŠ è½½æˆ–è€…è¯´å»¶æ—¶åˆå§‹åŒ–æ˜¯å¾ˆå¸¸ç”¨çš„ä¼˜åŒ–æ–¹æ³•ï¼Œåœ¨æ„å»ºå’Œç”Ÿæˆæ–°çš„å¯¹è±¡çš„æ—¶å€™ï¼Œå†…å­˜åˆ†é…ä¼šåœ¨è¿è¡Œæ—¶è€—è´¹ä¸å°‘æ—¶é—´ï¼Œ<strong>å¦‚æœæœ‰ä¸€äº›å¯¹è±¡çš„å±æ€§å’Œå†…å®¹éå¸¸å¤æ‚çš„è¯ï¼Œè¿™ä¸ªæ—¶é—´æ›´æ˜¯ä¸å¯å¿½ç•¥</strong>ã€‚å¦å¤–ï¼Œæœ‰äº›æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸ä¼šç«‹å³ç”¨åˆ°ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹åˆå§‹åŒ–æ—¶ï¼Œ<strong>é‚£äº›åœ¨ç‰¹å®šç¯å¢ƒä¸‹ä¸è¢«ä½¿ç”¨çš„å­˜å‚¨å±æ€§ï¼Œä¹Ÿä¸€æ ·è¦è¢«åˆå§‹åŒ–å’Œèµ‹å€¼</strong>ï¼Œä¹Ÿæ˜¯ä¸€ç§æµªè´¹ã€‚åœ¨ Objective-C ä¸­ï¼Œä¸€ä¸ªå»¶è¿ŸåŠ è½½ä¸€èˆ¬æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ClassA.h</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *testString;</div><div class="line"></div><div class="line"><span class="comment">// ClassA.m</span></div><div class="line">- (<span class="built_in">NSString</span> *)testString &#123;</div><div class="line">     <span class="keyword">if</span> (!_testString) &#123;</div><div class="line">         _testString = <span class="string">@"Hello"</span>;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"åªåœ¨é¦–æ¬¡è®¿é—®è¾“å‡º"</span>);</div><div class="line">     &#125;</div><div class="line">     <span class="keyword">return</span> _testString;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯¹åº”åœ¨ Swift ä¸­ï¼Œä½¿ç”¨ <code>lazy</code> ä½œä¸ºå±æ€§ä¿®é¥°ç¬¦æ—¶ï¼Œåªèƒ½å£°æ˜å±æ€§æ˜¯<strong>å˜é‡</strong>ï¼Œä¸”æˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°æŒ‡å®š<strong>å±æ€§ç±»å‹</strong>ï¼Œå¦åˆ™ä¼šç¼–è¯‘é”™è¯¯ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassA</span> </span>&#123;</div><div class="line">    <span class="built_in">lazy</span> <span class="keyword">let</span> str: <span class="type">String</span> = &#123;</div><div class="line">        <span class="keyword">let</span> str = <span class="string">"Hello"</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"åªåœ¨é¦–æ¬¡è®¿é—®è¾“å‡º"</span>)</div><div class="line">        <span class="keyword">return</span> str</div><div class="line">    &#125;()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘å¤±è´¥</span></div><div class="line"><span class="comment">// 'lazy' cannot be used on a let</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassA</span> </span>&#123;</div><div class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> str = &#123;</div><div class="line">        <span class="keyword">let</span> str = <span class="string">"Hello"</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"åªåœ¨é¦–æ¬¡è®¿é—®è¾“å‡º"</span>)</div><div class="line">        <span class="keyword">return</span> str</div><div class="line">    &#125;()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘å¤±è´¥</span></div><div class="line"><span class="comment">// Unable to infer complex closure return type</span></div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åº”è¯¥å£°æ˜ä¸º <code>var</code> å¹¶æŒ‡å®šå¥½ç±»å‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassA</span> </span>&#123;</div><div class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> str: <span class="type">String</span> = &#123;</div><div class="line">        <span class="keyword">let</span> str = <span class="string">"Hello"</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"åªåœ¨é¦–æ¬¡è®¿é—®è¾“å‡º"</span>)</div><div class="line">        <span class="keyword">return</span> str</div><div class="line">    &#125;()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">super</span>.viewDidLoad()</div><div class="line"></div><div class="line">    <span class="keyword">let</span> ca = <span class="type">ClassA</span>()</div><div class="line">    <span class="built_in">print</span>(ca.str)</div><div class="line">    <span class="built_in">print</span>(ca.str)</div><div class="line">    <span class="built_in">print</span>(ca.str)   </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// åªåœ¨é¦–æ¬¡è®¿é—®è¾“å‡º</span></div><div class="line"><span class="comment">// Hello</span></div><div class="line"><span class="comment">// Hello</span></div><div class="line"><span class="comment">// Hello</span></div></pre></td></tr></table></figure>
<p>å¦‚æœä¸éœ€è¦åšä»€ä¹ˆé¢å¤–å·¥ä½œçš„è¯ï¼Œä¹Ÿå¯ä»¥å¯¹è¿™ä¸ª <code>lazy</code> çš„å±æ€§ç›´æ¥å†™èµ‹å€¼è¯­å¥ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">lazy</span> <span class="keyword">var</span> str: <span class="type">String</span> = <span class="string">"Hello"</span></div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨ <code>lazy</code> é…åˆåƒ <code>map</code> æˆ–æ˜¯ <code>filter</code> è¿™ç±»æ¥å—é—­åŒ…å¹¶è¿›è¡Œè¿è¡Œçš„æ–¹æ³•ä¸€èµ·ï¼Œ<strong>è®©æ•´ä¸ªè¡Œä¸ºå˜æˆå»¶æ—¶è¿›è¡Œçš„</strong>ã€‚åœ¨æŸäº›æƒ…å†µä¸‹è¿™ä¹ˆåšä¹Ÿå¯¹æ€§èƒ½ä¼šæœ‰ä¸å°çš„å¸®åŠ©ã€‚ä¾‹å¦‚ï¼Œç›´æ¥ä½¿ç”¨ map æ—¶ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> data = <span class="number">1</span>...<span class="number">3</span></div><div class="line"><span class="keyword">let</span> result = data.<span class="built_in">map</span> &#123;</div><div class="line">    (i: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"æ­£åœ¨å¤„ç† \(i)"</span>)</div><div class="line">    <span class="keyword">return</span> i * <span class="number">2</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">print</span>(<span class="string">"å‡†å¤‡è®¿é—®ç»“æœ"</span>)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"æ“ä½œåç»“æœä¸º \(i)"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">print</span>(<span class="string">"æ“ä½œå®Œæ¯•"</span>)</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// æ­£åœ¨å¤„ç† 1</span></div><div class="line"><span class="comment">// æ­£åœ¨å¤„ç† 2</span></div><div class="line"><span class="comment">// æ­£åœ¨å¤„ç† 3</span></div><div class="line"><span class="comment">// å‡†å¤‡è®¿é—®ç»“æœ</span></div><div class="line"><span class="comment">// æ“ä½œåç»“æœä¸º 2</span></div><div class="line"><span class="comment">// æ“ä½œåç»“æœä¸º 4</span></div><div class="line"><span class="comment">// æ“ä½œåç»“æœä¸º 6</span></div><div class="line"><span class="comment">// æ“ä½œå®Œæ¯•</span></div></pre></td></tr></table></figure>
<p>è€Œå¦‚æœæˆ‘ä»¬å…ˆè¿›è¡Œä¸€æ¬¡ <code>lazy</code> æ“ä½œçš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°å»¶æ—¶è¿è¡Œç‰ˆæœ¬çš„å®¹å™¨ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> data = <span class="number">1</span>...<span class="number">3</span></div><div class="line"><span class="keyword">let</span> result = data.<span class="built_in">lazy</span>.<span class="built_in">map</span> &#123;</div><div class="line">    (i: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"æ­£åœ¨å¤„ç† \(i)"</span>)</div><div class="line">    <span class="keyword">return</span> i * <span class="number">2</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">print</span>(<span class="string">"å‡†å¤‡è®¿é—®ç»“æœ"</span>)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"æ“ä½œåç»“æœä¸º \(i)"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">print</span>(<span class="string">"æ“ä½œå®Œæ¯•"</span>)</div><div class="line"></div><div class="line"><span class="comment">// å‡†å¤‡è®¿é—®ç»“æœ</span></div><div class="line"><span class="comment">// æ­£åœ¨å¤„ç† 1</span></div><div class="line"><span class="comment">// æ“ä½œåç»“æœä¸º 2</span></div><div class="line"><span class="comment">// æ­£åœ¨å¤„ç† 2</span></div><div class="line"><span class="comment">// æ“ä½œåç»“æœä¸º 4</span></div><div class="line"><span class="comment">// æ­£åœ¨å¤„ç† 3</span></div><div class="line"><span class="comment">// æ“ä½œåç»“æœä¸º 6</span></div><div class="line"><span class="comment">// æ“ä½œå®Œæ¯•</span></div></pre></td></tr></table></figure>
<p>å¯¹äºé‚£äº›ä¸éœ€è¦å®Œå…¨è¿è¡Œï¼Œå¯èƒ½æå‰é€€å‡ºçš„æƒ…å†µï¼Œä½¿ç”¨ lazy æ¥è¿›è¡Œæ€§èƒ½ä¼˜åŒ–æ•ˆæœä¼šéå¸¸æœ‰æ•ˆã€‚</p>
<h2 id="1.2.2"> ç¼–è¯‘æ ‡è®° </h2>

<p>åœ¨ Objective-C ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸åœ¨ä»£ç ä¸­æ’å…¥ <code>#param</code> ç¬¦å·æ¥æ ‡è®°ä»£ç çš„åŒºé—´ï¼Œè¿™æ ·åœ¨ Xcode çš„å¯¼èˆªæ ä¸­æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ç»„ç»‡åˆ†å—åçš„æ–¹æ³•åˆ—è¡¨ã€‚åœ¨ Swift ä¸­æˆ‘ä»¬å¯ä»¥ç”¨ <code>MARK:</code> æ¥ä»£æ›¿ï¼š</p>
<p><img src="http://p0kmbfoc8.bkt.clouddn.com/Snip20171207_3.png" alt=""></p>
<p>åœ¨ Objective-C ä¸­è¿˜æœ‰ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„ç¼–è¯‘æ ‡è®°ï¼Œé‚£å°±æ˜¯ <code>#warning</code>ï¼Œä¸€ä¸ª <code>#warning</code> æ ‡è®°å¯ä»¥åœ¨ Xcode çš„ä»£ç ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºä¸ºæ˜æ˜¾çš„é»„è‰²è­¦å‘Šæ¡ï¼Œéå¸¸é€‚åˆç”¨æ¥æç¤ºä»£ç çš„ç»´æŠ¤è€…å’Œä½¿ç”¨è€…éœ€è¦å¯¹æŸäº›ä¸œè¥¿åŠ ä»¥å…³æ³¨ã€‚åœ¨ Swift ä¸­æˆ‘ä»¬å¯ä»¥ç”¨ <code>FIXME:</code> å’Œ <code>TODO:</code> é…åˆ <code>shell</code> æ¥ä»£æ›¿ï¼š</p>
<p><img src="http://p0kmbfoc8.bkt.clouddn.com/Snip20171207_8.png" alt=""></p>
<p>è„šæœ¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">TAGS=&quot;TODO:|FIXME:&quot;</div><div class="line">echo &quot;searching $&#123;SRCROOT&#125; for $&#123;TAGS&#125;&quot;</div><div class="line">find &quot;$&#123;SRCROOT&#125;&quot; \( -name &quot;*.swift&quot; \) -print0 | xargs -0 egrep --with-filename --line-number --only-matching &quot;($TAGS).*\$&quot; | perl -p -e &quot;s/($TAGS)/ warning: \$1/&quot;</div></pre></td></tr></table></figure>
<p>æ•ˆæœï¼š</p>
<p><img src="http://p0kmbfoc8.bkt.clouddn.com/Snip20171207_7.png" alt=""><br><img src="http://p0kmbfoc8.bkt.clouddn.com/Snip20171207_6.png" alt=""></p>
<h2 id="1.2.3"> æ¢è¡Œç¬¦ </h2>

<p>åœ¨ Swift 3 ä¸­ï¼Œéœ€è¦æ¢è¡Œæ—¶æ˜¯éœ€è¦ <code>\n</code>ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> str = <span class="string">"xxxx\nxxx"</span></div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// xxxx</span></div><div class="line"><span class="comment">// xxx</span></div></pre></td></tr></table></figure>
<p>åœ¨ swift 4 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>&quot;&quot;&quot;</code>ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">let jsonStr = """</div><div class="line">        &#123;</div><div class="line">            "id": 123455,</div><div class="line">            "nickname": "xxxx",</div><div class="line">            "isMale": true,</div><div class="line">            "birthday": "2000å¹´3æœˆ24æ—¥",</div><div class="line">            "personalURL": "https://xxxxxx.github.io"</div><div class="line">        &#125;</div><div class="line">        """</div><div class="line">          </div><div class="line">// è¾“å‡ºï¼š</div><div class="line">&#123;</div><div class="line">    "id": 123455,</div><div class="line">    "nickname": "xxxx",</div><div class="line">    "isMale": true,</div><div class="line">    "birthday": "2000å¹´3æœˆ24æ—¥",</div><div class="line">    "personalURL": "https://xxxxxx.github.io"</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="1.2.4"> å­—ç¬¦ä¸²åˆ‡å‰² split </h2>

<p>æˆ‘ä»¬éœ€è¦åˆ‡å‰²æŸä¸ªå­—ç¬¦ä¸²æ—¶å¯ä»¥ç”¨ <code>split</code> æ–¹æ³•ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿”å›çš„ç»“æœæ˜¯ä¸ª<strong>æ•°ç»„</strong>ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> str = <span class="string">"Helloï¼Œworld !"</span></div><div class="line"><span class="built_in">print</span>(str.<span class="built_in">split</span>(separator: <span class="string">"ï¼Œ"</span>))</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// ["Hello", "world !"]</span></div></pre></td></tr></table></figure>
<h2 id="1.2.5"> KVC </h2>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> name = <span class="string">"ifelseboyxx"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Swift 4 ä¸­ Apple å¼•å…¥äº†æ–°çš„ KeyPath çš„è¡¨è¾¾æ–¹å¼ï¼Œç°åœ¨ï¼Œå¯¹äºç±»å‹ <code>MyClass</code> ä¸­çš„<strong>å˜é‡</strong> <code>name</code>ï¼Œå¯¹åº”çš„ KeyPath å¯ä»¥å†™ä¸º <code>\MyClass.name</code>ï¼Œåˆ©ç”¨ KVC ä¿®æ”¹ <code>name</code> å€¼çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæ“ä½œï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> object = <span class="type">MyClass</span>()</div><div class="line"><span class="built_in">print</span>(<span class="string">"name: \(object.name)"</span>)</div><div class="line"><span class="comment">// set</span></div><div class="line">object[keyPath: \<span class="type">MyClass</span>.name] = <span class="string">"ifelseboy"</span></div><div class="line"><span class="comment">// get</span></div><div class="line"><span class="built_in">print</span>(<span class="string">"name: \(object[keyPath: \MyClass.name])"</span>)</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// name: ifelseboyxx</span></div><div class="line"><span class="comment">// name: ifelseboy</span></div></pre></td></tr></table></figure>
<p>å¦å¤– Swift 4 ä¸­ <code>struct</code> åŒæ ·æ”¯æŒ KVC ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyStruct</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = <span class="type">MyStruct</span>(age: <span class="number">18</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"æˆ‘ä»Šå¹´ \(obj.age) å²äº†"</span>)</div><div class="line">obj[keyPath: \<span class="type">MyStruct</span>.age] = <span class="number">8</span></div><div class="line"><span class="built_in">print</span>(<span class="string">"æˆ‘ä»Šå¹´ \(obj[keyPath: \MyStruct.age]) å²äº†"</span>)</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// æˆ‘ä»Šå¹´ 18 å²äº†</span></div><div class="line"><span class="comment">// æˆ‘ä»Šå¹´ 8 å²äº†</span></div></pre></td></tr></table></figure>
<h2 id="1.2.6"> Swift ä¸­å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹æ³¨æ„ç‚¹ </h2>

<p>KVC ä¸€èŠ‚ä¸­ä»£ç é‡Œæœ‰ä¸ªæ³¨æ„ç‚¹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = <span class="type">MyStruct</span>(age: <span class="number">18</span>)</div><div class="line"><span class="comment">//æ›¿æ¢ä¸º</span></div><div class="line"><span class="keyword">let</span> obj = <span class="type">MyStruct</span>(age: <span class="number">18</span>)</div></pre></td></tr></table></figure>
<p>æ˜¯ç¼–è¯‘ä¸è¿‡çš„ï¼Œä¼šæŠ¥é”™ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="type">Cannot</span> assign to immutable expression of type '<span class="type">Int'</span></div></pre></td></tr></table></figure>
<p>ç¬”è€…åˆæ¬¡ä¹ŸçŠ¯äº†è¿™æ ·çš„é”™è¯¯ï¼Œæƒ³å½“ç„¶çš„è®¤ä¸º <code>MyClass</code> ç”¨ <code>let</code> å£°æ˜çš„æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œ<code>struct</code> ä¹Ÿä¸€æ ·ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> object = <span class="type">MyClass</span>()</div></pre></td></tr></table></figure>
<p><strong>å…¶å®åŸå› å¾ˆç®€å•ï¼Œswift ä¸­ Class æ˜¯å¼•ç”¨ç±»å‹çš„ï¼Œè€Œ struct æ˜¯å€¼ç±»å‹çš„ï¼šå€¼ç±»å‹åœ¨è¢«èµ‹ç»™ä¸€ä¸ªå˜é‡ï¼Œæˆ–è¢«ä¼ ç»™å‡½æ•°æ—¶ï¼Œå®é™…æ˜¯åšäº†ä¸€æ¬¡æ‹·è´ã€‚å¼•ç”¨ç±»å‹åœ¨è¢«èµ‹ç»™ä¸€ä¸ªå˜é‡ï¼Œæˆ–è¢«ä¼ ç»™å‡½æ•°æ—¶ï¼Œä¼ é€’çš„æ˜¯å¼•ç”¨ã€‚</strong></p>
<h2 id="1.2.7"> KVO </h2>

<p>å¾ˆé—æ†¾ï¼Œä¾ç„¶åªæœ‰ <code>NSObject</code> æ‰èƒ½æ”¯æŒ KVOï¼Œå¦å¤–ç”±äº Swift ä¸ºäº†æ•ˆç‡ï¼Œé»˜è®¤ç¦ç”¨äº†åŠ¨æ€æ´¾å‘ï¼Œå› æ­¤æƒ³ç”¨ Swift æ¥å®ç° KVOï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšé¢å¤–çš„å·¥ä½œï¼Œé‚£å°±æ˜¯å°†æƒ³è¦è§‚æµ‹çš„å¯¹è±¡æ ‡è®°ä¸º <code>dynamic</code> å’Œ <code>@objc</code>ï¼Œä¸‹é¢çš„ ğŸŒ° æ˜¯ <code>ViewController</code> ç›‘å¬ <code>MyClass</code> çš„ <code>date</code> å±æ€§ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>: <span class="title">NSObject</span> </span>&#123;</div><div class="line">    <span class="meta">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> date = <span class="type">Date</span>()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> myObject: <span class="type">MyClass</span>!</div><div class="line">    <span class="keyword">var</span> observation: <span class="type">NSKeyValueObservation</span>?</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        </div><div class="line">        myObject = <span class="type">MyClass</span>()</div><div class="line">        <span class="built_in">print</span>(<span class="string">"å½“å‰æ—¥æœŸï¼š\(myObject.date)"</span>)</div><div class="line">    </div><div class="line">        observation = myObject.observe(\<span class="type">MyClass</span>.date, options: [.old,.new], changeHandler: &#123; (<span class="number">_</span>, change) <span class="keyword">in</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> newDate = change.newValue , <span class="keyword">let</span> oldDate = change.oldValue &#123;</div><div class="line">                <span class="built_in">print</span>(<span class="string">"æ—¥æœŸå‘ç”Ÿå˜åŒ– oldï¼š\(oldDate) newï¼š\(newDate) "</span>)</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">        </div><div class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">self</span>.myObject.date = <span class="type">Date</span>()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// å½“å‰æ—¥æœŸï¼š2017-12-07 06:31:26 +0000</span></div><div class="line"><span class="comment">// æ—¥æœŸå‘ç”Ÿå˜åŒ– oldï¼š2017-12-07 06:31:26 +0000 newï¼š2017-12-07 06:31:27 +0000</span></div></pre></td></tr></table></figure>
<p>åœ¨ Objective-C ä¸­æˆ‘ä»¬å‡ ä¹å¯ä»¥æ²¡æœ‰é™åˆ¶åœ°å¯¹æ‰€æœ‰æ»¡è¶³ KVC çš„å±æ€§è¿›è¡Œç›‘å¬ï¼Œ<strong>è€Œç°åœ¨æˆ‘ä»¬éœ€è¦å±æ€§æœ‰ <code>dynamic</code> å’Œ <code>@objc</code> è¿›è¡Œä¿®é¥°</strong>ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦è§‚å¯Ÿçš„ç±»åŒ…å«è¿™ä¸¤ä¸ªä¿®é¥° (é™¤éè¿™ä¸ªç±»çš„å¼€å‘è€…æœ‰æ„ä¸ºä¹‹ï¼Œå¦åˆ™ä¸€èˆ¬ä¹Ÿä¸ä¼šæœ‰äººæ„¿æ„å¤šèŠ±åŠŸå¤«åœ¨å±æ€§å‰åŠ ä¸Šå®ƒä»¬ï¼Œå› ä¸ºè¿™æ¯•ç«Ÿè¦æŸå¤±ä¸€éƒ¨åˆ†æ€§èƒ½)ï¼Œå¹¶ä¸”æœ‰æ—¶å€™æˆ‘ä»¬å¾ˆå¯èƒ½ä¹Ÿæ— æ³•ä¿®æ”¹æƒ³è¦è§‚å¯Ÿçš„ç±»çš„æºç ã€‚é‡åˆ°è¿™æ ·çš„æƒ…å†µçš„è¯ï¼Œ<strong>ä¸€ä¸ªå¯èƒ½å¯è¡Œçš„æ–¹æ¡ˆæ˜¯ç»§æ‰¿è¿™ä¸ªç±»å¹¶ä¸”å°†éœ€è¦è§‚å¯Ÿçš„å±æ€§ä½¿ç”¨ <code>dynamic</code> å’Œ <code>@objc</code> è¿›è¡Œé‡å†™ã€‚</strong>æ¯”å¦‚åˆšæ‰æˆ‘ä»¬çš„ <code>MyClass</code> ä¸­å¦‚æœ <code>date</code> <strong>æ²¡æœ‰ç›¸åº”æ ‡æ³¨çš„è¯</strong>ï¼Œæˆ‘ä»¬å¯èƒ½å°±éœ€è¦ä¸€ä¸ªæ–°çš„ <code>MyChildClass</code>äº†ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>: <span class="title">NSObject</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> date = <span class="type">Date</span>()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyChildClass</span>: <span class="title">MyClass</span> </span>&#123;</div><div class="line">    <span class="meta">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">override</span> <span class="keyword">var</span> date: <span class="type">Date</span> &#123;</div><div class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> <span class="keyword">super</span>.date &#125;</div><div class="line">        <span class="keyword">set</span> &#123; <span class="keyword">super</span>.date = newValue &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> myObject: <span class="type">MyChildClass</span>!</div><div class="line">    <span class="keyword">var</span> observation: <span class="type">NSKeyValueObservation</span>?</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        </div><div class="line">        myObject = <span class="type">MyChildClass</span>()</div><div class="line">        <span class="built_in">print</span>(<span class="string">"å½“å‰æ—¥æœŸï¼š\(myObject.date)"</span>)</div><div class="line">    </div><div class="line">        observation = myObject.observe(\<span class="type">MyChildClass</span>.date, options: [.old,.new], changeHandler: &#123; (<span class="number">_</span>, change) <span class="keyword">in</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> newDate = change.newValue , <span class="keyword">let</span> oldDate = change.oldValue &#123;</div><div class="line">                <span class="built_in">print</span>(<span class="string">"æ—¥æœŸå‘ç”Ÿå˜åŒ– oldï¼š\(oldDate) newï¼š\(newDate) "</span>)</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">        </div><div class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">self</span>.myObject.date = <span class="type">Date</span>()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// å½“å‰æ—¥æœŸï¼š2017-12-07 06:36:50 +0000</span></div><div class="line"><span class="comment">// æ—¥æœŸå‘ç”Ÿå˜åŒ– oldï¼š2017-12-07 06:36:50 +0000 newï¼š2017-12-07 06:36:51 +0000</span></div></pre></td></tr></table></figure>
<h2 id="1.2.8"> Swift UIButton çŠ¶æ€çš„å åŠ  </h2> 

<p>åœ¨ Objective-C ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å åŠ æŒ‰é’®çš„æŸä¸ªçŠ¶æ€ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UIButton</span> * button = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</div><div class="line">[button setTitle:<span class="string">@"Test"</span> forState:<span class="built_in">UIControlStateNormal</span> | <span class="built_in">UIControlStateSelected</span>];</div></pre></td></tr></table></figure>
<p>å¯¹åº”çš„ Swift æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> btn = <span class="type">UIButton</span>.<span class="keyword">init</span>(type: .custom)</div><div class="line">btn.setTitle(<span class="string">"hehe"</span>, <span class="keyword">for</span>: [.normal ,.selected])</div></pre></td></tr></table></figure>
<p>æŠŠéœ€è¦å åŠ çš„çŠ¶æ€ç”¨ä¸ª<strong>æ•°ç»„</strong>è£…èµ·æ¥å°±è¡Œäº†ã€‚</p>
<h2 id="1.2.9"> Swift ä¸­çš„ â€œ@synchronizedâ€ </h2> 

<p>åœ¨ Objective-C ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>@synchronized</code> è¿™ä¸ªå…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®é¥°ä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸ºå…¶è‡ªåŠ¨åŠ ä¸Šå’Œè§£é™¤äº’æ–¥é”ã€‚è¿™æ ·ï¼Œå¯ä»¥ä¿è¯å˜é‡åœ¨ä½œç”¨èŒƒå›´å†…ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ”¹å˜ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)myMethod:(<span class="keyword">id</span>)anObj &#123;</div><div class="line">    <span class="keyword">@synchronized</span>(anObj) &#123;</div><div class="line">        <span class="comment">// åœ¨æ‹¬å·å†…æŒæœ‰ anObj é”</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è™½ç„¶è¿™ä¸ªæ–¹æ³•å¾ˆç®€å•å¥½ç”¨ï¼Œä½†æ˜¯å¾ˆä¸å¹¸çš„æ˜¯åœ¨ Swift ä¸­å®ƒå·²ç» (æˆ–è€…æ˜¯æš‚æ—¶) ä¸å­˜åœ¨äº†ã€‚å…¶å® <code>@synchronized</code> åœ¨å¹•ååšçš„äº‹æƒ…æ˜¯è°ƒç”¨äº† <code>objc_sync</code> ä¸­çš„ <code>objc_sync_enter</code> å’Œ <code>objc_sync_exit</code> æ–¹æ³•ï¼Œå¹¶ä¸”åŠ å…¥äº†ä¸€äº›å¼‚å¸¸åˆ¤æ–­ã€‚å› æ­¤ï¼Œåœ¨ Swift ä¸­ï¼Œå¦‚æœæˆ‘ä»¬å¿½ç•¥æ‰é‚£äº›å¼‚å¸¸çš„è¯ï¼Œæˆ‘ä»¬æƒ³è¦ lock ä¸€ä¸ªå˜é‡çš„è¯ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">myMethod</span><span class="params">(anObj: AnyObject!)</span></span> &#123;</div><div class="line">    objc_sync_enter(anObj)</div><div class="line"></div><div class="line">    <span class="comment">// åœ¨ enter å’Œ exit ä¹‹é—´æŒæœ‰ anObj é”</span></div><div class="line"></div><div class="line">    objc_sync_exit(anObj)</div><div class="line">&#125;</div><div class="line">``` </div><div class="line">æ›´è¿›ä¸€æ­¥ï¼Œå¦‚æœæˆ‘ä»¬å–œæ¬¢ä»¥å‰çš„é‚£ç§å½¢å¼ï¼Œç”šè‡³å¯ä»¥å†™ä¸€ä¸ªå…¨å±€çš„æ–¹æ³•ï¼Œå¹¶æ¥å—ä¸€ä¸ªé—­åŒ…ï¼Œæ¥å°† `objc_sync_enter` å’Œ `objc_sync_exit` å°è£…èµ·æ¥ï¼š</div><div class="line"></div><div class="line">```swift</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">synchronized</span><span class="params">(<span class="number">_</span> lock: AnyObject, closure: <span class="params">()</span></span></span> -&gt; ()) &#123;</div><div class="line">    objc_sync_enter(lock)</div><div class="line">    closure()</div><div class="line">    objc_sync_exit(lock)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ä½¿ç”¨ï¼š</span></div><div class="line">synchronized(<span class="keyword">self</span>) &#123;</div><div class="line">            </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ä½¿ç”¨èµ·æ¥å°±å’Œ Objective-C ä¸­ <code>@synchronized</code> å¾ˆåƒäº†ã€‚</p>
<p>å†ä¸¾ä¸ª ğŸŒ° ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä¸ºæŸä¸ªç±»å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ <code>setter</code>ï¼Œå¯ä»¥è¿™æ ·ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Obj</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> _str = <span class="string">"123"</span></div><div class="line">    <span class="keyword">var</span> str: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">get</span> &#123;</div><div class="line">            <span class="keyword">return</span> _str</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">set</span> &#123;</div><div class="line">            synchronized(<span class="keyword">self</span>) &#123;</div><div class="line">                _str = newValue</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="1.3.0"> è‡ªå®šä¹‰æ—¥å¿—è¾“å‡º </h2>

<p>åœ¨ Objective-C ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè‡ªå®šä¹‰æ—¥å¿—è¾“å‡ºæ¥å®Œå–„ä¿¡æ¯ä»¥åŠé¿å… <code>release</code> ä¸‹çš„è¾“å‡ºï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§ï¼Œå¯ä»¥é¢å¤–æä¾›è¡Œæ•°ã€æ–¹æ³•åç­‰ä¿¡æ¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#ifdef DEBUG</span></div><div class="line"><span class="meta">#define XXLog(fmt, ...) NSLog((@<span class="meta-string">"%s [Line %d] "</span> fmt), __PRETTY_FUNCTION__, __LINE__, ##__VA_ARGS__)</span></div><div class="line"><span class="meta">#else</span></div><div class="line"><span class="meta">#define XXLog(...)</span></div><div class="line"><span class="meta">#endif</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</div><div class="line">    <span class="comment">// Override point for customization after application launch.</span></div><div class="line">    </div><div class="line">    XXLog(<span class="string">@"ifelseboyxx"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// 2017-12-08 13:32:02.211306+0800 Demo[17902:88775537] -[AppDelegate application:didFinishLaunchingWithOptions:] [Line 28] ifelseboyxx</span></div></pre></td></tr></table></figure>
<p>åœ¨ Swift ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è‡ªå®šä¹‰ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">xxprint</span>&lt;T&gt;<span class="params">(<span class="number">_</span> message: T, filePath: String = #file, line: Int = #line, function: String = #function)</span></span> &#123;</div><div class="line">    #<span class="keyword">if</span> <span class="type">DEBUG</span></div><div class="line">        <span class="keyword">let</span> fileName = (filePath <span class="keyword">as</span> <span class="type">NSString</span>).lastPathComponent.replacingOccurrences(of: <span class="string">".Swift"</span>, with: <span class="string">""</span>)</div><div class="line">        <span class="keyword">let</span> dateFormatter = <span class="type">DateFormatter</span>()</div><div class="line">        dateFormatter.locale = <span class="type">Locale</span>.current</div><div class="line">        dateFormatter.dateFormat = <span class="string">"yyyy-MM-dd HH:mm:ss"</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"["</span> + dateFormatter.string(from: <span class="type">Date</span>()) + <span class="string">" "</span> + fileName + <span class="string">" "</span> + function + <span class="string">" \(line)"</span> + <span class="string">"]ï¼š"</span> + <span class="string">"\(message)"</span>)</div><div class="line">    #endif</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">    </div><div class="line">        xxprint(<span class="string">"ifelseboyxx"</span>)</div><div class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + <span class="number">1</span>) &#123;</div><div class="line">            xxprint(<span class="string">"ifelseboyxx"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// [2017-12-08 13:49:38 ViewController.swift viewDidLoad() 27]ï¼šifelseboyxx</span></div><div class="line"><span class="comment">// [2017-12-08 13:49:39 ViewController.swift viewDidLoad() 29]ï¼šifelseboyxx</span></div></pre></td></tr></table></figure>
<h2 id="1.3.1"> Swift ä¸­çš„ â€œreadonlyâ€ </h2>

<p>åœ¨ Objective-C ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠå±æ€§å£°æ˜ä¸º <code>readonly</code> æ¥æé†’åˆ«äººï¼šâ€œä¸è¦ä¿®æ”¹ï¼ï¼â€ï¼Œé€šå¸¸è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>å¦‚æœå¤–éƒ¨å°è¯•ä¿®æ”¹çš„è¯ï¼Œä¼šç¼–è¯‘é”™è¯¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">   </div><div class="line">    Person *p = [Person new];</div><div class="line">    p.name = <span class="string">@"ifelseboyxx"</span>;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘é”™è¯¯ï¼š</span></div><div class="line"><span class="comment">// Assignment to readonly property</span></div></pre></td></tr></table></figure>
<p>æœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å†…éƒ¨å¯ä»¥ç‚¹è¯­æ³•è®¿é—® <code>name</code> å±æ€§ï¼Œä¹Ÿå°±æ˜¯ <code>self.name</code>ï¼Œä½†æ˜¯å› ä¸ºæ˜¯ <code>readonly</code> çš„ï¼Œä¼šç¼–è¯‘é”™è¯¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">instancetype</span>)init &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.name = <span class="string">@"ifelseboyxx"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘é”™è¯¯ï¼š</span></div><div class="line"><span class="comment">// Assignment to readonly property</span></div></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™æˆ‘ä»¬å°±ä¼šåœ¨å†…éƒ¨çš„ <code>extension</code> é‡æ–°å£°æ˜ä¸€ä¸ª <code>readwrite</code>çš„åŒæ ·çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯<strong>â€œå¤–éƒ¨åªè¯»ï¼Œå†…éƒ¨å¯å†™â€</strong>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> ()</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readwrite</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>åœ¨ Swift ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰åŒæ ·çš„åœºæ™¯ã€‚è¿™é‡Œå°±ä¸å¾—ä¸æåˆ° <code>private</code> å’Œ <code>fileprivate</code> å…³é”®å­—äº†ã€‚<br><code>private</code>è¡¨ç¤ºå£°æ˜ä¸ºç§æœ‰çš„å®ä½“åªèƒ½åœ¨å…¶å£°æ˜çš„èŒƒå›´å†…è¢«è®¿é—®ã€‚æ¯”å¦‚æˆ‘åœ¨ <code>MyClass</code> ä¸­å£°æ˜äº†ä¸€ä¸ªç§æœ‰çš„ <code>name</code> å±æ€§ï¼Œå¤–éƒ¨è®¿é—®çš„è¯ä¼šç¼–è¯‘é”™è¯¯ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">"Test"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line"></div><div class="line">        <span class="keyword">let</span> only = <span class="type">MyClass</span>()</div><div class="line">        <span class="built_in">print</span>(only.name) </div><div class="line">        only.name = <span class="string">"ifelseboyxxv587"</span>       </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘å¼‚å¸¸ï¼š</span></div><div class="line"><span class="comment">// 'name' is inaccessible due to 'private' protection level</span></div></pre></td></tr></table></figure>
<p>è€Œ <code>fileprivate</code>ï¼Œçœ‹å‘½åæˆ‘ä»¬å¤§æ¦‚èƒ½çŒœåˆ°ï¼Œå°±æ˜¯å°†å¯¹å®ä½“çš„è®¿é—®æƒé™äºå®ƒå£°æ˜çš„æºæ–‡ä»¶ã€‚é€šä¿—ç‚¹è®²ï¼Œæ¯”å¦‚æˆ‘ä¸Šé¢çš„ä»£ç éƒ½æ˜¯åœ¨ <code>ViewController.swift</code> è¿™ä¸ªæ–‡ä»¶é‡Œçš„ï¼Œæˆ‘æŠŠ <code>private</code> ä¿®æ”¹ä¸º <code>fileprivate</code>ï¼Œå°±ä¸ä¼šç¼–è¯‘é”™è¯¯äº†ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</div><div class="line">    fileprivate <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">"Test"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆå¦‚æœé <code>ViewController.swift</code> æ–‡ä»¶ï¼Œä¹Ÿæƒ³è®¿é—® <code>MyClass</code> çš„ <code>name</code> å±æ€§è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠ <code>name</code> å±æ€§å£°æ˜ä¸º <code>fileprivate(set)</code>ï¼Œå°±è¦å°±è¾¾åˆ°ç±»ä¼¼ Objective-C ä¸­çš„ <code>readonly</code> æ•ˆæœäº† ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ViewController.swift æ–‡ä»¶</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</div><div class="line">    fileprivate(<span class="keyword">set</span>) <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">"Test"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line"></div><div class="line">        <span class="keyword">let</span> only = <span class="type">MyClass</span>()</div><div class="line">        <span class="built_in">print</span>(only.name)</div><div class="line">        only.name = <span class="string">"ifelseboyxxv587"</span></div><div class="line">        <span class="built_in">print</span>(only.name)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘æ­£å¸¸ï¼ŒViewController.swift æ–‡ä»¶å†…å¯è¯»å¯å†™</span></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// Test</span></div><div class="line"><span class="comment">// ifelseboyxxv587</span></div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// AppDelegate.swift æ–‡ä»¶</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">        <span class="comment">// Override point for customization after application launch.</span></div><div class="line"></div><div class="line">    <span class="keyword">let</span> only = <span class="type">MyClass</span>()</div><div class="line">    <span class="built_in">print</span>(only.name) <span class="comment">//åªèƒ½è¯»</span></div><div class="line">    only.name = <span class="string">"ifelseboyxxv587"</span> <span class="comment">//è¿™é‡ŒæŠ¥é”™ï¼Œä¸èƒ½å†™</span></div><div class="line">        </div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç¼–è¯‘å¼‚å¸¸ï¼š</span></div><div class="line"><span class="comment">// Cannot assign to property: 'name' setter is inaccessible</span></div></pre></td></tr></table></figure>
<h2 id="1.3.2"> ä½œç”¨åŸŸï¼šdo è¯­å¥å— </h2>

<p>åœ¨ Objective-C ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>{}</code> æ¥å¼€è¾Ÿæ–°çš„ä½œç”¨åŸŸï¼Œæ¥é¿å…å¯¹è±¡åç§°é‡å¤çš„é—®é¢˜ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *ha = <span class="string">@"æµ‹è¯•ä¸€"</span>;</div><div class="line">    </div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSString</span> *ha = <span class="string">@"æµ‹è¯•äºŒ"</span>;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,ha);</div><div class="line">&#125;</div><div class="line">    </div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,ha);</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// 2017-12-11 16:55:20.303132+0800 Demo[48418:93027416] æµ‹è¯•äºŒ</span></div><div class="line"><span class="comment">// 2017-12-11 16:55:20.303316+0800 Demo[48418:93027416] æµ‹è¯•ä¸€</span></div></pre></td></tr></table></figure>
<p>åœ¨ Swift ä¸­ï¼Œå–ä»£ <code>{}</code> çš„æ˜¯ <code>do {}</code>ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> ha = <span class="string">"æµ‹è¯•ä¸€"</span></div><div class="line">        </div><div class="line"><span class="keyword">do</span> &#123;</div><div class="line">    <span class="keyword">let</span> ha = <span class="string">"æµ‹è¯•äºŒ"</span></div><div class="line">    <span class="built_in">print</span>(ha)</div><div class="line">&#125;</div><div class="line">        </div><div class="line"><span class="built_in">print</span>(ha)</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// æµ‹è¯•äºŒ</span></div><div class="line"><span class="comment">// æµ‹è¯•ä¸€</span></div></pre></td></tr></table></figure>
<h2 id="1.3.3"> å€’åº reversed() </h2>

<p>åœ¨ Objective-C ä¸­ï¼Œæˆ‘ä»¬å¦‚æœæƒ³å€’åºæ•°ç»„ä¸€èˆ¬è¿™æ ·ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *array = @[<span class="string">@"1"</span>,<span class="string">@"2"</span>,<span class="string">@"3"</span>];</div><div class="line">    </div><div class="line"><span class="built_in">NSArray</span> *reversedArray = [[array reverseObjectEnumerator] allObjects];</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// 2017-12-11 17:39:57.127466+0800 Demo[49004:93210504] (</span></div><div class="line">    <span class="number">3</span>,</div><div class="line">    <span class="number">2</span>,</div><div class="line">    <span class="number">1</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>åœ¨ Swift ä¸­ï¼Œç›¸å¯¹ç®€å•ç‚¹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> arr:[<span class="type">String</span>] = [<span class="string">"1"</span>,<span class="string">"2"</span>,<span class="string">"3"</span>]</div><div class="line"><span class="keyword">let</span> reversedArr:[<span class="type">String</span>] = arr.reversed()</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// ["3", "2", "1"]</span></div></pre></td></tr></table></figure>
<h2 id="1.3.3"> æ ‡ç­¾è¯­å¥ï¼šæŒ‡å®šè·³å‡ºæŸä¸ªæ¡ä»¶è¯­å¥ </h2>

<p>åœ¨ Objective-C ä¸­ï¼Œå¦‚æœé‡åˆ°å¤šå±‚åµŒå¥—çš„æ¡ä»¶è¯­å¥ï¼Œæˆ‘ä»¬å¦‚æœæƒ³è¦æŒ‡å®šè·³å‡ºæŸä¸ªæ¡ä»¶è¯­å¥æ˜¯å¾ˆä¸æ–¹ä¾¿çš„ã€‚æ¯”å¦‚æœ‰ä¸¤ä¸ªå¾ªç¯ï¼Œ<strong>ä¸€æ—¦æ‰¾åˆ°å®ƒä»¬ç›¸åŒçš„ï¼Œå°±ç«‹åˆ»åœæ­¢å¾ªç¯</strong>ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè¿™ä¹ˆåšï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *arr1 = @[<span class="string">@"1"</span>,<span class="string">@"2"</span>,<span class="string">@"3"</span>,<span class="string">@"4"</span>,<span class="string">@"5"</span>];</div><div class="line"><span class="built_in">NSArray</span> *arr2 = @[<span class="string">@"4"</span>,<span class="string">@"6"</span>,<span class="string">@"8"</span>,<span class="string">@"9"</span>,<span class="string">@"2"</span>];</div><div class="line"></div><div class="line"><span class="built_in">BOOL</span> finded = <span class="literal">NO</span>;</div><div class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *x <span class="keyword">in</span> arr1) &#123;</div><div class="line">    <span class="keyword">if</span> (finded) &#123;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"xï¼š%@"</span>,x);</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *y <span class="keyword">in</span> arr2) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"yï¼š%@"</span>,y);</div><div class="line">        <span class="keyword">if</span> ([x isEqualToString:y]) &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"æ‰¾åˆ°ç›¸ç­‰çš„äº†ï¼š%@"</span>,x);</div><div class="line">            finded = <span class="literal">YES</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬éœ€è¦å€ŸåŠ© <code>finded</code> è¿™ä¸ª <code>BOOL</code>ï¼Œæ¥æ–¹ä¾¿æˆ‘ä»¬è·³å‡ºå¾ªç¯ã€‚åœ¨ Swift ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨æ ‡ç­¾è¯­å¥ï¼Œæ¥æŒ‡å®šå…·ä½“è·³å‡ºå“ªä¸ªå¾ªç¯ï¼Œè¯­æ³•æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">æ ‡ç­¾å: æ¡ä»¶è¯­å¥ &#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ ğŸŒ° æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> arr1 = [<span class="string">"1"</span>,<span class="string">"2"</span>,<span class="string">"3"</span>,<span class="string">"4"</span>,<span class="string">"5"</span>]</div><div class="line"><span class="keyword">let</span> arr2 = [<span class="string">"4"</span>,<span class="string">"6"</span>,<span class="string">"8"</span>,<span class="string">"9"</span>,<span class="string">"2"</span>]</div><div class="line">        </div><div class="line">label: <span class="keyword">for</span> x <span class="keyword">in</span> arr1 &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"xï¼š \(x)"</span>)</div><div class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> arr2 &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"yï¼š \(y)"</span>)</div><div class="line">        <span class="keyword">if</span> x == y &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"æ‰¾åˆ°ç›¸ç­‰çš„äº†ï¼š\(y)"</span>)</div><div class="line">            <span class="keyword">break</span> label</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬æŠŠç¬¬ä¸€å±‚å¾ªç¯å®šä¹‰äº†æ ‡ç­¾ï¼š<code>label</code>ã€‚åœ¨ç¬¬äºŒå±‚å¾ªç¯ä¸­ï¼Œä¸€æ—¦æ¡ä»¶æˆç«‹ï¼Œç«‹åˆ»è·³å‡ºç¬¬ä¸€å±‚å¾ªç¯ <code>label</code>ã€‚è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥è¯´ååˆ†æ–¹ä¾¿äº†ï¼</p>
<h2 id="1.3.5"> ä¼˜é›…çš„å®šä¹‰é€šçŸ¥åç§° </h2>

<p>åœ¨ Objective-C ä¸­ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰é€šçŸ¥æ—¶ï¼Œå¯¹äºåç§°çš„å®šä¹‰ä¸€èˆ¬éƒ½æœ‰è§„èŒƒï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// xxx.h </span></div><div class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> XXXXNotification;</div><div class="line"></div><div class="line"><span class="comment">// xxx.m </span></div><div class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> XXXXNotification = <span class="string">@"XXXXNotification"</span>;</div></pre></td></tr></table></figure>
<p>åœ¨ Swift ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒ <a href="https://github.com/Alamofire/Alamofire" target="_blank" rel="external">Alamofire</a> çš„æ–¹å¼ï¼Œåˆ›å»ºä¸ªä¸“é—¨å­˜æ”¾é€šçŸ¥åçš„æ–‡ä»¶ï¼Œæ‰©å±• <code>Notification.Name</code> å¹¶ä»¥ç»“æ„ä½“ <code>struct</code> æ–¹å¼å£°æ˜ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// XXNotification.swift æ–‡ä»¶</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> Foundation</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Notification</span>.<span class="title">Name</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Task</span> </span>&#123;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> é€šçŸ¥å = <span class="type">Notification</span>.<span class="type">Name</span>(rawValue: <span class="string">"org.targetåç§°.notification.name.task.é€šçŸ¥å"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨äº†ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// add</span></div><div class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(<span class="keyword">self</span>, selector: #selector(myNotification(<span class="number">_</span> :)), name: <span class="type">NSNotification</span>.<span class="type">Name</span>.<span class="type">Task</span>.é€šçŸ¥å, object: <span class="keyword">self</span>)</div><div class="line"></div><div class="line"><span class="comment">// post</span></div><div class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span>.post(name: <span class="type">NSNotification</span>.<span class="type">Name</span>.<span class="type">Task</span>.é€šçŸ¥å, object: <span class="keyword">self</span>)</div><div class="line"></div><div class="line"><span class="comment">// remove</span></div><div class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span>.removeObserver(<span class="keyword">self</span>, name: <span class="type">NSNotification</span>.<span class="type">Name</span>.<span class="type">Task</span>.é€šçŸ¥å, object: <span class="keyword">self</span>)</div></pre></td></tr></table></figure>
<h2 id="1.3.6"> weakSelf å’Œ strongSelf </h2>

<p>åœ¨ Objective-C ä¸­ï¼Œä¸ºäº†é˜²æ­¢ block å¾ªç¯å¼•ç”¨ï¼Œæˆ‘ä»¬é€šç”¨åˆ©ç”¨ <code>__weak</code> å’Œ <code>__strong</code>  æ­é…ä½¿ç”¨ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">__<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</div><div class="line"> </div><div class="line">__<span class="keyword">strong</span> <span class="keyword">typeof</span>(weakSelf) strongSelf = weakSelf;</div></pre></td></tr></table></figure>
<p>å¯¹åº”çš„ Swift ä¸­æˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">resource.request().onComplete &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] response <span class="keyword">in</span></div><div class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> strongSelf = <span class="keyword">self</span> <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span></div><div class="line">  &#125;</div><div class="line">  <span class="keyword">let</span> model = strongSelf.updateModel(response)</div><div class="line">  strongSelf.updateUI(model)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="1.3.7"> å‡ ç§éå†æ–¹å¼ </h2>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="number">3</span> &#123;</div><div class="line">  <span class="built_in">print</span>(<span class="string">"Hello three times"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å¸¦ç´¢å¼•</span></div><div class="line"><span class="keyword">for</span> (index, person) <span class="keyword">in</span> attendeeList.enumerated() &#123;</div><div class="line">  <span class="built_in">print</span>(<span class="string">"\(person) is at position #\(index)"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æ¯éš”ä¸¤ä¸ªæ‰“å°</span></div><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">0</span>, to: <span class="number">5</span>, by: <span class="number">2</span>) &#123;</div><div class="line">  <span class="built_in">print</span>(index)</div><div class="line">&#125;</div><div class="line"><span class="comment">// è¾“å‡ºï¼š 0 2 4</span></div><div class="line"></div><div class="line"><span class="comment">// å€’å™</span></div><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> (<span class="number">0</span>...<span class="number">3</span>).reversed() &#123;</div><div class="line">  <span class="built_in">print</span>(index)</div><div class="line">&#125;</div><div class="line"><span class="comment">// è¾“å‡ºï¼š3 2 1 0</span></div></pre></td></tr></table></figure>
<h2 id="1.3.8"> è®¿é—®çº§åˆ«</h2>

<p>Swift ä¸­çš„è®¿é—®çº§åˆ«æœ‰ä»¥ä¸‹<strong>äº”ç§</strong>ï¼š</p>
<ul>
<li><code>open</code>ï¼šå…¬å¼€æƒé™, æœ€é«˜çš„æƒé™ï¼Œå¯ä»¥è¢«å…¶ä»–æ¨¡å—è®¿é—®ï¼Œç»§æ‰¿åŠå¤å†™ã€‚</li>
<li><code>public</code>ï¼šå…¬æœ‰è®¿é—®æƒé™ï¼Œç±»æˆ–è€…ç±»çš„å…¬æœ‰å±æ€§æˆ–è€…å…¬æœ‰æ–¹æ³•å¯ä»¥ä»æ–‡ä»¶æˆ–è€…æ¨¡å—çš„ä»»ä½•åœ°æ–¹è¿›è¡Œè®¿é—®ã€‚é‚£ä¹ˆä»€ä¹ˆæ ·æ‰èƒ½æˆä¸ºä¸€ä¸ªæ¨¡å—å‘¢ï¼Ÿä¸€ä¸ª App å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œä¸€ä¸ªç¬¬ä¸‰æ–¹ APIï¼Œç¬¬ä¸‰ç­‰æ–¹æ¡†æ¶ç­‰éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å¦‚æœè¦å¯¹å¤–ç•™æœ‰è®¿é—®çš„å±æ€§æˆ–è€…æ–¹æ³•ï¼Œå°±åº”è¯¥ä½¿ç”¨ public çš„è®¿é—®æƒé™ã€‚public çš„æƒé™åœ¨ Swift 3.0 åæ— æ³•åœ¨å…¶ä»–æ¨¡å—è¢«å¤å†™æ–¹æ³•/å±æ€§æˆ–è¢«ç»§æ‰¿ã€‚</li>
<li><code>fileprivate</code>ï¼šæ–‡ä»¶ç§æœ‰è®¿é—®æƒé™ï¼Œè¢« fileprivate ä¿®é¥°çš„ç±»æˆ–è€…ç±»çš„å±æ€§æˆ–æ–¹æ³•å¯ä»¥åœ¨åŒä¸€ä¸ªç‰©ç†æ–‡ä»¶ä¸­è®¿é—®ã€‚å¦‚æœè¶…å‡ºè¯¥ç‰©ç†æ–‡ä»¶ï¼Œé‚£ä¹ˆæœ‰ç€ fileprivate è®¿é—®æƒé™çš„ç±»ï¼Œå±æ€§å’Œæ–¹æ³•å°±ä¸èƒ½è¢«è®¿é—®ã€‚</li>
<li><code>private</code>ï¼šç§æœ‰è®¿é—®æƒé™ï¼Œè¢« private ä¿®é¥°çš„ç±»æˆ–è€…ç±»çš„å±æ€§æˆ–æ–¹æ³•å¯ä»¥åœ¨åŒä¸€ä¸ªç‰©ç†æ–‡ä»¶ä¸­çš„åŒä¸€ä¸ªç±»å‹ï¼ˆåŒ…å« extensionï¼‰è®¿é—®ã€‚å¦‚æœè¶…å‡ºè¯¥ç‰©ç†æ–‡ä»¶æˆ–ä¸å±äºåŒä¸€ç±»å‹ï¼Œé‚£ä¹ˆæœ‰ç€ private è®¿é—®æƒé™çš„å±æ€§å’Œæ–¹æ³•å°±ä¸èƒ½è¢«è®¿é—®ã€‚</li>
<li><code>internal</code>ï¼š é¡¾åæ€ä¹‰ï¼Œinternal æ˜¯å†…éƒ¨çš„æ„æ€ï¼Œå³æœ‰ç€ internal è®¿é—®æƒé™çš„å±æ€§å’Œæ–¹æ³•è¯´æ˜åœ¨æ¨¡å—å†…éƒ¨å¯ä»¥è®¿é—®ï¼Œè¶…å‡ºæ¨¡å—å†…éƒ¨å°±ä¸å¯è¢«è®¿é—®äº†ã€‚åœ¨ Swift ä¸­é»˜è®¤å°±æ˜¯ internal çš„è®¿é—®æƒé™ã€‚</li>
</ul>
<h2 id="1.3.9"> for in å’Œ forEach çš„åŒºåˆ« </h2>

<p><code>for in</code> èƒ½ä½¿ç”¨ <code>return</code>ã€<code>break</code>ã€<code>continue</code> å…³é”®å­—ï¼Œ<code>forEach</code> ä¸èƒ½ä½¿ç”¨ <code>break</code>ã€<code>continue</code> å…³é”®å­—ã€‚<strong>å®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äº <code>return</code> å…³é”®å­—ç»“æœçš„ä¸åŒï¼š</strong></p>
<p>åœ¨ <code>for in</code> ä¸­ï¼Œ<code>return</code> ä¼šå¯¼è‡´å¾ªç¯ç»ˆæ­¢ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> array = [<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>]</div><div class="line"><span class="keyword">for</span> element <span class="keyword">in</span> array &#123;</div><div class="line">    <span class="keyword">if</span> element == <span class="string">"3"</span> &#123;</div><div class="line">        <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line">    <span class="built_in">print</span>(element)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p>è€Œ <code>forEach</code> ä¼šè·³è¿‡å½“å‰å¾ªç¯ï¼Œå®Œæˆå‰©ä½™çš„å¾ªç¯ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> array = [<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>]</div><div class="line">array.forEach &#123; (element) <span class="keyword">in</span></div><div class="line">    <span class="keyword">if</span> element == <span class="string">"3"</span> &#123;</div><div class="line">        <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line">    <span class="built_in">print</span>(element)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 4</span></div><div class="line"><span class="comment">// 5</span></div></pre></td></tr></table></figure>
<p><strong>è¿™æ ·çœ‹æ¥ï¼Œ<code>forEach</code> ä¸­çš„ <code>return</code> å…³é”®å­—å€’æ˜¯æœ‰ç‚¹ç±»ä¼¼ <code>for in</code> ä¸­çš„ <code>continue</code> äº†ï¼</strong></p>
<h2 id="1.4.0"> å–æ¶ˆ asyncAfter ä¸­å»¶è¿Ÿçš„äº‹ä»¶ </h2>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">let</span> workItem = <span class="type">DispatchWorkItem</span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"test"</span>)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></div><div class="line">        </div><div class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + <span class="number">3</span>, execute: workItem)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// è¿™é‡Œç‚¹å‡»å–æ¶ˆä¹‹å‰å»¶è¿Ÿçš„äº‹æƒ…</span></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(<span class="number">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent?)</span></span> &#123;</div><div class="line">        </div><div class="line">        <span class="built_in">print</span>(workItem.isCancelled ? <span class="string">"å–æ¶ˆäº†"</span> : <span class="string">"æœªå–æ¶ˆ"</span>)</div><div class="line">        </div><div class="line">        workItem.cancel()</div><div class="line"></div><div class="line">        <span class="built_in">print</span>(workItem.isCancelled ? <span class="string">"å–æ¶ˆäº†"</span> : <span class="string">"æœªå–æ¶ˆ"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// æœªå–æ¶ˆ</span></div><div class="line"><span class="comment">// å–æ¶ˆäº†</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»¥ä¸‹å†…å®¹å‡æ˜¯ç¬”è€…å­¦ä¹ è¿‡ç¨‹ä¸­&lt;strong&gt;æ”¶é›†&lt;/strong&gt;çš„çŸ¥è¯†ç‚¹ï¼Œé¡ºåºæ¯”è¾ƒè·³è·ƒï¼Œåˆè¡·æ˜¯ä¸ºäº†æ–¹ä¾¿æŸ¥é˜…ï¼Œé¡ºä¾¿åŠ æ·±è®°å¿†ã€‚&lt;strong&gt;å†…å®¹ä¼šä¸æ–­æ›´æ–°&lt;/strong&gt;ï¼Œå¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜æˆ–è€…æœ‰å¥½çš„ Swift æ–¹é¢çš„è¯­æ³•ç³–æˆ–è€…çŸ¥è¯†ç‚¹ä¹Ÿå¯ä»¥æå‡ºæ¥ï¼Œæˆ‘ä¼šæŒ‘é€‰æ–Ÿé…Œåæ”¶å½•ï¼Œæ¬¢è¿å¤§å®¶
    
    </summary>
    
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Method Swizzling å®æˆ˜ï¼šHook ç³»ç»Ÿä»£ç†æ–¹æ³•</title>
    <link href="http://yoursite.com/2017/11/30/hook_system_delegate/"/>
    <id>http://yoursite.com/2017/11/30/hook_system_delegate/</id>
    <published>2017-11-30T15:41:23.000Z</published>
    <updated>2018-02-13T09:07:21.118Z</updated>
    
    <content type="html"><![CDATA[<p>å…³äº Method Swizzling åŸºæœ¬ç”¨æ³•å¯ä»¥å…ˆçœ‹çœ‹åšä¸»ä¹‹å‰çš„æ–‡ç«  <a href="http://blog.ifelseboyxx.com/2017/01/25/Method-Swizzling/" target="_blank" rel="external">æµ…è°ˆ Method Swizzling</a>, è¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ã€‚æœ¬æ–‡ä»¥ <code>UIWebViewDelegate</code> ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•åˆ©ç”¨ Method Swizzling æ¥ Hook ç³»ç»Ÿçš„ delegate æ–¹æ³•ï¼Œ ä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>æ–°å»º UIWebView Category</li>
<li>Hook  UIWebView çš„ <code>delegate</code> æ–¹æ³•</li>
<li>Hook  <code>UIWebViewDelegate</code> åè®®ä¸­çš„å…·ä½“æ–¹æ³•</li>
</ul>
<h3 id="Hook-UIWebView-çš„ä»£ç†"><a href="#Hook-UIWebView-çš„ä»£ç†" class="headerlink" title="Hook  UIWebView çš„ä»£ç†"></a>Hook  UIWebView çš„ä»£ç†</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬åº”è¯¥æ˜ç™½ï¼Œå½“æˆ‘ä»¬æƒ³ Hook æŸä¸ªæ–¹æ³•å‡½æ•°æ—¶ï¼Œå¿…é¡»çŸ¥é“å¯¹åº”çš„ <code>class</code> ï¼Œæˆ‘ä»¬è¿™é‡Œä¹‹æ‰€ä»¥ Hook UIWebView çš„ delegateï¼Œä¸ºçš„å°±æ˜¯æ‰¾åˆ°ç»§æ‰¿äº† <code>UIWebViewDelegate</code> åè®®çš„ <code>class</code>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">void</span>)load &#123;</div><div class="line">    <span class="comment">// Hook UIWebView</span></div><div class="line">    Method originalMethod = class_getInstanceMethod([<span class="keyword">self</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(setDelegate:));</div><div class="line">    Method ownerMethod = class_getInstanceMethod([<span class="keyword">self</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(hook_setDelegate:));</div><div class="line">    method_exchangeImplementations(originalMethod, ownerMethod);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)hook_setDelegate:(<span class="keyword">id</span>&lt;<span class="built_in">UIWebViewDelegate</span>&gt;)delegate &#123;</div><div class="line"></div><div class="line">    [<span class="keyword">self</span> hook_setDelegate:delegate];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯ <code>class_getInstanceMethod</code> è€Œä¸æ˜¯ <code>class_getClassMethod</code> ï¼Œå› ä¸º <code>setDelegate :</code> æ˜¯å®ä¾‹æ–¹æ³•ã€‚å¦å¤–æˆ‘ä»¬è¿™é‡Œç”¨ <code>method_exchangeImplementations</code> ç›´æ¥äº¤æ¢äº†ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ <code>class_addMethod()</code> å‡½æ•°åˆ¤æ–­æ˜¯å› ä¸ºè¿™é‡Œä¸ä¼šå‡ºç°æ›¿æ¢çš„çˆ¶ç±»æ–¹æ³•çš„é—®é¢˜ã€‚</p>
<h3 id="Hook-åè®®ä¸­çš„å…·ä½“æ–¹æ³•"><a href="#Hook-åè®®ä¸­çš„å…·ä½“æ–¹æ³•" class="headerlink" title="Hook åè®®ä¸­çš„å…·ä½“æ–¹æ³•"></a>Hook åè®®ä¸­çš„å…·ä½“æ–¹æ³•</h3><p>åœ¨è¿™ä¹‹å‰ï¼Œå‡å¦‚æˆ‘ä»¬æƒ³è¦ Hook <code>webViewDidStartLoad:</code> æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘è¿™å‡ ç§æƒ…å†µï¼š</p>
<ul>
<li>ä»£ç†å¯¹è±¡å®ç°äº† <code>webViewDidStartLoad:</code> æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥äº¤æ¢å°±è¡Œã€‚</li>
<li>ä»£ç†å¯¹è±¡å¦‚æœæ²¡æœ‰å®ç° <code>webViewDidStartLoad:</code> æ–¹æ³•ï¼Œè€Œæˆ‘ä»¬åˆæƒ³ç›‘å¬æ—¶ï¼Œå°±éœ€è¦æˆ‘ä»¬åŠ¨æ€çš„æ·»åŠ  <code>webViewDidStartLoad:</code> æ–¹æ³•ã€‚</li>
<li><code>setDelegate :</code> ä¸‡ä¸€é‡å¤è®¾ç½®äº†ï¼Œä¼šå¯¼è‡´ <code>webViewDidStartLoad:</code> å¤šæ¬¡äº¤æ¢ï¼Œæˆ‘ä»¬éœ€è¦é¢„é˜²è¿™ç§æƒ…å†µã€‚</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">void</span> Hook_Method(Class originalClass, SEL originalSel, Class replacedClass, SEL replacedSel, SEL noneSel)&#123;</div><div class="line">    <span class="comment">// åŸå®ä¾‹æ–¹æ³•</span></div><div class="line">    Method originalMethod = class_getInstanceMethod(originalClass, originalSel);</div><div class="line">    <span class="comment">// æ›¿æ¢çš„å®ä¾‹æ–¹æ³•</span></div><div class="line">    Method replacedMethod = class_getInstanceMethod(replacedClass, replacedSel);</div><div class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰å®ç° delegate æ–¹æ³•ï¼Œåˆ™æ‰‹åŠ¨åŠ¨æ€æ·»åŠ </span></div><div class="line">    <span class="keyword">if</span> (!originalMethod) &#123;</div><div class="line">        Method noneMethod = class_getInstanceMethod(replacedClass, noneSel);</div><div class="line">        <span class="built_in">BOOL</span> didAddNoneMethod = class_addMethod(originalClass, originalSel, method_getImplementation(noneMethod), method_getTypeEncoding(noneMethod));</div><div class="line">        <span class="keyword">if</span> (didAddNoneMethod) &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"******** æ²¡æœ‰å®ç° (%@) æ–¹æ³•ï¼Œæ‰‹åŠ¨æ·»åŠ æˆåŠŸï¼ï¼"</span>,<span class="built_in">NSStringFromSelector</span>(originalSel));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// å‘å®ç° delegate çš„ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•</span></div><div class="line">    <span class="comment">// è¿™é‡Œæ˜¯å‘ originalClass çš„ replaceSelï¼ˆ@selector(owner_webViewDidStartLoad:)ï¼‰ æ·»åŠ  replaceMethod</span></div><div class="line">    <span class="built_in">BOOL</span> didAddMethod = class_addMethod(originalClass, replacedSel, method_getImplementation(replacedMethod), method_getTypeEncoding(replacedMethod));</div><div class="line">    <span class="keyword">if</span> (didAddMethod) &#123;</div><div class="line">        <span class="comment">// æ·»åŠ æˆåŠŸ</span></div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"******** å®ç°äº† (%@) æ–¹æ³•å¹¶æˆåŠŸ Hook ä¸º --&gt; (%@)"</span>,<span class="built_in">NSStringFromSelector</span>(originalSel) ,<span class="built_in">NSStringFromSelector</span>(replacedSel));</div><div class="line">        <span class="comment">// é‡æ–°æ‹¿åˆ°æ·»åŠ è¢«æ·»åŠ çš„ method,è¿™é‡Œæ˜¯å…³é”®(æ³¨æ„è¿™é‡Œ originalClass, ä¸ replacedClass), å› ä¸ºæ›¿æ¢çš„æ–¹æ³•å·²ç»æ·»åŠ åˆ°åŸç±»ä¸­äº†, åº”è¯¥äº¤æ¢åŸç±»ä¸­çš„ä¸¤ä¸ªæ–¹æ³•</span></div><div class="line">        Method newMethod = class_getInstanceMethod(originalClass, replacedSel);</div><div class="line">        <span class="comment">// å®ç°äº¤æ¢</span></div><div class="line">        method_exchangeImplementations(originalMethod, newMethod);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="comment">// æ·»åŠ å¤±è´¥ï¼Œåˆ™è¯´æ˜å·²ç» hook è¿‡è¯¥ç±»çš„ delegate æ–¹æ³•ï¼Œé˜²æ­¢å¤šæ¬¡äº¤æ¢ã€‚</span></div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"******** å·²æ›¿æ¢è¿‡ï¼Œé¿å…å¤šæ¬¡æ›¿æ¢ --&gt; (%@)"</span>,<span class="built_in">NSStringFromClass</span>(originalClass));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)hook_setDelegate:(<span class="keyword">id</span>&lt;<span class="built_in">UIWebViewDelegate</span>&gt;)delegate &#123;</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> hook_setDelegate:delegate];</div><div class="line">    </div><div class="line">    <span class="comment">//Hook (webViewDidStartLoad:) æ–¹æ³•</span></div><div class="line">    Hook_Method([delegate <span class="keyword">class</span>], <span class="keyword">@selector</span>(webViewDidStartLoad:), [<span class="keyword">self</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(owner_webViewDidStartLoad:), <span class="keyword">@selector</span>(none_webViewDidStartLoad:));</div><div class="line">    </div><div class="line">    <span class="comment">//Hook (webViewDidFinishLoad:) æ–¹æ³•</span></div><div class="line">    Hook_Method([delegate <span class="keyword">class</span>], <span class="keyword">@selector</span>(webViewDidFinishLoad:), [<span class="keyword">self</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(owner_webViewDidFinishLoad:), <span class="keyword">@selector</span>(none_webViewDidFinishLoad:));</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)owner_webViewDidStartLoad:(<span class="built_in">UIWebView</span> *)webView &#123;</div><div class="line">    </div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"*********** owner_webViewDidStartLoad:"</span>);</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> owner_webViewDidStartLoad:webView];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)none_webViewDidStartLoad:(<span class="built_in">UIWebView</span> *)webView &#123;</div><div class="line">    </div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"*********** none_webViewDidStartLoad:"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)owner_webViewDidFinishLoad:(<span class="built_in">UIWebView</span> *)webView &#123;</div><div class="line">    </div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"*********** owner_webViewDidFinishLoad:"</span>);</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> owner_webViewDidFinishLoad:webView];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)none_webViewDidFinishLoad:(<span class="built_in">UIWebView</span> *)webView &#123;</div><div class="line">    </div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"*********** none_webViewDidFinishLoad:"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å¦å¤–ï¼Œä¸ç®¡æˆ‘ä»¬æ˜¯çº¯ä»£ç è®¾ç½®çš„ UIWebView delegateï¼Œè¿˜æ˜¯é€šè¿‡ IB è®¾ç½®çš„ï¼Œéƒ½æ˜¯æ²¡é—®é¢˜~</p>
</blockquote>
<p>å®Œæ•´çš„ä»£ç åœ¨è¿™é‡Œ <a href="https://github.com/ifelseboyxx/xx_Notes/tree/master/contents/HookSystemDelegate/Hook_Delegate" target="_blank" rel="external">Demo</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å…³äº Method Swizzling åŸºæœ¬ç”¨æ³•å¯ä»¥å…ˆçœ‹çœ‹åšä¸»ä¹‹å‰çš„æ–‡ç«  &lt;a href=&quot;http://blog.ifelseboyxx.com/2017/01/25/Method-Swizzling/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æµ…è°ˆ
    
    </summary>
    
    
      <category term="ObjC" scheme="http://yoursite.com/tags/ObjC/"/>
    
      <category term="runtime" scheme="http://yoursite.com/tags/runtime/"/>
    
  </entry>
  
  <entry>
    <title>iOS å¼€å‘ä¸­çš„é”</title>
    <link href="http://yoursite.com/2017/11/15/lock/"/>
    <id>http://yoursite.com/2017/11/15/lock/</id>
    <published>2017-11-15T03:38:01.000Z</published>
    <updated>2018-02-13T09:03:02.146Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸¤å¤©ç¿»çœ‹ ibireme å¤§ç¥ <a href="http://blog.ibireme.com/" target="_blank" rel="external">ä¸å†å®‰å…¨çš„ OSSpinLock</a> è¿™ç¯‡æ–‡ç« ï¼Œçœ‹åˆ°æ–‡ä¸­åˆ†æå„ç§é”ä¹‹é—´çš„æ€§èƒ½çš„å›¾è¡¨ï¼Œæ€€ç€å¥½å¥‡çš„å¿ƒæ€ï¼Œå­¦ä¹ äº†ä¸‹é”ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-eb3ef0d444034362.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="lock_benchmark.png"></p>
<h2 id="é”æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"><a href="#é”æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ" class="headerlink" title="é”æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"></a>é”æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h2><p>æˆ‘ä»¬åœ¨ä½¿ç”¨å¤šçº¿ç¨‹çš„æ—¶å€™å¤šä¸ªçº¿ç¨‹å¯èƒ½ä¼šè®¿é—®åŒä¸€å—èµ„æºï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“å¼•å‘æ•°æ®é”™ä¹±å’Œæ•°æ®å®‰å…¨ç­‰é—®é¢˜ï¼Œè¿™æ—¶å€™å°±éœ€è¦æˆ‘ä»¬ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¿™ä¸€å—èµ„æºï¼Œ<strong>é”</strong>åº”è¿è€Œç”Ÿã€‚</p>
<h3 id="OSSpinLock"><a href="#OSSpinLock" class="headerlink" title="OSSpinLock"></a>OSSpinLock</h3><p>éœ€å¯¼å…¥å¤´æ–‡ä»¶:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;libkern/OSAtomic.h&gt;</span></span></div></pre></td></tr></table></figure>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">__block OSSpinLock oslock = OS_SPINLOCK_INIT;</div><div class="line"><span class="comment">//çº¿ç¨‹1  </span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">Â  Â  Â    <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1 å‡†å¤‡ä¸Šé”"</span>);</div><div class="line">Â  Â  Â    OSSpinLockLock(&amp;oslock);</div><div class="line">Â  Â  Â    sleep(<span class="number">4</span>);</div><div class="line">Â  Â  Â    <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1"</span>);</div><div class="line">Â  Â  Â    OSSpinLockUnlock(&amp;oslock);</div><div class="line">Â  Â  Â    <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1 è§£é”æˆåŠŸ"</span>);</div><div class="line">Â  Â  Â    <span class="built_in">NSLog</span>(<span class="string">@"--------------------------------------------------------"</span>);</div><div class="line">&#125;);</div><div class="line">Â  Â  </div><div class="line"><span class="comment">//çº¿ç¨‹2</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">Â  Â  Â    <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2 å‡†å¤‡ä¸Šé”"</span>);</div><div class="line">Â  Â  Â    OSSpinLockLock(&amp;oslock);</div><div class="line">Â  Â  Â    <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2"</span>);</div><div class="line">Â  Â  Â    OSSpinLockUnlock(&amp;oslock);</div><div class="line">Â  Â  Â    <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2 è§£é”æˆåŠŸ"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-da0bbfd046fc7e30.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="OSSpinLock1"></p>
<p>æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">__block OSSpinLock oslock = OS_SPINLOCK_INIT;</div><div class="line"><span class="comment">//çº¿ç¨‹1Â  Â      </span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">......</div><div class="line"><span class="comment">//OSSpinLockUnlock(&amp;oslock);</span></div><div class="line">......</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-5f6aeebcb8d9cb00.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="OSSpinLock2"></p>
<p>åœ¨  <code>OSSpinLock1</code> å›¾ä¸­å¯ä»¥å‘ç°ï¼šå½“æˆ‘ä»¬é”ä½çº¿ç¨‹1æ—¶ï¼Œåœ¨åŒæ—¶é”ä½çº¿ç¨‹2çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹2ä¼šä¸€ç›´ç­‰å¾…<strong>ï¼ˆè‡ªæ—‹é”ä¸ä¼šè®©ç­‰å¾…çš„è¿›å…¥ç¡çœ çŠ¶æ€ï¼‰</strong>ï¼Œç›´åˆ°çº¿ç¨‹1çš„ä»»åŠ¡æ‰§è¡Œå®Œä¸”è§£é”å®Œæ¯•ï¼Œçº¿ç¨‹2ä¼šç«‹å³æ‰§è¡Œï¼›è€Œåœ¨ <code>OSSpinLock2</code> å›¾ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬æ³¨é‡Šæ‰äº†çº¿ç¨‹1ä¸­çš„è§£é”ä»£ç ï¼Œä¼šç»•è¿‡çº¿ç¨‹1ï¼Œç›´åˆ°è°ƒç”¨äº†çº¿ç¨‹2çš„è§£é”æ–¹æ³•æ‰ä¼šç»§ç»­æ‰§è¡Œçº¿ç¨‹1ä¸­çš„ä»»åŠ¡ï¼Œ<strong>æ­£å¸¸æƒ…å†µä¸‹ï¼Œ<code>lock</code>å’Œ<code>unlock</code>æœ€å¥½æˆå¯¹å‡ºç°</strong>ã€‚</p>
<blockquote>
<p><strong>OS_SPINLOCK_INITï¼š</strong> é»˜è®¤å€¼ä¸º <code>0</code>,åœ¨ <code>locked</code> çŠ¶æ€æ—¶å°±ä¼šå¤§äº <code>0</code>ï¼Œ<code>unlocked</code>çŠ¶æ€ä¸‹ä¸º <code>0</code><br><strong>OSSpinLockLock(&amp;oslock)ï¼š</strong>ä¸Šé”ï¼Œå‚æ•°ä¸º <code>OSSpinLock</code> åœ°å€<br><strong>OSSpinLockUnlock(&amp;oslock)ï¼š</strong>è§£é”ï¼Œå‚æ•°ä¸º <code>OSSpinLock</code> åœ°å€<br><strong>OSSpinLockTry(&amp;oslock)</strong>ï¼šå°è¯•åŠ é”ï¼Œå¯ä»¥åŠ é”åˆ™<strong>ç«‹å³åŠ é”</strong>å¹¶è¿”å› <code>YES</code>,åä¹‹è¿”å› <code>NO</code></p>
</blockquote>
<p>è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹ <code>trylock</code> å’Œ <code>lock</code> ä½¿ç”¨åœºæ™¯ï¼š</p>
<blockquote>
<p>å½“å‰çº¿ç¨‹é”å¤±è´¥ï¼Œä¹Ÿå¯ä»¥ç»§ç»­å…¶å®ƒä»»åŠ¡ï¼Œç”¨ trylock åˆé€‚<br>å½“å‰çº¿ç¨‹åªæœ‰é”æˆåŠŸåï¼Œæ‰ä¼šåšä¸€äº›æœ‰æ„ä¹‰çš„å·¥ä½œï¼Œé‚£å°± lockï¼Œæ²¡å¿…è¦è½®è¯¢ trylock</p>
</blockquote>
<h3 id="dispatch-semaphore-ä¿¡å·é‡"><a href="#dispatch-semaphore-ä¿¡å·é‡" class="headerlink" title="dispatch_semaphore ä¿¡å·é‡"></a>dispatch_semaphore ä¿¡å·é‡</h3><p>ä¾‹å­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">dispatch_semaphore_t signal = dispatch_semaphore_create(<span class="number">1</span>); <span class="comment">//ä¼ å…¥å€¼å¿…é¡» &gt;=0, è‹¥ä¼ å…¥ä¸º0åˆ™é˜»å¡çº¿ç¨‹å¹¶ç­‰å¾…timeout,æ—¶é—´åˆ°åä¼šæ‰§è¡Œå…¶åçš„è¯­å¥</span></div><div class="line">dispatch_time_t overTime = dispatch_time(DISPATCH_TIME_NOW, <span class="number">3.0</span>f * <span class="built_in">NSEC_PER_SEC</span>);</div><div class="line"></div><div class="line"><span class="comment">//çº¿ç¨‹1</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">Â  Â      <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1 ç­‰å¾…ing"</span>);</div><div class="line">Â  Â      dispatch_semaphore_wait(signal, overTime); <span class="comment">//signal å€¼ -1</span></div><div class="line">Â  Â      <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1"</span>);</div><div class="line">Â  Â      dispatch_semaphore_signal(signal); <span class="comment">//signal å€¼ +1</span></div><div class="line">Â  Â      <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1 å‘é€ä¿¡å·"</span>);</div><div class="line">Â  Â  Â    <span class="built_in">NSLog</span>(<span class="string">@"--------------------------------------------------------"</span>);</div><div class="line">&#125;);</div><div class="line">Â Â  Â </div><div class="line"><span class="comment">//çº¿ç¨‹2</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2 ç­‰å¾…ing"</span>);</div><div class="line">Â  Â  Â  Â  dispatch_semaphore_wait(signal, overTime);</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2"</span>);</div><div class="line">Â  Â  Â  Â  dispatch_semaphore_signal(signal);</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2 å‘é€ä¿¡å·"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>dispatch_semaphore_create(1)ï¼š</strong> ä¼ å…¥å€¼å¿…é¡» <code>&gt;=0</code>, è‹¥ä¼ å…¥ä¸º <code>0</code> åˆ™é˜»å¡çº¿ç¨‹å¹¶ç­‰å¾…timeout,æ—¶é—´åˆ°åä¼šæ‰§è¡Œå…¶åçš„è¯­å¥<br><strong>dispatch_semaphore_wait(signal, overTime)ï¼š</strong>å¯ä»¥ç†è§£ä¸º <code>lock</code>,ä¼šä½¿å¾— <code>signal</code> å€¼ <code>-1</code><br><strong>dispatch_semaphore_signal(signal)ï¼š</strong>å¯ä»¥ç†è§£ä¸º <code>unlock</code>,ä¼šä½¿å¾— <code>signal</code> å€¼ <code>+1</code></p>
</blockquote>
<p>å…³äºä¿¡å·é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åœè½¦æ¥æ¯”å–»ï¼š</p>
<blockquote>
<p>åœè½¦åœºå‰©ä½™4ä¸ªè½¦ä½ï¼Œé‚£ä¹ˆå³ä½¿åŒæ—¶æ¥äº†å››è¾†è½¦ä¹Ÿèƒ½åœçš„ä¸‹ã€‚å¦‚æœæ­¤æ—¶æ¥äº†äº”è¾†è½¦ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€è¾†éœ€è¦ç­‰å¾…ã€‚<br><strong>ä¿¡å·é‡çš„å€¼ï¼ˆsignalï¼‰</strong>å°±ç›¸å½“äºå‰©ä½™è½¦ä½çš„æ•°ç›®ï¼Œ<code>dispatch_semaphore_wait</code> å‡½æ•°å°±ç›¸å½“äºæ¥äº†ä¸€è¾†è½¦ï¼Œ<code>dispatch_semaphore_signal</code> å°±ç›¸å½“äºèµ°äº†ä¸€è¾†è½¦ã€‚åœè½¦ä½çš„å‰©ä½™æ•°ç›®åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±å·²ç»æŒ‡æ˜äº†ï¼ˆdispatch_semaphore_createï¼ˆlong valueï¼‰ï¼‰ï¼Œè°ƒç”¨ä¸€æ¬¡ dispatch_semaphore_signalï¼Œå‰©ä½™çš„è½¦ä½å°±å¢åŠ ä¸€ä¸ªï¼›è°ƒç”¨ä¸€æ¬¡ dispatch_semaphore_wait  å‰©ä½™è½¦ä½å°±å‡å°‘ä¸€ä¸ªï¼›å½“å‰©ä½™è½¦ä½ä¸º 0 æ—¶ï¼Œå†æ¥è½¦ï¼ˆå³è°ƒç”¨ dispatch_semaphore_waitï¼‰å°±åªèƒ½ç­‰å¾…ã€‚æœ‰å¯èƒ½åŒæ—¶æœ‰å‡ è¾†è½¦ç­‰å¾…ä¸€ä¸ªåœè½¦ä½ã€‚æœ‰äº›è½¦ä¸»æ²¡æœ‰è€å¿ƒï¼Œç»™è‡ªå·±è®¾å®šäº†ä¸€æ®µç­‰å¾…æ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å†…ç­‰ä¸åˆ°åœè½¦ä½å°±èµ°äº†ï¼Œå¦‚æœç­‰åˆ°äº†å°±å¼€è¿›å»åœè½¦ã€‚è€Œæœ‰äº›è½¦ä¸»å°±åƒæŠŠè½¦åœåœ¨è¿™ï¼Œæ‰€ä»¥å°±ä¸€ç›´ç­‰ä¸‹å»ã€‚</p>
</blockquote>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-e45133dc53c7b53d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆå§‹ä¿¡å·é‡å¤§äº0"></p>
<p>å¯ä»¥å‘ç°ï¼Œå› ä¸ºæˆ‘ä»¬åˆå§‹åŒ–ä¿¡å·é‡çš„æ—¶å€™æ˜¯å¤§äº <code>0</code> çš„ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰é˜»å¡çº¿ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œäº† çº¿ç¨‹1 çº¿ç¨‹2ã€‚</p>
<p>æˆ‘ä»¬æŠŠ ä¿¡å·é‡åˆå§‹å€¼æ”¹ä¸º <code>0</code>:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dispatch_semaphore_t signal = dispatch_semaphore_create(<span class="number">0</span>);</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-378750ef97bd0959.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆå§‹ä¿¡å·é‡ä¸º0"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™æ—¶å€™æˆ‘ä»¬è®¾ç½®çš„ <code>overTime</code> ç”Ÿæ•ˆäº†ã€‚</p>
<h3 id="pthread-mutex"><a href="#pthread-mutex" class="headerlink" title="pthread_mutex"></a>pthread_mutex</h3><p>ibireme åœ¨ã€Š<a href="http://blog.ibireme.com/" target="_blank" rel="external">ä¸å†å®‰å…¨çš„ OSSpinLock</a>ã€‹è¿™ç¯‡æ–‡ç« ä¸­æåˆ°æ€§èƒ½æœ€å¥½çš„ <code>OSSpinLock</code> å·²ç»ä¸å†æ˜¯çº¿ç¨‹å®‰å…¨çš„å¹¶æŠŠè‡ªå·±å¼€æºé¡¹ç›®ä¸­çš„ <code>OSSpinLock</code> éƒ½æ›¿æ¢æˆäº† <code>pthread_mutex</code>ã€‚<br>ç‰¹æ„å»çœ‹äº†ä¸‹æºç ï¼Œæ€»ç»“äº†ä¸‹å¸¸è§ç”¨æ³•ï¼š</p>
<p>ä½¿ç”¨éœ€å¯¼å…¥å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;pthread.h&gt;</span></span></div></pre></td></tr></table></figure>
<p>ä¾‹å­:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> pthread_mutex_t pLock;</div><div class="line">pthread_mutex_init(&amp;pLock, <span class="literal">NULL</span>);</div><div class="line"><span class="comment">//1.çº¿ç¨‹1</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1 å‡†å¤‡ä¸Šé”"</span>);</div><div class="line">        pthread_mutex_lock(&amp;pLock);</div><div class="line">        sleep(<span class="number">3</span>);</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1"</span>);</div><div class="line">        pthread_mutex_unlock(&amp;pLock);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line"><span class="comment">//1.çº¿ç¨‹2</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2 å‡†å¤‡ä¸Šé”"</span>);</div><div class="line">        pthread_mutex_lock(&amp;pLock);</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2"</span>);</div><div class="line">        pthread_mutex_unlock(&amp;pLock);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-f051bcdb173e8612.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="pthread_mutex"></p>
<blockquote>
<p>pthread_mutex ä¸­ä¹Ÿæœ‰ä¸ª <code>pthread_mutex_trylock(&amp;pLock)</code>ï¼Œå’Œä¸Šé¢æåˆ°çš„ <code>OSSpinLockTry(&amp;oslock)</code> åŒºåˆ«åœ¨äºï¼Œå‰è€…å¯ä»¥åŠ é”æ—¶è¿”å›çš„æ˜¯ <code>0</code>ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªé”™è¯¯æç¤ºç ï¼›åè€…è¿”å›çš„ <code>YES</code>å’Œ <code>NO</code>ã€‚</p>
</blockquote>
<p>è¿™é‡Œè´´ä¸ª  <a href="https://github.com/ibireme/YYKit" target="_blank" rel="external">YYKit</a> ä¸­çš„æºç ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-48d96143d13a9371.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="YYKit"></p>
<h3 id="pthread-mutex-recursive"><a href="#pthread-mutex-recursive" class="headerlink" title="pthread_mutex(recursive)"></a>pthread_mutex(recursive)</h3><p>ç»è¿‡ä¸Šé¢å‡ ç§ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼šåŠ é”ååªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¯¥å¯¹è±¡ï¼Œåé¢çš„çº¿ç¨‹éœ€è¦æ’é˜Ÿï¼Œå¹¶ä¸” lock å’Œ unlock æ˜¯å¯¹åº”å‡ºç°çš„ï¼ŒåŒä¸€çº¿ç¨‹å¤šæ¬¡ lock æ˜¯ä¸å…è®¸çš„ï¼Œè€Œé€’å½’é”å…è®¸åŒä¸€ä¸ªçº¿ç¨‹åœ¨æœªé‡Šæ”¾å…¶æ‹¥æœ‰çš„é”æ—¶åå¤å¯¹è¯¥é”è¿›è¡ŒåŠ é”æ“ä½œã€‚</p>
<p>ä¾‹å­:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> pthread_mutex_t pLock;</div><div class="line">pthread_mutexattr_t attr;</div><div class="line">pthread_mutexattr_init(&amp;attr); <span class="comment">//åˆå§‹åŒ–attrå¹¶ä¸”ç»™å®ƒèµ‹äºˆé»˜è®¤</span></div><div class="line">pthread_mutexattr_settype(&amp;attr, PTHREAD_MUTEX_RECURSIVE); <span class="comment">//è®¾ç½®é”ç±»å‹ï¼Œè¿™è¾¹æ˜¯è®¾ç½®ä¸ºé€’å½’é”</span></div><div class="line">pthread_mutex_init(&amp;pLock, &amp;attr);</div><div class="line">pthread_mutexattr_destroy(&amp;attr); <span class="comment">//é”€æ¯ä¸€ä¸ªå±æ€§å¯¹è±¡ï¼Œåœ¨é‡æ–°è¿›è¡Œåˆå§‹åŒ–ä¹‹å‰è¯¥ç»“æ„ä¸èƒ½é‡æ–°ä½¿ç”¨</span></div><div class="line"></div><div class="line"><span class="comment">//1.çº¿ç¨‹1</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">void</span> (^RecursiveBlock)(<span class="keyword">int</span>);</div><div class="line">        RecursiveBlock = ^(<span class="keyword">int</span> value) &#123;</div><div class="line">            pthread_mutex_lock(&amp;pLock);</div><div class="line">            <span class="keyword">if</span> (value &gt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="built_in">NSLog</span>(<span class="string">@"value: %d"</span>, value);</div><div class="line">                RecursiveBlock(value - <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">            pthread_mutex_unlock(&amp;pLock);</div><div class="line">        &#125;;</div><div class="line">        RecursiveBlock(<span class="number">5</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-ed159b5987a9aaed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç»“æœ"></p>
<blockquote>
<p>ä¸Šé¢çš„ä»£ç å¦‚æœæˆ‘ä»¬ç”¨ <code>pthread_mutex_init(&amp;pLock, NULL)</code> åˆå§‹åŒ–ä¼šå‡ºç°æ­»é”çš„æƒ…å†µï¼Œé€’å½’é”èƒ½å¾ˆå¥½çš„é¿å…è¿™ç§æƒ…å†µçš„æ­»é”ï¼›</p>
</blockquote>
<h3 id="NSLock"><a href="#NSLock" class="headerlink" title="NSLock"></a>NSLock</h3><p>NSLock API å¾ˆå°‘ä¹Ÿå¾ˆç®€å•:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-fd930ccf5d969f6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NSLock"></p>
<blockquote>
<p><strong>lockã€unlock</strong>ï¼šä¸å¤šåšè§£é‡Šï¼Œå’Œä¸Šé¢ä¸€æ ·<br><strong>trylock</strong>ï¼šèƒ½åŠ é”è¿”å› YES å¹¶æ‰§è¡Œ<strong>åŠ é”</strong>æ“ä½œï¼Œç›¸å½“äº lockï¼Œåä¹‹è¿”å› NO<br><strong> lockBeforeDateï¼š</strong>è¿™ä¸ªæ–¹æ³•è¡¨ç¤ºä¼šåœ¨ä¼ å…¥çš„æ—¶é—´å†…å°è¯•åŠ é”ï¼Œè‹¥èƒ½åŠ é”åˆ™æ‰§è¡Œ<strong>åŠ é”</strong>æ“ä½œå¹¶è¿”å› YESï¼Œåä¹‹è¿”å› NO</p>
</blockquote>
<p>ä¾‹å­:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSLock</span> *lock = [<span class="built_in">NSLock</span> new];</div><div class="line"><span class="comment">//çº¿ç¨‹1</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1 å°è¯•åŠ é€Ÿing..."</span>);</div><div class="line">        [lock lock];</div><div class="line">        sleep(<span class="number">3</span>);<span class="comment">//ç¡çœ 5ç§’</span></div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1"</span>);</div><div class="line">        [lock unlock];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1è§£é”æˆåŠŸ"</span>);</div><div class="line">&#125;);</div><div class="line"><span class="comment">//çº¿ç¨‹2</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2 å°è¯•åŠ é€Ÿing..."</span>);</div><div class="line">        <span class="built_in">BOOL</span> x =  [lock lockBeforeDate:[<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:<span class="number">4</span>]];</div><div class="line">        <span class="keyword">if</span> (x) &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2"</span>);</div><div class="line">            [lock unlock];</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"å¤±è´¥"</span>);</div><div class="line">        &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-471bcb7fcc0bcfea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NSLock_result"></p>
<h3 id="NSCondition"><a href="#NSCondition" class="headerlink" title="NSCondition"></a>NSCondition</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ APIï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-231a3255007492fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NSCondition"></p>
<p>çœ‹å­—é¢æ„æ€å¾ˆå¥½ç†è§£:</p>
<blockquote>
<p><strong>wait</strong>ï¼šè¿›å…¥ç­‰å¾…çŠ¶æ€<br><strong>waitUntilDate:</strong>ï¼šè®©ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…ä¸€å®šçš„æ—¶é—´<br><strong>signal</strong>ï¼šå”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹<br><strong>broadcast</strong>ï¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹</p>
</blockquote>
<p>ä¾‹å­:</p>
<ul>
<li><strong>ç­‰å¾…2ç§’</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSCondition</span> *cLock = [<span class="built_in">NSCondition</span> new];</div><div class="line"><span class="comment">//çº¿ç¨‹1</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"start"</span>);</div><div class="line">        [cLock lock];</div><div class="line">        [cLock waitUntilDate:[<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:<span class="number">2</span>]];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1"</span>);</div><div class="line">        [cLock unlock];</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>ç»“æœ:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-7ff9328f53551846.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="waiting 2ç§’"></p>
<ul>
<li><strong>å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSCondition</span> *cLock = [<span class="built_in">NSCondition</span> new];</div><div class="line"><span class="comment">//çº¿ç¨‹1</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        [cLock lock];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1åŠ é”æˆåŠŸ"</span>);</div><div class="line">        [cLock wait];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1"</span>);</div><div class="line">        [cLock unlock];</div><div class="line">&#125;);</div><div class="line">    </div><div class="line"><span class="comment">//çº¿ç¨‹2</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        [cLock lock];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2åŠ é”æˆåŠŸ"</span>);</div><div class="line">        [cLock wait];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2"</span>);</div><div class="line">        [cLock unlock];</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        sleep(<span class="number">2</span>);</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹"</span>);</div><div class="line">        [cLock signal];</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>ç»“æœ:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-e587d966e6f34c92.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹"></p>
<ul>
<li><strong>å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">.........    </div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        sleep(<span class="number">2</span>);</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹"</span>);</div><div class="line">        [cLock broadcast];</div><div class="line"> &#125;);</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-f7c07e6e2c031088.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å”¤é†’æ‰€æœ‰çš„çº¿ç¨‹"></p>
<h3 id="NSRecursiveLock"><a href="#NSRecursiveLock" class="headerlink" title="NSRecursiveLock"></a>NSRecursiveLock</h3><p>ä¸Šé¢å·²ç»å¤§æ¦‚ä»‹ç»è¿‡äº†ï¼š<br>é€’å½’é”å¯ä»¥è¢«åŒä¸€çº¿ç¨‹å¤šæ¬¡è¯·æ±‚ï¼Œè€Œä¸ä¼šå¼•èµ·æ­»é”ã€‚è¿™ä¸»è¦æ˜¯ç”¨åœ¨å¾ªç¯æˆ–é€’å½’æ“ä½œä¸­ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSLock</span> *rLock = [<span class="built_in">NSLock</span> new];</div><div class="line">Â  Â  <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">static</span> <span class="keyword">void</span> (^RecursiveBlock)(<span class="keyword">int</span>);</div><div class="line">Â  Â  Â  Â  RecursiveBlock = ^(<span class="keyword">int</span> value) &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  [rLock lock];</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (value &gt; <span class="number">0</span>) &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹%d"</span>, value);</div><div class="line">Â  Â  Â  Â  Â  Â  Â  Â  RecursiveBlock(value - <span class="number">1</span>);</div><div class="line">Â  Â  Â  Â  Â  Â  &#125;</div><div class="line">Â  Â  Â  Â  Â  Â  [rLock unlock];</div><div class="line">Â  Â  Â  Â  &#125;;</div><div class="line">Â  Â  Â  Â  RecursiveBlock(<span class="number">4</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-9502f58fa9244b5f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é”™è¯¯ä¿¡æ¯"></p>
<p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªå…¸å‹çš„æ­»é”æƒ…å†µã€‚åœ¨æˆ‘ä»¬çš„çº¿ç¨‹ä¸­ï¼Œ<code>RecursiveMethod</code> æ˜¯é€’å½’è°ƒç”¨çš„ã€‚æ‰€ä»¥æ¯æ¬¡è¿›å…¥è¿™ä¸ª block æ—¶ï¼Œéƒ½ä¼šå»<strong>åŠ ä¸€æ¬¡é”</strong>ï¼Œè€Œä»ç¬¬äºŒæ¬¡å¼€å§‹ï¼Œç”±äºé”å·²ç»è¢«ä½¿ç”¨äº†ä¸”<strong>æ²¡æœ‰è§£é”</strong>ï¼Œæ‰€ä»¥å®ƒ<strong>éœ€è¦ç­‰å¾…é”è¢«è§£é™¤</strong>ï¼Œè¿™æ ·å°±å¯¼è‡´äº†æ­»é”ï¼Œçº¿ç¨‹è¢«é˜»å¡ä½äº†ã€‚</p>
<p>å°† NSLock æ›¿æ¢ä¸º NSRecursiveLockï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSRecursiveLock</span> *rLock = [<span class="built_in">NSRecursiveLock</span> new];</div><div class="line">..........</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-58b8575d0ba80cb3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NSRecursiveLock"></p>
<p>NSRecursiveLock æ–¹æ³•é‡Œè¿˜æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œç”¨æ³•å’Œä¸Šé¢ä»‹ç»çš„åŸºæœ¬æ²¡ä»€ä¹ˆå·®åˆ«ï¼Œè¿™é‡Œä¸è¿‡å¤šä»‹ç»äº†ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)tryLock;</div><div class="line">- (<span class="built_in">BOOL</span>)lockBeforeDate:(<span class="built_in">NSDate</span> *)limit;</div></pre></td></tr></table></figure>
<h3 id="synchronized"><a href="#synchronized" class="headerlink" title="@synchronized"></a>@synchronized</h3><p>@synchronized ç›¸ä¿¡å¤§å®¶åº”è¯¥éƒ½ç†Ÿæ‚‰ï¼Œå®ƒçš„ç”¨æ³•åº”è¯¥ç®—è¿™äº›é”ä¸­æœ€ç®€å•çš„:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//çº¿ç¨‹1</span></div><div class="line">Â  Â  <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">@synchronized</span> (<span class="keyword">self</span>) &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  sleep(<span class="number">2</span>);</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1"</span>);</div><div class="line">Â  Â  Â  Â  &#125;</div><div class="line">Â  Â  &#125;);</div><div class="line">Â Â  Â </div><div class="line"><span class="comment">//çº¿ç¨‹2</span></div><div class="line">Â  Â  <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">@synchronized</span> (<span class="keyword">self</span>) &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2"</span>);</div><div class="line">Â  Â  Â  Â  &#125;</div><div class="line">Â  Â  &#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>æœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç«  ã€Š <a href="http://ios.jobbole.com/82826/" target="_blank" rel="external">å…³äº @synchronizedï¼Œè¿™å„¿æ¯”ä½ æƒ³çŸ¥é“çš„è¿˜è¦å¤š</a>ã€‹</p>
</blockquote>
<h3 id="NSConditionLock-æ¡ä»¶é”"><a href="#NSConditionLock-æ¡ä»¶é”" class="headerlink" title="NSConditionLock æ¡ä»¶é”"></a>NSConditionLock æ¡ä»¶é”</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ API :</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-95362ad47a95575c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NSConditionLock"></p>
<p>ç›¸æ¯”äº NSLock å¤šäº†ä¸ª <code>condition</code> å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä¸€ä¸ª<strong>æ¡ä»¶æ ‡ç¤º</strong>ã€‚</p>
<p>ä¾‹å­:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSConditionLock</span> *cLock = [[<span class="built_in">NSConditionLock</span> alloc] initWithCondition:<span class="number">0</span>];</div><div class="line"><span class="comment">//çº¿ç¨‹1</span></div><div class="line"></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        <span class="keyword">if</span>([cLock tryLockWhenCondition:<span class="number">0</span>])&#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹1"</span>);</div><div class="line">           [cLock unlockWithCondition:<span class="number">1</span>];</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">             <span class="built_in">NSLog</span>(<span class="string">@"å¤±è´¥"</span>);</div><div class="line">        &#125;</div><div class="line">&#125;);</div><div class="line">    </div><div class="line"><span class="comment">//çº¿ç¨‹2</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        [cLock lockWhenCondition:<span class="number">3</span>];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹2"</span>);</div><div class="line">        [cLock unlockWithCondition:<span class="number">2</span>];</div><div class="line">&#125;);</div><div class="line">    </div><div class="line"><span class="comment">//çº¿ç¨‹3</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        [cLock lockWhenCondition:<span class="number">1</span>];</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"çº¿ç¨‹3"</span>);</div><div class="line">        [cLock unlockWithCondition:<span class="number">3</span>];</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1899027-7e410aff9dba4060.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<ul>
<li>æˆ‘ä»¬åœ¨åˆå§‹åŒ– NSConditionLock å¯¹è±¡æ—¶ï¼Œç»™äº†ä»–çš„æ ‡ç¤ºä¸º <code>0</code></li>
<li>æ‰§è¡Œ <code>tryLockWhenCondition:</code> æ—¶ï¼Œæˆ‘ä»¬ä¼ å…¥çš„æ¡ä»¶æ ‡ç¤ºä¹Ÿæ˜¯ <code>0</code>,æ‰€ <strong>ä»¥çº¿ç¨‹1</strong> åŠ é”æˆåŠŸ</li>
<li>æ‰§è¡Œ <code>unlockWithCondition:</code> æ—¶ï¼Œ<strong>è¿™æ—¶å€™ä¼šæŠŠ <code>condition</code> ç”± <code>0</code> ä¿®æ”¹ä¸º <code>1</code> </strong></li>
<li>å› ä¸º <code>condition</code>  ä¿®æ”¹ä¸ºäº†  <code>1</code>ï¼Œ ä¼šå…ˆèµ°åˆ° <strong>çº¿ç¨‹3</strong>ï¼Œç„¶å <strong>çº¿ç¨‹3</strong> åˆå°† <code>condition</code> ä¿®æ”¹ä¸º <code>3</code></li>
<li>æœ€å èµ°äº† <strong>çº¿ç¨‹2</strong> çš„æµç¨‹</li>
</ul>
<blockquote>
<p>ä»ä¸Šé¢çš„ç»“æœæˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒNSConditionLock è¿˜å¯ä»¥å®ç°ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–ã€‚</p>
</blockquote>
<h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®:"></a>å‚è€ƒæ–‡çŒ®:</h3><p><a href="http://www.cocoachina.com/ios/20150513/11808.html" target="_blank" rel="external">NSRecursiveLocké€’å½’é”çš„ä½¿ç”¨</a></p>
<p><a href="http://www.cnblogs.com/snailHL/p/3906112.html" target="_blank" rel="external">å…³äºdispatch_semaphoreçš„ä½¿ç”¨</a></p>
<p><a href="http://www.cnblogs.com/huangjianwu/p/4575763.html" target="_blank" rel="external">å®ç°é”çš„å¤šç§æ–¹å¼å’Œé”çš„é«˜çº§ç”¨æ³•</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™ä¸¤å¤©ç¿»çœ‹ ibireme å¤§ç¥ &lt;a href=&quot;http://blog.ibireme.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ä¸å†å®‰å…¨çš„ OSSpinLock&lt;/a&gt; è¿™ç¯‡æ–‡ç« ï¼Œçœ‹åˆ°æ–‡ä¸­åˆ†æå„ç§é”ä¹‹é—´çš„æ€§èƒ½çš„å›¾è¡¨ï¼Œæ€€ç€å¥½å¥‡çš„å¿ƒæ€ï¼Œå­¦ä¹ 
    
    </summary>
    
    
      <category term="ObjC" scheme="http://yoursite.com/tags/ObjC/"/>
    
  </entry>
  
  <entry>
    <title>iOS ä¸­å…³äºåˆ—è¡¨æ»šåŠ¨æµç•…æ–¹æ¡ˆçš„ä¸€äº›æ¢è®¨</title>
    <link href="http://yoursite.com/2017/09/06/smooth_tableview/"/>
    <id>http://yoursite.com/2017/09/06/smooth_tableview/</id>
    <published>2017-09-06T15:30:29.000Z</published>
    <updated>2018-02-13T09:05:26.378Z</updated>
    
    <content type="html"><![CDATA[<p>è¿‘äº›å¹´ï¼ŒApp è¶Šæ¥è¶Šæ¨å´‡ä½“éªŒè‡³ä¸Šï¼Œéšéšä¾¿ä¾¿ä¹±å†™ä¸€é€šçš„è¯å·²ç»å¾ˆéš¾è®©ç”¨æˆ·ä¹°å¸äº†ï¼Œé¡ºæ»‘çš„åˆ—è¡¨ä¾¿æ˜¯å…¶ä¸­å¾ˆé‡è¦çš„ä¸€ç‚¹ã€‚å¦‚æœä¸€ä¸ª App çš„é¡µé¢æ»šåŠ¨èµ·æ¥æ€»æ˜¯å¡é¡¿å¡é¡¿çš„ï¼Œè½»åˆ™è¢«å½“ä½œåé¢æ•™ææ¥åæ§½æˆ–è€…è¡¬æ‰˜â€œæˆ‘ä»¬çš„ App balabalaâ€¦â€ï¼Œé‡åˆ™ç›´æ¥å¸è½½ã€‚æ­£å¥½æœ€è¿‘åœ¨ä¼˜åŒ–è¿™ä¸€å—å„¿ï¼Œæ€»ç»“è®°å½•ä¸‹ã€‚</p>
<p>å¦‚æœè¯´æœ‰ä»€ä¹ˆå¥½çš„åšå®¢æ–‡ç« æ¨èï¼Œibireme  çš„  <a href="https://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/" target="_blank" rel="external">iOS ä¿æŒç•Œé¢æµç•…çš„æŠ€å·§</a> è¿™ç¯‡å ªç§°ç»å…¸ï¼Œå¢™è£‚æ¨èåå¤é˜…è¯»ã€‚è¿™ç¯‡æ–‡ç« ä¸­è®²è§£äº†å¾ˆå¤šçš„ä¼˜åŒ–ç‚¹ï¼Œæˆ‘è‡ªå·±æ€»ç»“äº†ä¸‹æ”¶ç›Šæœ€å¤§çš„ä¸¤ä¸ªä¼˜åŒ–ç‚¹ï¼š</p>
<ul>
<li>é¿å…é‡å¤å¤šæ¬¡è®¡ç®— cell è¡Œé«˜</li>
<li>æ–‡æœ¬å¼‚æ­¥æ¸²æŸ“</li>
</ul>
<p><img src="/images/asyn.png" alt=""></p>
<p>å¤§å®¶å¯ä»¥çœ‹çœ‹ä¸Šé¢è¿™å¼ å›¾çš„å¯¹æ¯”åˆ†æï¼Œæ•°æ®æ˜¯ iPhone6 çš„æœºå­ç”¨ instruments æŠ“çš„ï¼Œå·¦è¾¹çš„æ˜¯ç”¨ Auto Layout ç»˜åˆ¶ç•Œé¢çš„æ•°æ®åˆ†æï¼Œæ­£å¸¸å¦‚æœæƒ³å¹³æ»‘æ»šåŠ¨çš„è¯ï¼Œfps è‡³å°‘éœ€è¦ç¨³å®šåœ¨ 55 å·¦å³ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨æ²¡æœ‰ç¼“å­˜è¡Œé«˜å’Œå¼‚æ­¥æ¸²æŸ“çš„æƒ…å†µä¸‹ fps æ˜¯æœ€ä½çš„ï¼Œå¯ä»¥è¯´æ˜¯æ¯”è¾ƒå¡é¡¿äº†ï¼Œè‡³å°‘æ˜¯èƒ½è‚‰çœ¼æ„Ÿè§‰å‡ºæ¥ï¼Œèƒ½æ»¡è¶³å¹³æ»‘æ»šåŠ¨è¦æ±‚çš„ä¹Ÿåªæœ‰åœ¨ç¼“å­˜è¡Œé«˜ä¸”å¼‚æ­¥æ¸²æŸ“çš„æƒ…å†µä¸‹ï¼›å³è¾¹çš„æ˜¯æ²¡ç”¨ Auto Layout ç›´æ¥ç”¨ frame æ¥ç»˜åˆ¶ç•Œé¢çš„æ•°æ®åˆ†æï¼Œå¯ä»¥å‘ç°å³ä½¿æ²¡æœ‰å¼‚æ­¥æ¸²æŸ“ï¼Œä¹Ÿèƒ½å‹‰å¼ºæ»¡è¶³å¹³æ»‘æ»šåŠ¨çš„è¦æ±‚ï¼Œå¦‚æœå¼€å¯å¼‚æ­¥æ¸²æŸ“çš„è¯ï¼Œå¯ä»¥è¯´æ˜¯ç›¸å½“çš„ä¸æ»‘äº†ã€‚</p>
<h3 id="é¿å…é‡å¤å¤šæ¬¡è®¡ç®—-cell-è¡Œé«˜"><a href="#é¿å…é‡å¤å¤šæ¬¡è®¡ç®—-cell-è¡Œé«˜" class="headerlink" title="é¿å…é‡å¤å¤šæ¬¡è®¡ç®— cell è¡Œé«˜"></a>é¿å…é‡å¤å¤šæ¬¡è®¡ç®— cell è¡Œé«˜</h3><p>TableView è¡Œé«˜è®¡ç®—å¯ä»¥è¯´æ˜¯ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜äº†ï¼Œ<code>heightForRowAtIndexPath:</code>  æ˜¯ä¸ªè°ƒç”¨ç›¸å½“é¢‘ç¹çš„æ–¹æ³•ï¼Œåœ¨é‡Œé¢åšè¿‡å¤šçš„äº‹æƒ…éš¾å…ä¼šé€ æˆå¡é¡¿ã€‚ åœ¨ iOS 8 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®ä¸‹é¢ä¸¤ä¸ªå±æ€§æ¥å¾ˆè½»æ¾çš„å®ç°é«˜åº¦è‡ªé€‚åº”ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.tableView.estimatedRowHeight = <span class="number">88</span>;</div><div class="line"><span class="keyword">self</span>.tableView.rowHeight = <span class="built_in">UITableViewAutomaticDimension</span>;</div></pre></td></tr></table></figure>
<p>è™½ç„¶å¾ˆæ–¹ä¾¿ï¼Œä¸è¿‡å¦‚æœä½ çš„é¡µé¢å¯¹æ€§èƒ½æœ‰ä¸€å®šè¦æ±‚ï¼Œå»ºè®®ä¸è¦è¿™ä¹ˆåšï¼Œå…·ä½“å¯ä»¥çœ‹çœ‹ sunnyxx çš„ <a href="http://blog.sunnyxx.com/2015/05/17/cell-height-calculation/" target="_blank" rel="external">ä¼˜åŒ–UITableViewCellé«˜åº¦è®¡ç®—çš„é‚£äº›äº‹</a>ã€‚æ–‡ä¸­é’ˆå¯¹ Auto Layoutï¼Œæä¾›äº†ä¸ª cell è¡Œé«˜çš„ç¼“å­˜åº“ <a href="https://github.com/forkingdog/UITableView-FDTemplateLayoutCell" target="_blank" rel="external">UITableView-FDTemplateLayoutCell</a>ï¼Œå¯ä»¥å¾ˆå¥½çš„å¸®åŠ©æˆ‘ä»¬é¿å… cell è¡Œé«˜å¤šæ¬¡è®¡ç®—çš„é—®é¢˜ã€‚</p>
<p>å¦‚æœä¸ä½¿ç”¨ Auto Layoutï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¯·æ±‚å®Œæ‹¿åˆ°æ•°æ®åæå‰è®¡ç®—å¥½é¡µé¢æ¯ä¸ªæ§ä»¶çš„ frame å’Œ cell é«˜åº¦ï¼Œå¹¶ä¸”ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œç”¨çš„æ—¶å€™ç›´æ¥åœ¨ <code>heightForRowAtIndexPath:</code> å–å‡ºè®¡ç®—å¥½çš„å€¼å°±è¡Œï¼Œå¤§æ¦‚æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ¨¡æ‹Ÿè¯·æ±‚æ•°æ®å›è°ƒï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> buildTestDataThen:^(<span class="built_in">NSMutableArray</span> &lt;FDFeedEntity *&gt; *entities) &#123;</div><div class="line">        <span class="keyword">self</span>.data = @[].mutableCopy;</div><div class="line">        <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">            <span class="keyword">for</span> (FDFeedEntity *entity <span class="keyword">in</span> entities) &#123;</div><div class="line">                FrameModel *frameModel = [FrameModel new];</div><div class="line">                frameModel.entity = entity;</div><div class="line">                [<span class="keyword">self</span>.data addObject:frameModel];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        [<span class="keyword">self</span>.tvFeed reloadData];</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ä¸€ä¸ªç®€å•è®¡ç®— frame ã€cell è¡Œé«˜æ–¹å¼ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//FrameModel.h</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FrameModel</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">CGRect</span> titleFrame;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">CGFloat</span> cellHeight;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) FDFeedEntity *entity;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//FrameModel.m</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FrameModel</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setEntity:(FDFeedEntity *)entity &#123;</div><div class="line">    <span class="keyword">if</span> (!entity) <span class="keyword">return</span>;</div><div class="line">    </div><div class="line">    _entity = entity;</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> maxLayout = ([<span class="built_in">UIScreen</span> mainScreen].bounds.size.width - <span class="number">20.</span>f);</div><div class="line">    <span class="built_in">CGFloat</span> bottom = <span class="number">4.</span>f;</div><div class="line">    </div><div class="line">    <span class="comment">//title</span></div><div class="line">    <span class="built_in">CGFloat</span> titleX = <span class="number">10.</span>f;</div><div class="line">    <span class="built_in">CGFloat</span> titleY = <span class="number">10.</span>f;</div><div class="line">    <span class="built_in">CGSize</span> titleSize = [entity.title boundingRectWithSize:<span class="built_in">CGSizeMake</span>(maxLayout, <span class="built_in">CGFLOAT_MAX</span>) options:<span class="built_in">NSStringDrawingUsesLineFragmentOrigin</span>|<span class="built_in">NSStringDrawingUsesFontLeading</span> attributes:@&#123;<span class="built_in">NSFontAttributeName</span> : Font(<span class="number">16.</span>f)&#125; context:<span class="literal">nil</span>].size;</div><div class="line">    _titleFrame = <span class="built_in">CGRectMake</span>(titleX, titleY, titleSize.width, titleSize.height);</div><div class="line">    </div><div class="line">    <span class="comment">//cell Height</span></div><div class="line">    _cellHeight = (<span class="built_in">CGRectGetMaxY</span>(_titleFrame) + bottom);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<ul>
<li>è¡Œé«˜å–å€¼ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</div><div class="line">    FrameFeedCell *cell = [tableView dequeueReusableCellWithIdentifier:FrameFeedCellIdentifier forIndexPath:indexPath];</div><div class="line">    FrameModel *frameModel = <span class="keyword">self</span>.data[indexPath.row];</div><div class="line">    cell.model = frameModel;</div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</div><div class="line">    FrameModel *frameModel = <span class="keyword">self</span>.data[indexPath.row];</div><div class="line">    <span class="keyword">return</span> frameModel.cellHeight;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>æ§ä»¶èµ‹å€¼ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setModel:(FrameModel *)model &#123;</div><div class="line">    <span class="keyword">if</span> (!model) <span class="keyword">return</span>;</div><div class="line">    </div><div class="line">    _model = model;</div><div class="line">    </div><div class="line">    FDFeedEntity *entity = model.entity;</div><div class="line">    </div><div class="line">    <span class="keyword">self</span>.titleLabel.frame = model.titleFrame;</div><div class="line">    <span class="keyword">self</span>.titleLabel.text = entity.title;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h4><p>ç¼“å­˜è¡Œé«˜æ–¹å¼æœ‰ç°æˆçš„åº“ç®€å•æ–¹ä¾¿ï¼Œè™½ç„¶ UITableView-FDTemplateLayoutCell å·²ç»å¤„ç†çš„å¾ˆå¥½äº†ï¼Œä½†æ˜¯ Auto Layout å¯¹æ€§èƒ½è¿˜æ˜¯ä¼šæœ‰éƒ¨åˆ†æ¶ˆè€—ï¼›æ‰‹åŠ¨è®¡ç®— frame æ–¹å¼æ‰€æœ‰çš„ä½ç½®éƒ½éœ€è¦è®¡ç®—ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œä¸”åœ¨æ•°æ®é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œå¤§é‡çš„è®¡ç®—å¯¹æ•°æ®å±•ç¤ºæ—¶é—´ä¼šæœ‰éƒ¨åˆ†å½±å“ï¼Œç›¸åº”çš„å›æŠ¥å°±æ˜¯æ€§èƒ½ä¼šæ›´å¥½ä¸€äº›ã€‚</p>
<h3 id="æ–‡æœ¬å¼‚æ­¥æ¸²æŸ“"><a href="#æ–‡æœ¬å¼‚æ­¥æ¸²æŸ“" class="headerlink" title="æ–‡æœ¬å¼‚æ­¥æ¸²æŸ“"></a>æ–‡æœ¬å¼‚æ­¥æ¸²æŸ“</h3><p>å½“æ˜¾ç¤ºå¤§é‡æ–‡æœ¬æ—¶ï¼ŒCPU çš„å‹åŠ›ä¼šéå¸¸å¤§ã€‚å¯¹æ­¤è§£å†³æ–¹æ¡ˆåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯è‡ªå®šä¹‰æ–‡æœ¬æ§ä»¶ï¼Œç”¨ TextKit æˆ–æœ€åº•å±‚çš„ CoreText å¯¹æ–‡æœ¬å¼‚æ­¥ç»˜åˆ¶ã€‚å°½ç®¡è¿™å®ç°èµ·æ¥éå¸¸éº»çƒ¦ï¼Œä½†å…¶å¸¦æ¥çš„ä¼˜åŠ¿ä¹Ÿéå¸¸å¤§ï¼ŒCoreText å¯¹è±¡åˆ›å»ºå¥½åï¼Œèƒ½ç›´æ¥è·å–æ–‡æœ¬çš„å®½é«˜ç­‰ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡è®¡ç®—ï¼ˆè°ƒæ•´ UILabel å¤§å°æ—¶ç®—ä¸€éã€UILabel ç»˜åˆ¶æ—¶å†…éƒ¨å†ç®—ä¸€éï¼‰ï¼›CoreText å¯¹è±¡å ç”¨å†…å­˜è¾ƒå°‘ï¼Œå¯ä»¥ç¼“å­˜ä¸‹æ¥ä»¥å¤‡ç¨åå¤šæ¬¡æ¸²æŸ“ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œæƒ³æ”¯æŒæ–‡æœ¬å¼‚æ­¥æ¸²æŸ“ä¹Ÿæœ‰ç°æˆçš„åº“ <a href="https://github.com/ibireme/YYText" target="_blank" rel="external">YYText</a> ï¼Œä¸‹é¢æ¥è®²è®²å¦‚ä½•æ­é…å®ƒæœ€å¤§ç¨‹åº¦æ»¡è¶³æˆ‘ä»¬å¦‚ä¸èˆ¬é¡ºæ»‘çš„éœ€æ±‚ï¼š</p>
<h4 id="Frame-æ­é…å¼‚æ­¥æ¸²æŸ“"><a href="#Frame-æ­é…å¼‚æ­¥æ¸²æŸ“" class="headerlink" title="Frame æ­é…å¼‚æ­¥æ¸²æŸ“"></a>Frame æ­é…å¼‚æ­¥æ¸²æŸ“</h4><p>åŸºæœ¬æ€è·¯å’Œè®¡ç®— frame ç±»ä¼¼ï¼Œåªä¸è¿‡æŠŠç³»ç»Ÿçš„ <code>boundingRectWithSize:</code>ã€ <code>sizeWithAttributes:</code> æ¢æˆ  YYText  ä¸­çš„æ–¹æ³•ï¼š</p>
<ul>
<li>é…ç½® frame modelï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//FrameYYModel.h</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FrameYYModel</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">CGRect</span> titleFrame;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) YYTextLayout *titleLayout;</div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">CGFloat</span> cellHeight;</div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) FDFeedEntity *entity;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//FrameYYModel.m</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FrameYYModel</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setEntity:(FDFeedEntity *)entity &#123;</div><div class="line">    <span class="keyword">if</span> (!entity) <span class="keyword">return</span>;</div><div class="line">    </div><div class="line">    _entity = entity;</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> maxLayout = ([<span class="built_in">UIScreen</span> mainScreen].bounds.size.width - <span class="number">20.</span>f);</div><div class="line">    <span class="built_in">CGFloat</span> space = <span class="number">10.</span>f;</div><div class="line">    <span class="built_in">CGFloat</span> bottom = <span class="number">4.</span>f;</div><div class="line">    </div><div class="line">    <span class="comment">//title</span></div><div class="line">    <span class="built_in">NSMutableAttributedString</span> *title = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:entity.title];</div><div class="line">    title.yy_font = Font(<span class="number">16.</span>f);</div><div class="line">    title.yy_color = [<span class="built_in">UIColor</span> blackColor];</div><div class="line">    </div><div class="line">    YYTextContainer *titleContainer = [YYTextContainer containerWithSize:<span class="built_in">CGSizeMake</span>(maxLayout, <span class="built_in">CGFLOAT_MAX</span>)];</div><div class="line">    _titleLayout = [YYTextLayout layoutWithContainer:titleContainer text:title];</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> titleX = <span class="number">10.</span>f;</div><div class="line">    <span class="built_in">CGFloat</span> titleY = <span class="number">10.</span>f;</div><div class="line">    <span class="built_in">CGSize</span> titleSize = _titleLayout.textBoundingSize;</div><div class="line">    _titleFrame = (<span class="built_in">CGRect</span>)&#123;titleX,titleY,<span class="built_in">CGSizeMake</span>(titleSize.width, titleSize.height)&#125;;</div><div class="line">    </div><div class="line">    <span class="comment">//cell Height</span></div><div class="line">    _cellHeight = (<span class="built_in">CGRectGetMaxY</span>(_titleFrame) + bottom);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>å¯¹æ¯”ä¸Šé¢ frameï¼Œå¯ä»¥å‘ç°å¤šäº†ä¸ª <code>YYTextLayout</code>  å±æ€§ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥æå‰é…ç½®æ–‡æœ¬çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬ <code>font</code>ã€<code>textColor</code> ä»¥åŠè¡Œæ•°ã€è¡Œé—´è·ã€å†…é—´è·ç­‰ç­‰ï¼Œå¥½å¤„å°±æ˜¯å¯ä»¥æŠŠä¸€äº›é€»è¾‘æå‰å¤„ç†å¥½ï¼Œæ¯”å¦‚æ ¹æ®æ¥å£å­—æ®µï¼ŒåŠ¨æ€é…ç½®å­—ä½“é¢œè‰²ï¼Œå­—å·ç­‰ï¼Œå¦‚æœç”¨ Auto Layoutï¼Œè¿™éƒ¨åˆ†é€»è¾‘åˆ™ä¸å¯é¿å…çš„éœ€è¦å†™åœ¨  <code>cellForRowAtIndexPath:</code> æ–¹æ³•ä¸­ã€‚</p>
<ul>
<li>UITableViewCell å¤„ç† ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">instancetype</span>)initWithStyle:(<span class="built_in">UITableViewCellStyle</span>)style reuseIdentifier:(<span class="built_in">NSString</span> *)reuseIdentifier &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithStyle:style reuseIdentifier:reuseIdentifier];</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">  </div><div class="line">    YYLabel *title = [YYLabel new];</div><div class="line">  	title.displaysAsynchronously = <span class="literal">YES</span>; <span class="comment">//å¼€å¯å¼‚æ­¥æ¸²æŸ“</span></div><div class="line">  	title.ignoreCommonProperties = <span class="literal">YES</span>; <span class="comment">//å¿½ç•¥å±æ€§</span></div><div class="line">    title.layer.borderColor = [<span class="built_in">UIColor</span> brownColor].CGColor;</div><div class="line">    title.layer.cornerRadius = <span class="number">1.</span>f;</div><div class="line">    title.layer.borderWidth = <span class="number">1.</span>f;</div><div class="line">    [<span class="keyword">self</span>.contentView addSubview:_titleLabel = title];</div><div class="line">  </div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>èµ‹å€¼ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setModel:(FrameYYModel *)model &#123;</div><div class="line">    <span class="keyword">if</span> (!model) <span class="keyword">return</span>;</div><div class="line">    _model = model;</div><div class="line">    </div><div class="line">    <span class="keyword">self</span>.titleLabel.frame = model.titleFrame;</div><div class="line">    <span class="keyword">self</span>.titleLabel.textLayout = model.titleLayout; <span class="comment">//ç›´æ¥å– YYTextLayout</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Auto-Layout-æ­é…å¼‚æ­¥æ¸²æŸ“"><a href="#Auto-Layout-æ­é…å¼‚æ­¥æ¸²æŸ“" class="headerlink" title="Auto Layout æ­é…å¼‚æ­¥æ¸²æŸ“"></a>Auto Layout æ­é…å¼‚æ­¥æ¸²æŸ“</h4><p>YYText  éå¸¸å‹å¥½ï¼ŒåŒæ ·æ”¯æŒ xibï¼ŒYYText  ç»§æ‰¿è‡ª <code>UIView</code>ï¼Œæ‰€è¦åšçš„äº‹æƒ…ä¹Ÿå¾ˆç®€å•ï¼š</p>
<ul>
<li>åœ¨ xib ä¸­é…ç½®çº¦æŸ</li>
<li>å¼€å¯å¼‚æ­¥å±æ€§</li>
</ul>
<p>å¼€å¯å¼‚æ­¥å±æ€§å¯ä»¥ä»£ç é‡Œè®¾ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ xib é‡Œè®¾ç½®ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.titleLabel.displaysAsynchronously = <span class="literal">YES</span>;</div><div class="line"><span class="keyword">self</span>.subTitleLabel.displaysAsynchronously = <span class="literal">YES</span>;</div><div class="line"><span class="keyword">self</span>.contentLabel.displaysAsynchronously = <span class="literal">YES</span>;</div><div class="line"><span class="keyword">self</span>.usernameLabel.displaysAsynchronously = <span class="literal">YES</span>;</div><div class="line"><span class="keyword">self</span>.timeLabel.displaysAsynchronously = <span class="literal">YES</span>;</div></pre></td></tr></table></figure>
<p><img src="/images/ib.png" alt=""></p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¤šè¡Œæ–‡æœ¬çš„æƒ…å†µä¸‹éœ€è¦è®¾ç½®æœ€å¤§æ¢è¡Œå®½ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGFloat</span> maxLayout = [<span class="built_in">UIScreen</span> mainScreen].bounds.size.width - <span class="number">20.</span>f;</div><div class="line"><span class="keyword">self</span>.titleLabel.preferredMaxLayoutWidth = maxLayout;</div><div class="line"><span class="keyword">self</span>.subTitleLabel.preferredMaxLayoutWidth = maxLayout;</div><div class="line"><span class="keyword">self</span>.contentLabel.preferredMaxLayoutWidth = maxLayout;</div></pre></td></tr></table></figure>
<h4 id="ä¼˜ç¼ºç‚¹-1"><a href="#ä¼˜ç¼ºç‚¹-1" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h4><p> YYText çš„å¼‚æ­¥æ¸²æŸ“èƒ½æå¤§ç¨‹åº¦çš„æé«˜åˆ—è¡¨æµç•…åº¦ï¼ŒçœŸæ­£è¾¾åˆ°å¦‚ä¸èˆ¬é¡ºæ»‘ï¼Œä½†æ˜¯åœ¨å¼€å¯å¼‚æ­¥æ—¶ï¼Œåˆ·æ–°åˆ—è¡¨ä¼šæœ‰é—ªçƒæƒ…å†µï¼Œä»”ç»†æƒ³æƒ³è§‰å¾—ä¹Ÿæ­£å¸¸ï¼Œæ¯•ç«Ÿæ˜¯å¼‚æ­¥çš„ï¼Œæ¸²æŸ“ä¹Ÿéœ€è¦æ—¶é—´ï¼Œè¿™é‡Œä½œè€…ç»™å‡ºäº†ä¸€äº› <a href="https://github.com/ibireme/YYKit/issues/64" target="_blank" rel="external">æ–¹æ¡ˆ</a>ï¼Œå¤§å®¶å¯ä»¥çœ‹çœ‹ã€‚</p>
<h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><h4 id="å…³äºåœ†è§’"><a href="#å…³äºåœ†è§’" class="headerlink" title="å…³äºåœ†è§’"></a>å…³äºåœ†è§’</h4><p>åˆ—è¡¨ä¸­å¦‚æœå­˜åœ¨å¾ˆå¤šç³»ç»Ÿè®¾ç½®çš„åœ†è§’é¡µé¢å¯¼è‡´å¡é¡¿ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">label.layer.cornerRadius = <span class="number">5.</span>f;</div><div class="line">label.clipsToBounds = <span class="literal">YES</span>;</div></pre></td></tr></table></figure>
<p>å…¶å®æ®æˆ‘è§‚å¯Ÿï¼Œåªè¦å½“å‰å±å¹•å†…åªè¦è®¾ç½®åœ†è§’çš„æ§ä»¶ä¸ªæ•°ä¸è¦å¤ªå¤šï¼ˆå¤§æ¦‚åå‡ ä¸ªç®—ä¸ªä¸´ç•Œç‚¹ï¼‰ï¼Œå°±ä¸ä¼šå¼•èµ·å¡é¡¿ã€‚</p>
<p>è¿˜æœ‰å°±æ˜¯åªè¦ä¸è®¾ç½® <code>clipsToBounds</code> ä¸ç®¡å¤šå°‘ä¸ªï¼Œéƒ½ä¸ä¼šå¡é¡¿ï¼Œæ¯”å¦‚ä½ éœ€è¦åœ†è§’çš„æ§ä»¶æ˜¯ç™½è‰²èƒŒæ™¯è‰²çš„ï¼Œç„¶åå®ƒçš„çˆ¶æ§ä»¶ä¹Ÿæ˜¯ç™½è‰²èƒŒæ™¯è‰²çš„ï¼Œè€Œä¸”æ²¡æœ‰ç‚¹å‡»åé«˜äº®çš„ï¼Œå°±æ²¡å¿…è¦ clipsToBounds äº†ã€‚</p>
<h4 id="å¦‚ä½•å®šä½å¡é¡¿åŸå› "><a href="#å¦‚ä½•å®šä½å¡é¡¿åŸå› " class="headerlink" title="å¦‚ä½•å®šä½å¡é¡¿åŸå› "></a>å¦‚ä½•å®šä½å¡é¡¿åŸå› </h4><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ instruments ä¸­çš„ Time Profiler æ¥å¸®åŠ©æˆ‘ä»¬å®šä½é—®é¢˜ä½ç½®ï¼Œé€‰ä¸­ Xcodeï¼Œcommand + control + i  æ‰“å¼€ï¼š</p>
<p><img src="/images/instruments.gif" alt=""></p>
<p>æˆ‘ä»¬é€‰ä¸­ä¸»çº¿ç¨‹ï¼Œå»æ‰ç³»ç»Ÿçš„æ–¹æ³•ï¼Œç„¶åæ“ä½œä¸€ä¸‹åˆ—è¡¨ï¼Œå†æˆªå–ä¸€æ®µè°ƒç”¨ä¿¡æ¯ï¼Œå¯ä»¥å‘ç°æˆ‘ä»¬è‡ªå·±å®ç°çš„æ–¹æ³•å¹¶æ²¡æœ‰æ¶ˆè€—å¤šå°‘æ—¶é—´ï¼Œåè€Œæ˜¯ç³»ç»Ÿçš„æ–¹æ³•å¾ˆè´¹æ—¶ï¼Œè¿™ä¹Ÿæ˜¯å¡é¡¿çš„åŸå› ä¹‹ä¸€ï¼š</p>
<p><img src="/images/autolayout.png" alt=""></p>
<p>å¦å¤–æœ‰çš„äºº instruments çœ‹ä¸åˆ°æ–¹æ³•è°ƒç”¨æ ˆï¼ˆå³è¾¹ä¸€å¯¹é»‘è‰²çš„æ–¹æ³•ä¿¡æ¯ï¼‰ï¼Œå» Xcode è®¾ç½®ä¸‹å°±è¡Œäº†ï¼š</p>
<p><img src="/images/xcode.png" alt=""></p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>YYText å’Œ UITableView-FDTemplateLayoutCell æ­é…å¯ä»¥å¾ˆå¤§ç¨‹åº¦çš„æé«˜åˆ—è¡¨æµç•…åº¦ï¼š</p>
<ul>
<li><p><strong>å¦‚æœæ—¶é—´æ¯”è¾ƒç´§è¿«ï¼Œå¯ä»¥ç›´æ¥é‡‡å– Auto Layout + UITableView-FDTemplateLayoutCell + YYText æ–¹å¼</strong></p>
</li>
<li><p><strong>å¦‚æœåˆ—è¡¨ä¸­æ–‡æœ¬ä¸åŒ…å«å¯Œæ–‡æœ¬ï¼Œä»…ä»…æ˜¾ç¤ºæ–‡å­—ï¼Œåˆä¸æƒ³å¼•å…¥è¿™ä¸¤ä¸ªåº“ï¼Œå¯ä»¥ä½¿ç”¨ç³»ç»Ÿæ–¹å¼æå‰è®¡ç®— Frame</strong></p>
</li>
<li><p><strong>å¦‚æœæƒ³æœ€å¤§ç¨‹åº¦çš„æµç•…åº¦ï¼Œå°±éœ€è¦æå‰è®¡ç®— Frame + YYTextï¼Œå…·ä½“å¤§å®¶æ ¹æ®è‡ªå·±æƒ…å†µé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆå°±è¡Œ</strong></p>
</li>
</ul>
<p>æœ€åï¼Œé™„ä¸Šæµ‹è¯• <a href="https://github.com/ifelseboyxx/xx_Notes/tree/master/contents/TVOptimizationDemo/TVOptimizationDemo" target="_blank" rel="external">Demo</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿‘äº›å¹´ï¼ŒApp è¶Šæ¥è¶Šæ¨å´‡ä½“éªŒè‡³ä¸Šï¼Œéšéšä¾¿ä¾¿ä¹±å†™ä¸€é€šçš„è¯å·²ç»å¾ˆéš¾è®©ç”¨æˆ·ä¹°å¸äº†ï¼Œé¡ºæ»‘çš„åˆ—è¡¨ä¾¿æ˜¯å…¶ä¸­å¾ˆé‡è¦çš„ä¸€ç‚¹ã€‚å¦‚æœä¸€ä¸ª App çš„é¡µé¢æ»šåŠ¨èµ·æ¥æ€»æ˜¯å¡é¡¿å¡é¡¿çš„ï¼Œè½»åˆ™è¢«å½“ä½œåé¢æ•™ææ¥åæ§½æˆ–è€…è¡¬æ‰˜â€œæˆ‘ä»¬çš„ App balabalaâ€¦â€ï¼Œé‡åˆ™ç›´æ¥å¸è½½ã€‚æ­£å¥½æœ€è¿‘åœ¨ä¼˜åŒ–è¿™ä¸€å—å„¿ï¼Œæ€»ç»“è®°
    
    </summary>
    
    
      <category term="ObjC" scheme="http://yoursite.com/tags/ObjC/"/>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="http://yoursite.com/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäº ResponderChain çš„å¯¹è±¡äº¤äº’æ–¹å¼</title>
    <link href="http://yoursite.com/2017/08/04/ResponderChain/"/>
    <id>http://yoursite.com/2017/08/04/ResponderChain/</id>
    <published>2017-08-04T02:26:23.000Z</published>
    <updated>2018-02-13T09:03:11.246Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>Responder Chain ï¼Œä¹Ÿå°±æ˜¯å“åº”é“¾ï¼Œå…³äºè¿™æ–¹é¢çš„çŸ¥è¯†å› ä¸ºä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œè¿˜ä¸å¤ªç†è§£çš„å¯ä»¥å»çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="http://www.jianshu.com/p/2e074db792ba" target="_blank" rel="external">å²ä¸Šæœ€è¯¦ç»†çš„iOSä¹‹äº‹ä»¶çš„ä¼ é€’å’Œå“åº”æœºåˆ¶-åŸç†ç¯‡</a>ã€‚</p>
<p>åœ¨ iOS ä¸­ï¼Œå¯¹è±¡é—´çš„äº¤äº’æ¨¡å¼å¤§æ¦‚æœ‰è¿™å‡ ç§ï¼šç›´æ¥ property ä¼ å€¼ã€delegateã€KVOã€blockã€protocolã€å¤šæ€ã€Target-Action ç­‰ç­‰ï¼Œæœ¬æ–‡ä»‹ç»çš„æ˜¯ä¸€ç§åŸºäº UIResponder å¯¹è±¡äº¤äº’æ–¹å¼ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ é€šè¿‡åœ¨ UIResponderä¸ŠæŒ‚ä¸€ä¸ª categoryï¼Œä½¿å¾—äº‹ä»¶å’Œå‚æ•°å¯ä»¥æ²¿ç€ responder chain é€æ­¥ä¼ é€’ã€‚å¯¹äºé‚£ç§ subviews ç‰¹åˆ«å¤šï¼Œäº‹ä»¶åˆéœ€è¦å±‚å±‚ä¼ é€’çš„å±‚çº§è§†å›¾ç‰¹åˆ«å¥½ç”¨ï¼Œä½†æ˜¯ï¼Œç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå¿…é¡»ä¾èµ–äº UIResponder å¯¹è±¡ã€‚</p>
<h3 id="å…·ä½“äº‹ä¾‹"><a href="#å…·ä½“äº‹ä¾‹" class="headerlink" title="å…·ä½“äº‹ä¾‹"></a>å…·ä½“äº‹ä¾‹</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸‹é¢è¿™ç§å¾ˆå¸¸è§çš„ç•Œé¢ï¼š</p>
<p><img src="/images/08-04.png" alt=""></p>
<p>ç®€å•è®²è§£ä¸‹ï¼šæœ€å¤–å±‚æ˜¯ä¸ª UITableViewï¼Œæˆ‘ä»¬å°±å«åš SuperTableï¼Œæ¯ä¸ª cell é‡Œé¢åˆåµŒå¥—äº†ä¸ª UITableViewï¼Œå«åš SubTableï¼Œç„¶åè¿™ä¸ª SubTable çš„ cell é‡Œé¢æœ‰ä¸€äº›æŒ‰é’®ï¼Œæˆ‘ä»¬ç†ä¸€ä¸‹è¿™ä¸ªç•Œé¢çš„å±‚çº§ï¼š</p>
<blockquote>
<p>UIViewController -&gt; SuperTable -&gt; SuperCell -&gt; SubTable -&gt; SubCell -&gt; UIButton</p>
</blockquote>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨æœ€å¤–å±‚çš„ UIViewController é‡Œæ•è·åˆ°è¿™äº›æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ¯”å¦‚ç‚¹å‡»æŒ‰é’®éœ€è¦åˆ·æ–° SuperTableï¼Œè¿™æ—¶å€™è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p>
<p>æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæœ€å¸¸è§çš„å°±æ˜¯ delegate ï¼Œä½†æ˜¯å› ä¸ºå±‚çº§å¤ªæ·±ï¼Œå¯¼è‡´æˆ‘ä»¬éœ€è¦ä¸€å±‚å±‚çš„å»å®ç°ï¼Œå„ç§  protocolã€delegate å£°æ˜ï¼Œå¾ˆç¹çï¼Œè¿™ç§æ—¶å€™ï¼ŒåŸºäº Responder Chain å°±å¾ˆæ–¹ä¾¿äº†ã€‚</p>
<h3 id="å…·ä½“ä½¿ç”¨"><a href="#å…·ä½“ä½¿ç”¨" class="headerlink" title="å…·ä½“ä½¿ç”¨"></a>å…·ä½“ä½¿ç”¨</h3><p>åªéœ€è¦ä¸€ä¸ª UIResponder çš„ category å°±è¡Œï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIResponder</span> (<span class="title">Router</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)routerEventWithSelectorName:(<span class="built_in">NSString</span> *)selectorName</div><div class="line">                     object:(<span class="keyword">id</span>)object</div><div class="line">                   userInfo:(<span class="built_in">NSDictionary</span> *)userInfo;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIResponder</span> (<span class="title">Router</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)routerEventWithSelectorName:(<span class="built_in">NSString</span> *)selectorName</div><div class="line">                             object:(<span class="keyword">id</span>)object</div><div class="line">                           userInfo:(<span class="built_in">NSDictionary</span> *)userInfo &#123;</div><div class="line">    </div><div class="line">    [[<span class="keyword">self</span> nextResponder] routerEventWithSelectorName:selectorName</div><div class="line">                                       object:object</div><div class="line">                                     userInfo:userInfo];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>æœ€é‡Œå±‚ UIButton çš„ç‚¹å‡»å¤„ç†ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">IBAction</span>)btnClick1:(<span class="built_in">UIButton</span> *)sender &#123;</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> routerEventWithSelectorName:<span class="string">@"btnClick1:userInfo:"</span> object:sender userInfo:@&#123;<span class="string">@"key"</span>:<span class="string">@"è“è‰²æŒ‰é’®"</span>&#125;];    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¤–å±‚ UIViewController çš„æ¥æ”¶ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)routerEventWithSelectorName:(<span class="built_in">NSString</span> *)selectorName</div><div class="line">                     object:(<span class="keyword">id</span>)object</div><div class="line">                   userInfo:(<span class="built_in">NSDictionary</span> *)userInfo &#123;</div><div class="line">        </div><div class="line">    SEL action = <span class="built_in">NSSelectorFromString</span>(selectorName);</div><div class="line">    </div><div class="line">    <span class="built_in">NSMutableArray</span> *arr = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">    <span class="keyword">if</span>(object) &#123;[arr addObject:object];&#125;;</div><div class="line">    <span class="keyword">if</span>(userInfo) &#123;[arr addObject:userInfo];&#125;;</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> performSelector:action withObjects:arr];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>äº‹ä»¶å“åº”ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)btnClick1:(<span class="built_in">UIButton</span> *)btn userInfo:(<span class="built_in">NSDictionary</span> *)userInfo &#123;</div><div class="line">    </div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@  %@"</span>,btn,userInfo); </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³åœ¨ä¼ é€’è¿‡ç¨‹ä¸­æ–°å¢å‚æ•°ï¼Œæ¯”å¦‚æƒ³åœ¨ SuperCell è¿™ä¸€å±‚åŠ ç‚¹å‚æ•°ï¼Œåªéœ€è¦åœ¨å¯¹åº”çš„åœ°æ–¹å®ç°æ–¹æ³•å°±è¡Œï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)routerEventWithSelectorName:(<span class="built_in">NSString</span> *)selectorName object:(<span class="keyword">id</span>)object userInfo:(<span class="built_in">NSDictionary</span> *)userInfo &#123;</div><div class="line">    </div><div class="line">    <span class="built_in">NSMutableDictionary</span> *mDict = [userInfo mutableCopy];</div><div class="line">    mDict[<span class="string">@"test"</span>] = <span class="string">@"æµ‹è¯•"</span>;</div><div class="line"></div><div class="line">    [<span class="keyword">super</span> routerEventWithSelectorName:selectorName object:object userInfo:[mDict <span class="keyword">copy</span>]];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="è®¾è®¡æ€è·¯"><a href="#è®¾è®¡æ€è·¯" class="headerlink" title="è®¾è®¡æ€è·¯"></a>è®¾è®¡æ€è·¯</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)routerEventWithSelectorName:(<span class="built_in">NSString</span> *)selectorName</div><div class="line">                     object:(<span class="keyword">id</span>)object</div><div class="line">                   userInfo:(<span class="built_in">NSDictionary</span> *)userInfo</div></pre></td></tr></table></figure>
<p>ç»†å¿ƒçš„å¯ä»¥å‘ç°ï¼Œæˆ‘è¿™é‡Œç›´æ¥æŠŠ <code>SEL</code>  è®¾è®¡æˆä»¥ <code>NSString</code> çš„å½¢å¼ä¼ é€’äº†ï¼Œå†åœ¨å¤–é¢é€šè¿‡ <code>NSSelectorFromString(selectorName)</code> è½¬æˆå¯¹åº”çš„ <code>SEL</code>ã€‚åŸæ–‡ä¸­ä¼ çš„æ˜¯ä¸ªç”¨æ¥æ ‡è¯†å…·ä½“æ˜¯å“ªä¸ªäº‹ä»¶çš„å­—ä¸²ï¼Œè¿˜éœ€è¦ç»´æŠ¤ä¸“é—¨çš„ <code>NSDictionary</code> æ¥æ‰¾åˆ°å¯¹åº”çš„äº‹ä»¶ï¼Œæˆ‘è§‰å¾—å¤ªéº»çƒ¦ï¼Œä½†æ˜¯å¥½å¤„æ˜¯ <code>@selector(....)</code> å£°æ˜å’Œå®ç°åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå¯è¯»æ€§é«˜ï¼Œä¹Ÿä¸å®¹æ˜“å‡ºç°æ‹¼å†™é”™è¯¯ï¼Œå¯¼è‡´è§¦å‘ä¸äº†å¯¹åº”æ–¹æ³•çš„é—®é¢˜ï¼Œå…·ä½“æ€ä¹ˆè®¾è®¡ï¼Œå¤§å®¶è§ä»è§æ™ºå§~</p>
<p>å…³äºå‚æ•°çš„ä¼ é€’ï¼Œæ¯”å¦‚æˆ‘è§¦å‘ <code>UITableViewDelegate</code> ä¸­çš„ <code>didSelectRowAtIndexPath:</code> æ–¹æ³•ï¼Œå‚æ•°ä¸¤ä¸ªä»¥å†…æ—¶ï¼Œ<code>performSelector:</code> æ–¹æ³•ä¹Ÿå¯ä»¥æ»¡è¶³ï¼Œä½†ä¸€æ—¦è¶…è¿‡ä¸¤ä¸ªï¼Œå°±ä¸æ–¹ä¾¿äº†ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç”¨ <code>NSInvocation</code> æ¥å®ç°ï¼Œæˆ‘å†™äº†ä¸ªåˆ†ç±»ï¼Œæ”¯æŒä¼ é€’å¤šä¸ªå‚æ•°ï¼Œæ­é…ä½¿ç”¨å¾ˆæ–¹ä¾¿ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@interface NSObject (PerformSelector)</div><div class="line"></div><div class="line">- (id)performSelector:(SEL)aSelector withObjects:(NSArray &lt;id&gt; *)objects;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">@implementation NSObject (PerformSelector)</div><div class="line"></div><div class="line">- (id)performSelector:(SEL)aSelector</div><div class="line">          withObjects:(NSArray &lt;id&gt; *)objects &#123;</div><div class="line">    </div><div class="line">    //åˆ›å»ºç­¾åå¯¹è±¡</div><div class="line">    NSMethodSignature *signature = [[self class] instanceMethodSignatureForSelector:aSelector];</div><div class="line">    </div><div class="line">    //åˆ¤æ–­ä¼ å…¥çš„æ–¹æ³•æ˜¯å¦å­˜åœ¨</div><div class="line">    if (!signature) &#123; //ä¸å­˜åœ¨</div><div class="line">        //æŠ›å‡ºå¼‚å¸¸</div><div class="line">        NSString *info = [NSString stringWithFormat:@&quot;-[%@ %@]:unrecognized selector sent to instance&quot;,[self class],NSStringFromSelector(aSelector)];</div><div class="line">        @throw [[NSException alloc] initWithName:@&quot;ifelseboyxx remind:&quot; reason:info userInfo:nil];</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    //åˆ›å»º NSInvocation å¯¹è±¡</div><div class="line">    NSInvocation *invocation = [NSInvocation invocationWithMethodSignature:signature];</div><div class="line">    </div><div class="line">    //ä¿å­˜æ–¹æ³•æ‰€å±çš„å¯¹è±¡</div><div class="line">    invocation.target = self;</div><div class="line">    invocation.selector = aSelector;</div><div class="line"></div><div class="line">    </div><div class="line">    //è®¾ç½®å‚æ•°</div><div class="line">    //å­˜åœ¨é»˜è®¤çš„ _cmdã€target ä¸¤ä¸ªå‚æ•°ï¼Œéœ€å‰”é™¤</div><div class="line">    NSInteger arguments = signature.numberOfArguments - 2;</div><div class="line">    </div><div class="line">    //è°å°‘å°±éå†è°,é˜²æ­¢æ•°ç»„è¶Šç•Œ</div><div class="line">    NSUInteger objectsCount = objects.count;</div><div class="line">    NSInteger count = MIN(arguments, objectsCount);</div><div class="line">    for (int i = 0; i &lt; count; i++) &#123;</div><div class="line">        id obj = objects[i];</div><div class="line">        //å¤„ç†å‚æ•°æ˜¯ NULL ç±»å‹çš„æƒ…å†µ</div><div class="line">        if ([obj isKindOfClass:[NSNull class]]) &#123;obj = nil;&#125;</div><div class="line">        [invocation setArgument:&amp;obj atIndex:i+2];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    //è°ƒç”¨</div><div class="line">    [invocation invoke];</div><div class="line">    </div><div class="line">    //è·å–è¿”å›å€¼</div><div class="line">    id res = nil;</div><div class="line">    //åˆ¤æ–­å½“å‰æ–¹æ³•æ˜¯å¦æœ‰è¿”å›å€¼</div><div class="line">    if (signature.methodReturnLength != 0) &#123;</div><div class="line">        [invocation getReturnValue:&amp;res];</div><div class="line">    &#125;</div><div class="line">    return res;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>æœ€åé™„ä¸Š <a href="https://github.com/ifelseboyxx/xx_Notes/tree/master/contents/ResponderChain/ResponderChainDemo" target="_blank" rel="external">Demo</a></p>
<h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><p><a href="https://casatwy.com/responder_chain_communication.html" target="_blank" rel="external">https://casatwy.com/responder_chain_communication.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;Responder Chain ï¼Œä¹Ÿå°±æ˜¯å“åº”é“¾ï¼Œå…³äºè¿™æ–¹é¢çš„çŸ¥è¯†å› ä¸ºä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œè¿˜ä¸å¤ªç†è§£çš„å¯ä»¥å»çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š&lt;a href=&quot;http
    
    </summary>
    
    
      <category term="ObjC" scheme="http://yoursite.com/tags/ObjC/"/>
    
  </entry>
  
  <entry>
    <title>è°ˆè°ˆ iOS ä¸­çš„ childViewController</title>
    <link href="http://yoursite.com/2017/07/23/iOS_childViewController/"/>
    <id>http://yoursite.com/2017/07/23/iOS_childViewController/</id>
    <published>2017-07-23T14:40:23.000Z</published>
    <updated>2018-02-13T09:07:25.167Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><p>åœ¨ iOS å®¢æˆ·ç«¯ä¸­ï¼Œå¤šä¸ª childViewController çš„é¡µé¢æ˜¯ä¸ªå¾ˆå¸¸è§çš„äº¤äº’è®¾è®¡ï¼Œç›®å‰å·²ç»å¹¿æ³›è¿ç”¨åœ¨å„ç±»çš„ APP ä¸Šï¼Œæ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„ç±»ä¼¼ç½‘æ˜“æ–°é—»ã€ä»Šæ—¥å¤´æ¡è¿™ä¸¤ä¸ªå®¢æˆ·ç«¯ã€‚</p>
<h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>å®ç°æ–¹å¼ç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šäº†ï¼Œè¿™é‡Œå°±ç›´æ¥è´´å‡ºä»£ç ï¼Œå¤§æ¦‚æµç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æ·»åŠ ä¸€ä¸ª childViewController</span></div><div class="line"><span class="built_in">UIViewController</span> *vc = [<span class="built_in">UIViewController</span> new];<span class="comment">//å­æ§åˆ¶å™¨</span></div><div class="line">[<span class="keyword">self</span> addChildViewController:vc];<span class="comment">//æ·»åŠ åˆ°çˆ¶æ§åˆ¶å™¨ä¸­</span></div><div class="line">vc.view.frame = <span class="comment">/*....*/</span>;<span class="comment">//è®¾ç½® frame</span></div><div class="line">[<span class="keyword">self</span>.view addSubview:vc.view];<span class="comment">//æŠŠå­æ§åˆ¶å™¨çš„ view æ·»åŠ åˆ°çˆ¶æ§åˆ¶å™¨çš„ view ä¸Šé¢</span></div><div class="line">[vc didMoveToParentViewController:<span class="keyword">self</span>];  <span class="comment">//å­æ§åˆ¶å™¨è¢«é€šçŸ¥æœ‰äº†ä¸€ä¸ªçˆ¶æ§åˆ¶å™¨</span></div><div class="line"></div><div class="line"><span class="comment">//ç§»é™¤ä¸€ä¸ª childViewController</span></div><div class="line">[vc willMoveToParentViewController:<span class="literal">nil</span>];<span class="comment">//å­æ§åˆ¶å™¨è¢«é€šçŸ¥å³å°†è§£é™¤çˆ¶å­å…³ç³»</span></div><div class="line">[vc.view removeFromSuperview];<span class="comment">//æŠŠå­æ§åˆ¶å™¨çš„ view ä»åˆ°çˆ¶æ§åˆ¶å™¨çš„ view ä¸Šé¢ç§»é™¤</span></div><div class="line">[vc removeFromParentViewController];<span class="comment">//çœŸæ­£çš„è§£é™¤å…³ç³»,ä¼šè‡ªå·±è°ƒç”¨ [vc didMoveToParentViewController:nil]</span></div></pre></td></tr></table></figure>
<p>å®ç°ä¸Šé¢éƒ¨åˆ†ï¼ŒchildViewController çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¹Ÿå°±æ˜¯ viewWillAppearã€viewDidAppearç­‰ç­‰è¿™äº›ï¼Œæ˜¯ä¸éœ€è¦æˆ‘ä»¬å…³å¿ƒçš„ï¼Œç³»ç»Ÿå†…éƒ¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è°ƒç”¨ã€‚</p>
<h3 id="æ‰‹åŠ¨ç®¡ç†-childViewController-çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"><a href="#æ‰‹åŠ¨ç®¡ç†-childViewController-çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•" class="headerlink" title="æ‰‹åŠ¨ç®¡ç† childViewController çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"></a>æ‰‹åŠ¨ç®¡ç† childViewController çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›è‡ªå·±æ§åˆ¶å­æ§åˆ¶å™¨çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ä¸€äº›é¢å¤–çš„æ“ä½œï¼š</p>
<p>åœ¨ iOS 5 ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨çˆ¶æ§åˆ¶å™¨ä¸­é‡å†™<code>automaticallyForwardAppearanceAndRotationMethodsToChildViewControllers</code>æ–¹æ³•ï¼Œå¹¶è¿”å› <code>NO</code>;</p>
<p>åœ¨ iOS 6 åŠä»¥åï¼Œéœ€è¦é‡å†™ <code>shouldAutomaticallyForwardAppearanceMethods</code>æ–¹æ³•ï¼Œå¹¶è¿”å› <code>NO</code>ï¼Œè¿™æ ·ç³»ç»Ÿå°±ä¸ä¼šè‡ªåŠ¨è°ƒç”¨ childViewController çš„ç”Ÿå‘½å‘¨æœŸäº†ï¼Œå…¨éƒ¨äº¤ç»™æˆ‘ä»¬è‡ªå·±å¤„ç†ã€‚</p>
<p>ä¸è¿‡æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸èƒ½æ‰‹åŠ¨è°ƒç”¨ viewWillAppearã€viewDidAppearç­‰ç­‰è¿™äº›æ–¹æ³•ï¼Œè€Œåº”è¯¥è°ƒç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (void)beginAppearanceTransition:(BOOL)isAppearing animated:(BOOL)animated;</div><div class="line">- (void)endAppearanceTransition;</div></pre></td></tr></table></figure>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•æ¥é—´æ¥è§¦å‘å­æ§åˆ¶å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”å®ƒä»¬å¾—æˆå¯¹ä½¿ç”¨ï¼š</p>
<blockquote>
<p><code>isAppearing</code> è®¾ç½®ä¸º <code>YES</code> : è§¦å‘ <code>viewWillAppear:</code> ;</p>
<p><code>isAppearing</code> è®¾ç½®ä¸º <code>NO</code> : è§¦å‘ <code>viewWillDisappear:</code> ;</p>
<p><code>endAppearanceTransition</code> ä¼šè§¦å‘ <code>viewDidAppear:</code> ä»¥åŠ <code>viewDidDisappear:</code> æ–¹æ³•ã€‚</p>
</blockquote>
<h3 id="å…³äº-childViewController-å¯¼è‡´å¯¼èˆªæ¡ç©¿é€æ•ˆæœå¤±æ•ˆé—®é¢˜"><a href="#å…³äº-childViewController-å¯¼è‡´å¯¼èˆªæ¡ç©¿é€æ•ˆæœå¤±æ•ˆé—®é¢˜" class="headerlink" title="å…³äº childViewController å¯¼è‡´å¯¼èˆªæ¡ç©¿é€æ•ˆæœå¤±æ•ˆé—®é¢˜"></a>å…³äº childViewController å¯¼è‡´å¯¼èˆªæ¡ç©¿é€æ•ˆæœå¤±æ•ˆé—®é¢˜</h3><p>æ‰€è°“çš„å¯¼èˆªæ¡ç©¿é€æ•ˆæœä¸€èˆ¬æ˜¯åœ¨ç”¨ UITableView çš„æ—¶å€™ï¼Œæ•ˆæœå¤§æ¦‚å¦‚ä¸‹ï¼š</p>
<p><img src="/images/tv_01.gif" alt=""></p>
<p>å¤§æ¦‚åŸç†å°±æ˜¯ç³»ç»Ÿå†…éƒ¨å¸®æˆ‘ä»¬è®¾ç½®äº† UITableView çš„ <code>contentInset</code> ä»¥åŠ <code>contentOffset</code> å±æ€§ï¼Œå¾€ä¸‹åç§»äº†ä¸€å®šçš„é«˜åº¦ï¼Œå¹¶ä¸”åªæœ‰å•ä¸ªå±‚çº§çš„æƒ…å†µä¸‹æ‰èƒ½ç”Ÿæ•ˆï¼Œæ‰€è°“çš„å•ä¸ªå±‚çº§å¯ä»¥ç†è§£ä¸ºåœ¨ä¸€ä¸ª UIViewController ä¸­ æ”¾ä¸€ä¸ª UITableViewã€‚ä¸€æ—¦æˆ‘ä»¬çš„ç•Œé¢ <code>addChildViewController:</code> ,å°±ä¼šå¤±æ•ˆï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ› childViewController ä¹Ÿèƒ½ä¿æŒè¿™ç§ç©¿é€æ•ˆæœï¼Œå°±éœ€è¦æ‹¿åˆ°æ­£ç¡®çš„ <code>topLayoutGuide</code> ä»¥åŠ <code>bottomLayoutGuide</code>  å€¼ï¼Œç„¶åè®¾ç½® <code>contentInset</code> å’Œ <code>contentOffset</code> å°±è¡Œäº†ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIViewController</span> (<span class="title">XXLayoutSupport</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">id</span>&lt;<span class="built_in">UILayoutSupport</span>&gt;)xx_navigationBarTopLayoutGuide &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.parentViewController &amp;&amp;</div><div class="line">        ![<span class="keyword">self</span>.parentViewController isKindOfClass:<span class="built_in">UINavigationController</span>.class]) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.parentViewController.xx_navigationBarTopLayoutGuide;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.topLayoutGuide;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">id</span>&lt;<span class="built_in">UILayoutSupport</span>&gt;)xx_navigationBarBottomLayoutGuide &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.parentViewController &amp;&amp;</div><div class="line">        ![<span class="keyword">self</span>.parentViewController isKindOfClass:<span class="built_in">UINavigationController</span>.class]) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.parentViewController.xx_navigationBarBottomLayoutGuide;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.bottomLayoutGuide;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIViewController</span> (<span class="title">FixNavBarPenetrable</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)xx_fixNavBarPenetrable &#123;</div><div class="line"> </div><div class="line">    <span class="keyword">if</span>(!<span class="keyword">self</span>.childViewControllers.count) <span class="keyword">return</span>;</div><div class="line">    <span class="built_in">CGFloat</span> statusBarHeight = [[<span class="built_in">UIApplication</span> sharedApplication] statusBarFrame].size.height;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.navigationController) &#123;statusBarHeight = <span class="number">0.0</span>f;&#125;</div><div class="line">    [<span class="keyword">self</span>.childViewControllers enumerateObjectsUsingBlock:^(__kindof <span class="built_in">UIViewController</span> * _Nonnull obj, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> * _Nonnull stop) &#123;</div><div class="line">        [obj.view.subviews enumerateObjectsUsingBlock:^(__kindof <span class="built_in">UIView</span> * _Nonnull v_obj, <span class="built_in">NSUInteger</span> v_idx, <span class="built_in">BOOL</span> * _Nonnull v_stop) &#123;</div><div class="line">            <span class="keyword">if</span> ([v_obj isKindOfClass:[<span class="built_in">UIScrollView</span> <span class="keyword">class</span>]]) &#123;</div><div class="line">                <span class="built_in">UIScrollView</span> *tv = (<span class="built_in">UIScrollView</span> *)v_obj;</div><div class="line">                <span class="keyword">const</span> <span class="built_in">UIEdgeInsets</span> insets = (obj.automaticallyAdjustsScrollViewInsets) ? <span class="built_in">UIEdgeInsetsMake</span>(obj.xx_navigationBarTopLayoutGuide.length - statusBarHeight, <span class="number">0.0</span>f, obj.xx_navigationBarBottomLayoutGuide.length, <span class="number">0.0</span>f) : <span class="built_in">UIEdgeInsetsZero</span>;</div><div class="line">                tv.contentInset = tv.scrollIndicatorInsets = insets;</div><div class="line">                tv.contentOffset = <span class="built_in">CGPointMake</span>(insets.left, -insets.top);</div><div class="line">                *v_stop = <span class="literal">YES</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä½¿ç”¨åœºæ™¯&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨åœºæ™¯&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨åœºæ™¯&quot;&gt;&lt;/a&gt;ä½¿ç”¨åœºæ™¯&lt;/h3&gt;&lt;p&gt;åœ¨ iOS å®¢æˆ·ç«¯ä¸­ï¼Œå¤šä¸ª childViewController çš„é¡µé¢æ˜¯ä¸ªå¾ˆå¸¸è§çš„äº¤äº’è®¾è®¡ï¼Œç›®å‰å·²ç»å¹¿æ³›è¿ç”¨åœ¨å„ç±»çš„ A
    
    </summary>
    
    
      <category term="ObjC" scheme="http://yoursite.com/tags/ObjC/"/>
    
  </entry>
  
  <entry>
    <title>å…³äº UIControlState ä¸€æ¬¡ç¥å¥‡çš„å‘ç°</title>
    <link href="http://yoursite.com/2017/07/03/UIControlState/"/>
    <id>http://yoursite.com/2017/07/03/UIControlState/</id>
    <published>2017-07-03T09:41:01.000Z</published>
    <updated>2018-02-13T09:07:23.508Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å‘ç°å…³äº <code>UIButton</code> çŠ¶æ€çš„ä¸€ä¸ªæŒºæœ‰æ„æ€çš„é—®é¢˜ï¼Œå¤§æ¦‚å°±æ˜¯ï¼š</p>
<p>å½“ä¸€ä¸ªæŒ‰é’®å¤„äºé€‰ä¸­çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ <code>selected</code> ä¸º <code>YES</code> æ—¶ï¼Œå¦‚æœè¿™æ—¶å€™å†ç‚¹å‡»å®ƒæ—¶ï¼ŒæŒ‰é’®ä¼šå˜æˆ <code>normal</code> çŠ¶æ€æ—¶å€™çš„æ ·å­ï¼</p>
<p>é—®é¢˜æ•ˆæœå¤§æ¦‚è¿™æ ·ï¼š</p>
<p><img src="/images/events.gif" alt=""></p>
<p>å› ä¸ºåªæ˜¯ä¸ª <code>Demo</code> ï¼Œæ‰€ä»¥ä»£ç å†™çš„æ¯”è¾ƒéšæ„ï¼Œå°±æ˜¯è®¾ç½®æŒ‰é’®ä¸åŒçŠ¶æ€ä¸‹çš„å‘ˆç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *btn1;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *btn2;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></div><div class="line">   </div><div class="line">    <span class="built_in">UIButton</span> *btn1 = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</div><div class="line">    btn1.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">60</span>, <span class="number">30</span>);</div><div class="line">    [btn1 setTitle:<span class="string">@"æŒ‰é’®ä¸€"</span> forState:<span class="built_in">UIControlStateNormal</span>];</div><div class="line">    [btn1 setTitleColor:[<span class="built_in">UIColor</span> blackColor] forState:<span class="built_in">UIControlStateNormal</span>];</div><div class="line">    [btn1 setTitleColor:[<span class="built_in">UIColor</span> redColor] forState:<span class="built_in">UIControlStateSelected</span>];</div><div class="line">    [<span class="keyword">self</span>.view addSubview:_btn1 = btn1];</div><div class="line">    [btn1 addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(btn1Click) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</div><div class="line">    </div><div class="line">    <span class="built_in">UIButton</span> *btn2 = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</div><div class="line">    btn2.frame = <span class="built_in">CGRectMake</span>(<span class="number">170</span>, <span class="number">100</span>, <span class="number">60</span>, <span class="number">30</span>);</div><div class="line">    [btn2 setTitle:<span class="string">@"æŒ‰é’®äºŒ"</span> forState:<span class="built_in">UIControlStateNormal</span>];</div><div class="line">    [btn2 setTitleColor:[<span class="built_in">UIColor</span> blackColor] forState:<span class="built_in">UIControlStateNormal</span>];</div><div class="line">    [btn2 setTitleColor:[<span class="built_in">UIColor</span> redColor] forState:<span class="built_in">UIControlStateSelected</span>];</div><div class="line">    [<span class="keyword">self</span>.view addSubview:_btn2 = btn2];</div><div class="line">    [btn2 addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(btn2Click) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)btn1Click &#123;</div><div class="line">    <span class="keyword">if</span>(_btn2.isSelected) &#123;_btn2.selected = <span class="literal">NO</span>;&#125;</div><div class="line">    _btn1.selected = <span class="literal">YES</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)btn2Click &#123;</div><div class="line">    <span class="keyword">if</span>(_btn1.isSelected) &#123;_btn1.selected = <span class="literal">NO</span>;&#125;</div><div class="line">    _btn2.selected = <span class="literal">YES</span>;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¿™é‡Œåˆ†åˆ«è®¾ç½®äº†æŒ‰é’® <code>UIControlStateNormal</code>å’Œ <code>UIControlStateSelected</code> çŠ¶æ€çš„æ ‡é¢˜é¢œè‰²ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>
<p>åˆ†åˆ«åŠ ä¸Šè¿™ä¸¤å¥å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[btn1 setTitleColor:[<span class="built_in">UIColor</span> redColor] forState:<span class="built_in">UIControlStateSelected</span>|<span class="built_in">UIControlStateHighlighted</span>];</div><div class="line"></div><div class="line">[btn2 setTitleColor:[<span class="built_in">UIColor</span> redColor] forState:<span class="built_in">UIControlStateSelected</span>|<span class="built_in">UIControlStateHighlighted</span>];</div></pre></td></tr></table></figure>
<p>è‡³äºä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ <code>UIControlState</code> æšä¸¾çš„å®šä¹‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSUInteger</span>, <span class="built_in">UIControlState</span>) &#123;</div><div class="line">    <span class="built_in">UIControlStateNormal</span>       = <span class="number">0</span>,</div><div class="line">    <span class="built_in">UIControlStateHighlighted</span>  = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,                  <span class="comment">// used when UIControl isHighlighted is set</span></div><div class="line">    <span class="built_in">UIControlStateDisabled</span>     = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</div><div class="line">    <span class="built_in">UIControlStateSelected</span>     = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,                  <span class="comment">// flag usable by app (see below)</span></div><div class="line">    <span class="built_in">UIControlStateFocused</span> <span class="built_in">NS_ENUM_AVAILABLE_IOS</span>(<span class="number">9</span>_0) = <span class="number">1</span> &lt;&lt; <span class="number">3</span>, <span class="comment">// Applicable only when the screen supports focus</span></div><div class="line">    <span class="built_in">UIControlStateApplication</span>  = <span class="number">0x00FF0000</span>,              <span class="comment">// additional flags available for application use</span></div><div class="line">    <span class="built_in">UIControlStateReserved</span>     = <span class="number">0xFF000000</span>               <span class="comment">// flags reserved for internal framework use</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¿™æ˜¯ä¸ª <code>NS_OPTIONS</code> ç±»å‹çš„æšä¸¾ã€‚æ—¢ç„¶æ˜¯ <code>NS_OPTIONS</code> ç±»å‹ï¼Œå°±è¡¨ç¤ºæŒ‰é’®çš„çŠ¶æ€å¯ä»¥æ˜¯å¤šä¸ªçŠ¶æ€çš„ï¼šæ¯”å¦‚ä¸Šé¢é€‰ä¸­çŠ¶æ€ä¸‹å†ç‚¹å‡»ï¼Œå¯ä»¥ç†è§£ä¸º <strong>é€‰ä¸­|é«˜äº®</strong> çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯  <code>UIControlStateSelected|UIControlStateHighlighted</code>ã€‚å½“æˆ‘ä»¬å¤„äºæŸä¸ªçŠ¶æ€ï¼ˆselectedï¼‰ä¸‹ï¼Œå†æƒ³è§¦å‘å¦å¤–ä¸€ä¸ªçŠ¶æ€ï¼ˆhighlightedï¼‰ï¼Œå¦‚æœä¸åšå¤„ç†ï¼Œå°±ä¼šå¯¼è‡´ä¸€å¼€å§‹è¯´çš„é‚£ç§æƒ…å†µã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘å‘ç°å…³äº &lt;code&gt;UIButton&lt;/code&gt; çŠ¶æ€çš„ä¸€ä¸ªæŒºæœ‰æ„æ€çš„é—®é¢˜ï¼Œå¤§æ¦‚å°±æ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªæŒ‰é’®å¤„äºé€‰ä¸­çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ &lt;code&gt;selected&lt;/code&gt; ä¸º &lt;code&gt;YES&lt;/code&gt; æ—¶ï¼Œå¦‚æœè¿™æ—¶å€™å†ç‚¹å‡»å®ƒæ—¶ï¼ŒæŒ‰é’®ä¼šå˜æˆ &lt;code&gt;
    
    </summary>
    
    
      <category term="ObjC" scheme="http://yoursite.com/tags/ObjC/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨å¤šæ€åŠåè®®å¤šé‡ç»§æ‰¿ç»Ÿä¸€æ¥å£æ•°æ®æ ¼å¼</title>
    <link href="http://yoursite.com/2017/04/17/protocol/"/>
    <id>http://yoursite.com/2017/04/17/protocol/</id>
    <published>2017-04-17T15:15:57.000Z</published>
    <updated>2018-02-13T09:05:37.846Z</updated>
    
    <content type="html"><![CDATA[<p>å¼€å§‹ä¹‹å‰å…ˆç®€å•è¯´ä¸‹éœ€æ±‚ï¼šé¦–å…ˆï¼Œé¡µé¢æ ·å¼ç”± A éƒ¨é—¨è´Ÿè´£ï¼Œä½†æ˜¯é¡µé¢çš„æ•°æ®ä¾èµ–äº B éƒ¨é—¨å’Œ C éƒ¨é—¨ï¼ŒBã€C éƒ½æœ‰è‡ªå·±çš„å”¯ä¸€æ ‡è¯† <code>projectTag</code> å¹¶ä¸”éƒ½æœ‰è‡ªå·±çš„æ¥å£ï¼Œæ¥å£å­—æ®µéƒ½ä¸ç›¸åŒï¼Œä»–ä»¬çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/images/pic.png" alt=""></p>
<p>åœ¨è¿™ç§å…³ç³»ç»“æ„ä¸‹å°±ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šB æ¥å£å’Œ C æ¥å£éƒ½æœ‰è‡ªå·±æ•°æ®æ ¼å¼ï¼ŒA éƒ¨é—¨çš„é¡µé¢åˆ°åº•ç”¨å“ªä¸ªæ¥å£ï¼Ÿæ€»ä¸èƒ½ç”¨ <code>if else</code> åˆ¤æ–­å§ï¼Ÿä¸‡ä¸€è¿˜æœ‰éƒ¨é—¨ Dã€éƒ¨é—¨ E å‘¢ï¼Ÿ</p>
<h2 id="åˆ©ç”¨åè®®å®ç°å¤šé‡ç»§æ‰¿"><a href="#åˆ©ç”¨åè®®å®ç°å¤šé‡ç»§æ‰¿" class="headerlink" title="åˆ©ç”¨åè®®å®ç°å¤šé‡ç»§æ‰¿"></a>åˆ©ç”¨åè®®å®ç°å¤šé‡ç»§æ‰¿</h2><p>é¦–å…ˆæˆ‘ä»¬æ–°å»ºä¸ªåè®® <code>PublicProtocol.h</code>ï¼Œè¿™ä¸ªåè®®å®šä¹‰äº† <code>é¡µé¢VC</code> æ‰€éœ€è¦çš„æ•°æ®å…ƒç´ ï¼ˆè¿™é‡Œä¸€èˆ¬éƒ½å®šä¹‰æˆ <code>readonly</code> ï¼Œä¸å…è®¸å¤–éƒ¨ä¿®æ”¹ï¼‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#ifndef PublicProtocol_h</span></div><div class="line"><span class="meta">#define PublicProtocol_h</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">DataInfoProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></div><div class="line"><span class="keyword">@required</span></div><div class="line"><span class="comment">/** title */</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *title;</div><div class="line"><span class="keyword">@optional</span></div><div class="line"><span class="comment">/** subTitle */</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *subTitle;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="meta">#endif /* PublicProtocol_h */</span></div></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬åœ¨éƒ¨é—¨ A å’Œéƒ¨é—¨ Bçš„æ¥å£ <code>Model</code> ä¸­å®ç°è¿™ä¸ªåè®®å¹¶è¿”å›æ‰€éœ€è¦çš„æ•°æ®ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ClassAModel.h</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"PublicProtocol.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ClassAModel</span> : <span class="title">NSObject</span></span></div><div class="line">&lt;DataInfoProtocol&gt;</div><div class="line"></div><div class="line"><span class="comment">/** titleA */</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *titleA;</div><div class="line"></div><div class="line"><span class="comment">/** subTitleA */</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *subTitleA;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"ClassAModel.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ClassAModel</span></span></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - DataInfoProtocol setter</span></div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)title &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.titleA;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)subTitle &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.subTitleA;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>éƒ¨é—¨ B çš„æ¥å£ <code>Model</code> ä¹Ÿç±»ä¼¼ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ClassBModel.h</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"PublicProtocol.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ClassBModel</span> : <span class="title">NSObject</span></span></div><div class="line">&lt;DataInfoProtocol&gt;</div><div class="line"></div><div class="line"><span class="comment">/** titleB */</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *titleB;</div><div class="line"></div><div class="line"><span class="comment">/** subTitleB */</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *subTitleB;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ClassBModel.m</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"ClassBModel.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ClassBModel</span></span></div><div class="line"><span class="meta">#pragma mark - DataInfoProtocol setter</span></div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)title &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.titleB;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)subTitle &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.subTitleB;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±è§£å†³äº†ä¸åŒæ¥å£å‚æ•°ä¸ä¸€æ ·çš„é—®é¢˜ï¼Œç»Ÿä¸€äº†æ¥å£å­—æ®µã€‚æ¥ç€æˆ‘ä»¬è¿˜æœ‰ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p>è¯¥æ€ä¹ˆä¼ é€’æ•°æ®ç»™ <code>é¡µé¢VC</code> ï¼Ÿ</p>
</blockquote>
<h2 id="åˆ©ç”¨å¤šæ€ç‰¹æ€§ä¼ é€’æ•°æ®"><a href="#åˆ©ç”¨å¤šæ€ç‰¹æ€§ä¼ é€’æ•°æ®" class="headerlink" title="åˆ©ç”¨å¤šæ€ç‰¹æ€§ä¼ é€’æ•°æ®"></a>åˆ©ç”¨å¤šæ€ç‰¹æ€§ä¼ é€’æ•°æ®</h2><p>é¦–å…ˆæˆ‘ä»¬æ–°å»ºä¸ªæŠ½è±¡æ•°æ®æºåŸºç±» <code>BaseClass.h</code>ï¼Œé‡Œé¢å®šä¹‰å¥½ <code>é¡µé¢VC</code> æ‰€éœ€è¦çš„æ•°æ®æºï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//BaseClass.h</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"PublicProtocol.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BaseClass</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="comment">/** æ•°æ®æº*/</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> &lt;<span class="keyword">id</span>&lt;DataInfoProtocol&gt;&gt; *dataList;</div><div class="line"></div><div class="line"><span class="comment">/** æ¥å£è¯·æ±‚æ“ä½œ*/</span></div><div class="line">- (<span class="keyword">void</span>)fetchDataWithCompletionHandler:(<span class="keyword">void</span>(^)())completeBlock;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œè¿”å›çš„æ•°æ®æºæ˜¯ä¸€ä¸ªå®ç° <code>DataInfoProtocol</code> åè®®çš„å¯¹è±¡æ•°ç»„ <code>dataList</code>ã€‚</p>
<p>æ¥ç€æ¯ä¸ªéƒ¨é—¨éƒ½åŒ…å«ä¸€ä¸ª<code>BaseClass</code>çš„å­ç±»ï¼Œæ¯”å¦‚éƒ¨é—¨ A çš„æ•°æ®æºç±» <code>ClassA.h</code>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ClassA.h</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"BaseClass.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ClassA</span> : <span class="title">BaseClass</span></span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ClassA.m</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"ClassA.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"ClassAModel.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ClassA</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)fetchDataWithCompletionHandler:(<span class="keyword">void</span> (^)())completeBlock &#123;</div><div class="line">    </div><div class="line">    <span class="comment">//æ¨¡æ‹Ÿè¯·æ±‚æ¥å£æ“ä½œ</span></div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span>f * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        </div><div class="line">        <span class="built_in">NSDictionary</span> *tempDict = @&#123;<span class="string">@"titleA"</span>    : <span class="string">@"Jhons"</span>,</div><div class="line">                                   <span class="string">@"subTitleA"</span> : <span class="string">@"iOS dev"</span>&#125;;</div><div class="line">        ClassAModel *aModel = [ClassAModel classAModelWithDict:tempDict];</div><div class="line">        <span class="keyword">self</span>.dataList = @[aModel];</div><div class="line">        </div><div class="line">        completeBlock();</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)dealloc &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@dealloc"</span>,<span class="keyword">self</span>.class);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œæ¨¡æ‹Ÿäº†è¯·æ±‚æ¥å£ï¼Œè¿”å›äº† A æ¥å£çš„æ•°æ®æºï¼ŒB éƒ¨é—¨ä¹Ÿç±»ä¼¼ã€‚</p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬ç”³æ˜æŠ½è±¡æ•°æ®æºç±» <code>BaseClass</code>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** Data Class */</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) BaseClass *dataClass;</div></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®æ¯ä¸ªéƒ¨é—¨çš„ <code>projectTag</code> æ ‡è¯†ï¼Œæ¥åˆ›å»ºä¸åŒçš„æ•°æ®æºç±»ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated &#123;</div><div class="line">    [<span class="keyword">super</span> viewWillAppear:animated];</div><div class="line">    </div><div class="line">    <span class="built_in">NSString</span> *plistPath = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"ProjectMaps"</span> ofType:<span class="string">@"plist"</span>];</div><div class="line">    <span class="built_in">NSDictionary</span> *dictionary = [[<span class="built_in">NSDictionary</span> alloc] initWithContentsOfFile:plistPath];</div><div class="line">    <span class="keyword">self</span>.dataClass = [<span class="built_in">NSClassFromString</span>(dictionary[<span class="keyword">self</span>.projectTag]) new];</div><div class="line">    </div><div class="line">    [MBProgressHUD showHUDAddedTo:<span class="keyword">self</span>.view animated:<span class="literal">YES</span>];</div><div class="line">    [<span class="keyword">self</span>.dataClass fetchDataWithCompletionHandler:^&#123;</div><div class="line">        [MBProgressHUD hideHUDForView:<span class="keyword">self</span>.view animated:<span class="literal">YES</span>];</div><div class="line">        [<span class="keyword">self</span>.tvDetial reloadData];</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ç”¨äº†ä¸ª <code>ProjectMaps.plist</code>ï¼Œæ¥æ ¹æ®æ¯ä¸ªé¡¹ç›®çš„ <code>projectTag</code> æ ‡è¯†ï¼Œå®šä¹‰å¥½æ•°æ®æºç±»ï¼š</p>
<p><img src="/images/pic_01.png" alt=""></p>
<p>å†™çš„ä¾‹å­æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯è®¾è®¡æ€è·¯åº”è¯¥å¾ˆæ˜ç™½äº†ï¼Œå…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="/images/maps.gif" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼€å§‹ä¹‹å‰å…ˆç®€å•è¯´ä¸‹éœ€æ±‚ï¼šé¦–å…ˆï¼Œé¡µé¢æ ·å¼ç”± A éƒ¨é—¨è´Ÿè´£ï¼Œä½†æ˜¯é¡µé¢çš„æ•°æ®ä¾èµ–äº B éƒ¨é—¨å’Œ C éƒ¨é—¨ï¼ŒBã€C éƒ½æœ‰è‡ªå·±çš„å”¯ä¸€æ ‡è¯† &lt;code&gt;projectTag&lt;/code&gt; å¹¶ä¸”éƒ½æœ‰è‡ªå·±çš„æ¥å£ï¼Œæ¥å£å­—æ®µéƒ½ä¸ç›¸åŒï¼Œä»–ä»¬çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/im
    
    </summary>
    
    
      <category term="ObjC" scheme="http://yoursite.com/tags/ObjC/"/>
    
  </entry>
  
  <entry>
    <title>Masonry æºç è§£æ</title>
    <link href="http://yoursite.com/2017/02/23/Masonry-Analysis/"/>
    <id>http://yoursite.com/2017/02/23/Masonry-Analysis/</id>
    <published>2017-02-23T13:40:52.000Z</published>
    <updated>2018-02-13T09:03:50.716Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/SnapKit/Masonry" target="_blank" rel="external">Masonry</a> æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ç”¨äºè‡ªåŠ¨å¸ƒå±€ï¼ˆAutoLayoutï¼‰çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œä»¥å…¶ç®€æ´çš„ä½¿ç”¨æ–¹å¼ï¼Œå—åˆ°å¹¿å¤§å¼€å‘è€…çš„é’çã€‚æœ¬ç¯‡æ–‡ç« å°†å¸¦ä½ ä¸€æ­¥æ­¥çš„å»äº†è§£å…¶å®ç°åŸç†ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶ï¼</p>
<h3 id="ç»“æ„æ¦‚è§ˆ"><a href="#ç»“æ„æ¦‚è§ˆ" class="headerlink" title="ç»“æ„æ¦‚è§ˆ"></a>ç»“æ„æ¦‚è§ˆ</h3><p><img src="http://p0kmbfoc8.bkt.clouddn.com/Snip20171227_1.png" alt=""></p>
<ul>
<li><p>æœ€ä¸Šé¢çš„å‡ ä¸ª <code>category</code>ï¼ŒåŒ…å«äº†æˆ‘ä»¬å¸¸ç”¨çš„ä¸€äº›æ–¹æ³•åŠå±æ€§ï¼Œä¾‹å¦‚ï¼š</p>
  <figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSArray</span> *)mas_makeConstraints:(<span class="keyword">void</span>(<span class="built_in">NS_NOESCAPE</span> ^)(MASConstraintMaker *make))block;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>ä¸­é—´çš„æ˜¯ä¸€ä¸ªç»§æ‰¿è‡ª <code>NSObject</code> çš„å·¥å‚ç±»ï¼Œä¸»è¦è´Ÿè´£åˆ›å»º <code>MASConstraint</code> å¯¹è±¡ä»¥åŠæŠŠçº¦æŸæ·»åŠ åˆ°è§†å›¾ä¸Šã€‚</p>
</li>
<li><p>æœ€ä¸‹é¢ <code>MASConstraint</code> æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šçš„æ–¹æ³•éƒ½å¿…é¡»åœ¨å­ç±»ä¸­é‡å†™ã€‚<code>MASViewConstraint</code> å’Œ <code>MASCompositeConstraint</code> æ˜¯å®ƒçš„ä¸¤ä¸ªå­ç±»ï¼Œä»‹ç»è¿™ä¸¤ä¸ªä¹‹å‰æˆ‘ä»¬å…ˆè¯´ä¸‹ <code>MASViewAttribute</code>ï¼š</p>
<p>  æˆ‘ä»¬éƒ½çŸ¥é“ç³»ç»Ÿåˆ›å»ºä¸€æ¡çº¦æŸçš„æ–¹æ³•ï¼š</p>
  <figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">+(<span class="keyword">instancetype</span>)constraintWithItem:(<span class="keyword">id</span>)view1</div><div class="line">                       attribute:(<span class="built_in">NSLayoutAttribute</span>)attr1</div><div class="line">                       relatedBy:(<span class="built_in">NSLayoutRelation</span>)relation</div><div class="line">                          toItem:(<span class="keyword">nullable</span> <span class="keyword">id</span>)view2</div><div class="line">                       attribute:(<span class="built_in">NSLayoutAttribute</span>)attr2</div><div class="line">                      multiplier:(<span class="built_in">CGFloat</span>)multiplier</div><div class="line">                        constant:(<span class="built_in">CGFloat</span>)c;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><code>MASViewAttribute</code> å°±æ˜¯å¯¹ <code>attribute</code> å’Œ <code>Item</code> è¿™ä¸¤ä¸ªå±æ€§çš„å°è£…ï¼›<code>MASViewConstraint</code> å°±æ˜¯å¯¹ <code>MASViewAttribute</code> çš„å°è£…ï¼Œå¯ä»¥ç†è§£ä¸º<strong>ä¸€æ¡</strong>çº¦æŸå¯¹è±¡ï¼›<code>MASCompositeConstraint</code> åˆ™å°±æ˜¯çº¦æŸçš„é›†åˆï¼Œå®ƒé‡Œé¢æœ‰ä¸ªç§æœ‰çš„æ•°ç»„ç”¨æ¥å­˜æ”¾å¤šä¸ª <code>MASViewAttribute</code> å¯¹è±¡ã€‚</p>
<h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><h4 id="View-MASAdditions"><a href="#View-MASAdditions" class="headerlink" title="View+MASAdditions"></a>View+MASAdditions</h4><p>æˆ‘ä»¬ç»˜åˆ¶ä¸€ä¸ªå±…äºçˆ¶è§†å›¾ï¼ˆselfï¼‰ä¸Šã€å·¦ä¸º <code>20.0f</code> ï¼Œå³ä¸º <code>-20.0f</code>å¹¶ä¸”é«˜åº¦ä¸€åŠçš„ <code>view</code> çš„çº¦æŸå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[view mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">	make.height.equalTo(<span class="keyword">self</span>).multipliedBy(<span class="number">0.5</span>);</div><div class="line">    make.top.equalTo(<span class="keyword">self</span>).offset(<span class="number">20.0</span>f);</div><div class="line">    make.left.equalTo(@<span class="number">20.0</span>f);</div><div class="line">    make.right.offset(<span class="number">-20.0</span>f);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç‚¹è¿› <code>View+MASAdditions.m</code> é‡Œé¢å¯ä»¥çœ‹åˆ°å†…éƒ¨ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSArray</span> *)mas_makeConstraints:(<span class="keyword">void</span>(^)(MASConstraintMaker *))block &#123;</div><div class="line">    <span class="keyword">self</span>.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</div><div class="line">    MASConstraintMaker *constraintMaker = [[MASConstraintMaker alloc] initWithView:<span class="keyword">self</span>];</div><div class="line">    block(constraintMaker);</div><div class="line">    <span class="keyword">return</span> [constraintMaker install];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>é¦–å…ˆè¿™é‡Œå·²ç»å¸®æˆ‘ä»¬æŠŠ <code>translatesAutoresizingMaskIntoConstraints</code> å±æ€§è®¾ç½®ä¸º <code>NO</code> äº†ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨å¤–é¢å¯ä»¥çœå»è¿™ä¸€æ­¥ã€‚</li>
<li>ç„¶ååˆå§‹åŒ– <code>MASConstraintMaker</code> å·¥å‚å®ä¾‹å¯¹è±¡å¹¶ä¿å­˜äº†å½“å‰è§†å›¾ <code>self.view</code>ã€‚</li>
<li>æ¥ç€æŠŠåˆå§‹åŒ–å¥½çš„ <code>MASConstraintMaker</code> å¯¹è±¡ä¼ å…¥ <code>block</code>ï¼Œå›è°ƒç»™å¤–é¢é…ç½®çº¦æŸå±æ€§ã€‚</li>
<li>æœ€åè°ƒç”¨ <code>install</code> æ–¹æ³•ï¼ŒæŠŠé…ç½®å¥½çš„çº¦æŸæ·»åŠ åˆ°è§†å›¾ä¸Šå»ã€‚</li>
</ul>
<p>ä»¥ä¸Šå°±æ˜¯<strong>æ·»åŠ </strong>çº¦æŸçš„å¤§æ¦‚æµç¨‹ï¼Œæˆ‘ä»¬å†çœ‹çœ‹<strong>æ›´æ–°</strong>å’Œ<strong>é‡æ–°æ„å»º</strong>çº¦æŸçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSArray</span> *)mas_updateConstraints:(<span class="keyword">void</span>(^)(MASConstraintMaker *))block &#123;</div><div class="line">    <span class="keyword">self</span>.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</div><div class="line">    MASConstraintMaker *constraintMaker = [[MASConstraintMaker alloc] initWithView:<span class="keyword">self</span>];</div><div class="line">    constraintMaker.updateExisting = <span class="literal">YES</span>;</div><div class="line">    block(constraintMaker);</div><div class="line">    <span class="keyword">return</span> [constraintMaker install];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSArray</span> *)mas_remakeConstraints:(<span class="keyword">void</span>(^)(MASConstraintMaker *make))block &#123;</div><div class="line">    <span class="keyword">self</span>.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</div><div class="line">    MASConstraintMaker *constraintMaker = [[MASConstraintMaker alloc] initWithView:<span class="keyword">self</span>];</div><div class="line">    constraintMaker.removeExisting = <span class="literal">YES</span>;</div><div class="line">    block(constraintMaker);</div><div class="line">    <span class="keyword">return</span> [constraintMaker install];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°å®ƒä»¬å’Œ <code>mas_makeConstraints</code> å”¯ä¸€çš„åŒºåˆ«åœ¨äºå¤šä¼ äº† <code>updateExisting</code> ä»¥åŠ <code>removeExisting</code> è¿™ä¸¤ä¸ª <code>BOOL</code>å±æ€§å€¼ï¼š</p>
<ul>
<li><code>mas_updateConstraints</code>ï¼šæ‰¾åˆ°éœ€è¦æ›´æ–°çš„ <code>NSLayoutConstraint</code>ï¼Œæ›¿æ¢æˆæ–°çº¦æŸã€‚</li>
<li><code>mas_remakeConstraints</code>ï¼šæ¸…é™¤æ‰€æœ‰ <code>NSLayoutConstraint</code>ï¼Œå†æ·»åŠ æ–°çº¦æŸã€‚</li>
</ul>
<h4 id="MASConstraintMaker"><a href="#MASConstraintMaker" class="headerlink" title="MASConstraintMaker"></a>MASConstraintMaker</h4><p>çŸ¥é“äº†è¿™ä¸‰ä¸ªæ–¹æ³•çš„å¤§æ¦‚ä½œç”¨å’Œå…³ç³»ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†çœ‹çœ‹ <code>MASConstraintMaker</code> è¿™ä¸ªå·¥å‚ç±»æ˜¯å¦‚ä½•é…ç½®çº¦æŸçš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make.height</div></pre></td></tr></table></figure>
<p>è°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (MASConstraint *)height &#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> addConstraintWithLayoutAttribute:<span class="built_in">NSLayoutAttributeHeight</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (MASConstraint *)addConstraintWithLayoutAttribute:(<span class="built_in">NSLayoutAttribute</span>)layoutAttribute &#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> constraint:<span class="literal">nil</span> addConstraintWithLayoutAttribute:layoutAttribute];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(<span class="built_in">NSLayoutAttribute</span>)layoutAttribute &#123;</div><div class="line">    MASViewAttribute *viewAttribute = [[MASViewAttribute alloc] initWithView:<span class="keyword">self</span>.view layoutAttribute:layoutAttribute];</div><div class="line">    MASViewConstraint *newConstraint = [[MASViewConstraint alloc] initWithFirstViewAttribute:viewAttribute];</div><div class="line">    <span class="keyword">if</span> ([constraint isKindOfClass:MASViewConstraint.class]) &#123; Â·Â·Â· &#125;</div><div class="line">    <span class="keyword">if</span> (!constraint) &#123;</div><div class="line">        newConstraint.delegate = <span class="keyword">self</span>;</div><div class="line">        [<span class="keyword">self</span>.constraints addObject:newConstraint];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> newConstraint;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç”±äº <code>constraint</code> ä¼ çš„æ˜¯ <code>nil</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå¿½ç•¥ä¸­é—´ä¸€æ®µä»£ç ï¼š</p>
<ul>
<li>è¿™é‡Œå…ˆæ˜¯åˆå§‹åŒ–äº† <code>MASViewAttribute</code> å¯¹è±¡å¹¶ä¿å­˜äº† <code>view</code>ã€<code>item</code>ä»¥åŠ<code>NSLayoutAttribute</code>ä¸‰ä¸ªå±æ€§ã€‚</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)initWithView:(MAS_VIEW *)view layoutAttribute:(<span class="built_in">NSLayoutAttribute</span>)layoutAttribute &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">self</span> initWithView:view item:view layoutAttribute:layoutAttribute];</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">id</span>)initWithView:(MAS_VIEW *)view item:(<span class="keyword">id</span>)item layoutAttribute:(<span class="built_in">NSLayoutAttribute</span>)layoutAttribute &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    </div><div class="line">    _view = view;</div><div class="line">    _item = item;</div><div class="line">    _layoutAttribute = layoutAttribute;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ç„¶ååˆåˆå§‹åŒ–äº† <code>MASViewConstraint</code> å¯¹è±¡ï¼Œå†…éƒ¨é…ç½®äº†äº›é»˜è®¤å‚æ•°å¹¶ä¿å­˜äº†ç¬¬ä¸€ä¸ªçº¦æŸå‚æ•° <code>MASViewAttribute</code>ã€‚</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)initWithFirstViewAttribute:(MASViewAttribute *)firstViewAttribute &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    </div><div class="line">    _firstViewAttribute = firstViewAttribute;</div><div class="line">    <span class="keyword">self</span>.layoutPriority = MASLayoutPriorityRequired;</div><div class="line">    <span class="keyword">self</span>.layoutMultiplier = <span class="number">1</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>æœ€åè®¾ç½® <code>MASViewConstraint</code> å¯¹è±¡ä»£ç†å¹¶æ·»åŠ åˆ°ä¸€å¼€å§‹å‡†å¤‡å¥½çš„ <code>self.constraints</code> æ•°ç»„ä¸­ï¼Œè¿”å›ã€‚</li>
</ul>
<p>è¿™äº›å·¥ä½œå°±æ˜¯åœ¨è¾“å…¥ <code>make.height</code> è¿›è¡Œçš„å…¨éƒ¨å·¥ä½œï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª <code>MASViewConstraint</code> å¯¹è±¡ï¼Œç”¨äºä¹‹åçš„ç»§ç»­é…ç½®ã€‚</p>
<h4 id="MASViewConstraint"><a href="#MASViewConstraint" class="headerlink" title="MASViewConstraint"></a>MASViewConstraint</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make.height.equalTo(<span class="keyword">self</span>)</div></pre></td></tr></table></figure>
<p>åœ¨ <code>make.height</code> è¿”å› <code>MASViewConstraint</code> å¯¹è±¡åï¼Œä¼šç»§ç»­åœ¨è¿™ä¸ªé“¾å¼çš„è¯­æ³•ä¸­è°ƒç”¨ä¸‹ä¸€ä¸ªæ–¹æ³•æ¥æŒ‡å®šçº¦æŸçš„å…³ç³»ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (MASConstraint * (^)(<span class="keyword">id</span> attr))equalTo;</div><div class="line"></div><div class="line">- (MASConstraint * (^)(<span class="keyword">id</span> attr))greaterThanOrEqualTo;</div><div class="line"></div><div class="line">- (MASConstraint * (^)(<span class="keyword">id</span> attr))lessThanOrEqualTo;</div></pre></td></tr></table></figure>
<p>æ–‡ç« å¼€å¤´è¯´è¿‡ï¼Œ<code>MASConstraint</code> æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œå…·ä½“å®ç°éƒ½åœ¨å®ƒçš„ä¸¤ä¸ªå­ç±»ä¸­ï¼Œ<code>equalTo(self)</code> çš„è°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//MASConstraint.m</span></div><div class="line"></div><div class="line">- (MASConstraint * (^)(<span class="keyword">id</span>))equalTo &#123;</div><div class="line">    <span class="keyword">return</span> ^<span class="keyword">id</span>(<span class="keyword">id</span> attribute) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.equalToWithRelation(attribute, <span class="built_in">NSLayoutRelationEqual</span>);</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//MASViewConstraint.m</span></div><div class="line"></div><div class="line">- (MASConstraint * (^)(<span class="keyword">id</span>, <span class="built_in">NSLayoutRelation</span>))equalToWithRelation &#123;</div><div class="line">    <span class="keyword">return</span> ^<span class="keyword">id</span>(<span class="keyword">id</span> attribute, <span class="built_in">NSLayoutRelation</span> relation) &#123;</div><div class="line">        <span class="keyword">if</span> ([attribute isKindOfClass:<span class="built_in">NSArray</span>.class]) &#123;</div><div class="line">            .....</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            .....</div><div class="line">            <span class="keyword">self</span>.layoutRelation = relation;</div><div class="line">            <span class="keyword">self</span>.secondViewAttribute = attribute;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡ŒåŒæ ·å…ˆçœç•¥éƒ¨åˆ†ä»£ç ï¼Œæ–¹ä¾¿æˆ‘ä»¬é˜…è¯»ï¼š</p>
<ul>
<li>é¦–å…ˆæ˜¯ <code>self.layoutRelation</code> ä¿å­˜äº†çº¦æŸå…³ç³»ä¸”é‡å†™äº† <code>set</code> æ–¹æ³•ï¼Œåœ¨é‡Œé¢ç”¨ <code>self.hasLayoutRelation</code> è¿™ä¸ª <code>BOOL</code> æ ‡è¯†å·²ç»æœ‰çº¦æŸå…³ç³»ã€‚</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setLayoutRelation:(<span class="built_in">NSLayoutRelation</span>)layoutRelation &#123;</div><div class="line">	_layoutRelation = layoutRelation;</div><div class="line"> 	<span class="keyword">self</span>.hasLayoutRelation = <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ç„¶ååŒæ ·æ˜¯é‡å†™äº† <code>self.secondViewAttribute</code> çš„ <code>set</code> æ–¹æ³•ï¼Œè¿™é‡Œä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µåšä¸åŒçš„æ“ä½œã€‚</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setSecondViewAttribute:(<span class="keyword">id</span>)secondViewAttribute &#123;</div><div class="line">    <span class="keyword">if</span> ([secondViewAttribute isKindOfClass:<span class="built_in">NSValue</span>.class]) &#123;</div><div class="line">        [<span class="keyword">self</span> setLayoutConstantWithValue:secondViewAttribute];</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([secondViewAttribute isKindOfClass:MAS_VIEW.class]) &#123;</div><div class="line">        _secondViewAttribute = [[MASViewAttribute alloc] initWithView:secondViewAttribute layoutAttribute:<span class="keyword">self</span>.firstViewAttribute.layoutAttribute];</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([secondViewAttribute isKindOfClass:MASViewAttribute.class]) &#123;</div><div class="line">        _secondViewAttribute = secondViewAttribute;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">NSAssert</span>(<span class="literal">NO</span>, <span class="string">@"attempting to add unsupported attribute: %@"</span>, secondViewAttribute);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>ç¬¬ä¸€ç§æƒ…å†µå¯¹åº”çš„æ˜¯ï¼š</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make.height.equalTo(@<span class="number">20.0</span>f)</div></pre></td></tr></table></figure>
<p>è°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//MASViewConstraint.m</span></div><div class="line"><span class="keyword">if</span> ([secondViewAttribute isKindOfClass:<span class="built_in">NSValue</span>.class]) &#123;</div><div class="line">    [<span class="keyword">self</span> setLayoutConstantWithValue:secondViewAttribute];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//MASConstraint.m</span></div><div class="line">- (<span class="keyword">void</span>)setLayoutConstantWithValue:(<span class="built_in">NSValue</span> *)value &#123;</div><div class="line">    <span class="keyword">if</span> ([value isKindOfClass:<span class="built_in">NSNumber</span>.class]) &#123;</div><div class="line">        <span class="keyword">self</span>.offset = [(<span class="built_in">NSNumber</span> *)value doubleValue];</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strcmp(value.objCType, <span class="keyword">@encode</span>(<span class="built_in">CGPoint</span>)) == <span class="number">0</span>) &#123;</div><div class="line">        <span class="built_in">CGPoint</span> point;</div><div class="line">        [value getValue:&amp;point];</div><div class="line">        <span class="keyword">self</span>.centerOffset = point;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strcmp(value.objCType, <span class="keyword">@encode</span>(<span class="built_in">CGSize</span>)) == <span class="number">0</span>) &#123;</div><div class="line">        <span class="built_in">CGSize</span> size;</div><div class="line">        [value getValue:&amp;size];</div><div class="line">        <span class="keyword">self</span>.sizeOffset = size;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strcmp(value.objCType, <span class="keyword">@encode</span>(MASEdgeInsets)) == <span class="number">0</span>) &#123;</div><div class="line">        MASEdgeInsets insets;</div><div class="line">        [value getValue:&amp;insets];</div><div class="line">        <span class="keyword">self</span>.insets = insets;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">NSAssert</span>(<span class="literal">NO</span>, <span class="string">@"attempting to set layout constant with unsupported value: %@"</span>, value);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//MASViewConstraint.m</span></div><div class="line">- (<span class="keyword">void</span>)setOffset:(<span class="built_in">CGFloat</span>)offset &#123;</div><div class="line">    <span class="keyword">self</span>.layoutConstant = offset;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//MASViewConstraint.m</span></div><div class="line">- (<span class="keyword">void</span>)setLayoutConstant:(<span class="built_in">CGFloat</span>)layoutConstant &#123;</div><div class="line">    _layoutConstant = layoutConstant;</div><div class="line"></div><div class="line"><span class="meta">#if TARGET_OS_MAC &amp;&amp; !(TARGET_OS_IPHONE || TARGET_OS_TV)</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.useAnimator) &#123;</div><div class="line">        [<span class="keyword">self</span>.layoutConstraint.animator setConstant:layoutConstant];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">self</span>.layoutConstraint.constant = layoutConstant;</div><div class="line">    &#125;</div><div class="line"><span class="meta">#else</span></div><div class="line">    <span class="keyword">self</span>.layoutConstraint.constant = layoutConstant;</div><div class="line"><span class="meta">#endif</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢åˆ°æœ€åä¼šæœ‰ä¸ª <code>CGFloat</code> ç±»å‹çš„ <code>layoutConstant</code> å±æ€§æ¥ä¿å­˜å€¼ï¼Œå¹¶ä¸”åœ¨æœ€åè°ƒç”¨ <code>install</code> æ–¹æ³•çš„æ—¶å€™ä½œä¸º <code>constant</code> å‚æ•°ä¼ å…¥ã€‚</p>
<p>è¿™é‡Œåªçœ‹äº†ä¸‹ä¼ å…¥çš„ <code>NSValue</code> ä¸º<code>offset</code> çš„æƒ…å†µï¼Œè¿˜æœ‰ <code>centerOffset</code>ã€<code>sizeOffset</code> å’Œ <code>insets</code>ï¼Œä¹Ÿéƒ½å¤§åŒå°å¼‚ï¼Œå°±ä¸ç†¬è¿°äº†ã€‚</p>
<p>å…¶å®è¿™é‡Œæœ‰ä¸€ç‚¹æˆ‘æ²¡æ˜ç™½ï¼š<br>ç›´åˆ°æœ€åè°ƒç”¨ <code>install</code> æ–¹æ³•å‰ï¼Œ<code>self.layoutConstraint</code> è¿™ä¸ª <code>MASLayoutConstraint</code> ç±»å‹çš„å±æ€§éƒ½æ˜¯ <code>nil</code>ï¼Œé‚£ä¹ˆï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.layoutConstraint.constant = layoutConstant;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œçš„èµ‹å€¼åˆæœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ</p>
</blockquote>
<p><strong>ç¬¬äºŒç§æƒ…å†µä¸€èˆ¬æ˜¯ç›´æ¥ä¼ å…¥ä¸€ä¸ªè§†å›¾ï¼š</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make.height.equalTo(<span class="keyword">self</span>)</div></pre></td></tr></table></figure>
<p>è¿™æ—¶ï¼Œå°±ä¼šåˆå§‹åŒ–ä¸€ä¸ª <code>layoutAttribute</code> å±æ€§ä¸ <code>firstViewArribute</code> ï¼ˆç¬¬ä¸€ä¸ªçº¦æŸå‚æ•°å¯¹è±¡ï¼‰ç›¸åŒçš„ <code>MASViewAttribute</code> å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªçº¦æŸå‚æ•°å¯¹è±¡ï¼Œä¸Šé¢ä»£ç æ„æ€å°±æ˜¯ä½¿è§†å›¾ä¸ <code>self</code> é«˜åº¦ç›¸ç­‰ã€‚</p>
<p><strong>ç¬¬ä¸‰ç§æƒ…å†µä¼šä¼ å…¥ä¸€ä¸ªè§†å›¾çš„ <code>MASViewAttribute</code>ï¼š</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">make.height.equalTo(<span class="keyword">self</span>.height)</div><div class="line"><span class="comment">//æˆ–è€…</span></div><div class="line">make.height.equalTo(<span class="keyword">self</span>.mas_height)</div></pre></td></tr></table></figure>
<p>è¿™ä¸¤ç§å†™æ³•å…¶å®æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª <code>MASViewAttribute</code> å¯¹è±¡ã€‚<code>View+MASShorthandAdditions.h</code> è¿™ä¸ª <code>category</code> åªæœ‰ä¸ª <code>.h</code>ï¼Œå®šä¹‰äº†æˆ‘ä»¬å¸¸ç”¨çš„å±æ€§å’Œæ–¹æ³•ï¼Œä½†æ˜¯å…·ä½“å®ç°è¿˜æ˜¯è°ƒç”¨çš„ <code>View+MASAdditions</code> é‡Œé¢çš„æ–¹æ³•ï¼Œå¯ä»¥ç†è§£ä¸ºå»æ‰ <code>mas_</code> å‘½åå‰ç¼€ã€‚</p>
<p>è¿™é‡Œè¿˜æœ‰è®¸å¤šå±æ€§å¯ä»¥è®¾ç½®ï¼Œæ¯”å¦‚ <code>multipliedBy</code>ã€<code>priority</code>ç­‰ç­‰ï¼Œå°±ä¸ä¸€ä¸€ç†¬è¿°äº†ã€‚</p>
<h4 id="é“¾å¼è¯­æ³•ç‰¹æ€§çš„é‡è¦ä¸€ç¯"><a href="#é“¾å¼è¯­æ³•ç‰¹æ€§çš„é‡è¦ä¸€ç¯" class="headerlink" title="é“¾å¼è¯­æ³•ç‰¹æ€§çš„é‡è¦ä¸€ç¯"></a>é“¾å¼è¯­æ³•ç‰¹æ€§çš„é‡è¦ä¸€ç¯</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make.height.width.equalTo(@<span class="number">20</span>);</div></pre></td></tr></table></figure>
<p>è¿™ç§åŒæ—¶è®¾ç½®å¤šä¸ªçº¦æŸå±æ€§çš„æ–¹å¼ç›¸ä¿¡å¤§å®¶ä¸€å®šä¸é™Œç”Ÿï¼Œè®¤çœŸçœ‹çš„äººå¯èƒ½å·²ç»çŒœåˆ°äº†ï¼šé‚£å°±æ˜¯é€šè¿‡ <code>delegate</code> çš„æ–¹å¼ã€‚</p>
<p>ä¸Šé¢å·²ç»æåˆ°è¿‡ï¼Œåœ¨ <code>make.height</code> è®¾ç½®ç¬¬ä¸€ä¸ªçº¦æŸå±æ€§æ—¶ï¼Œ</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(<span class="built_in">NSLayoutAttribute</span>)layoutAttribute</div></pre></td></tr></table></figure>
<p>æ–¹æ³•ä¸­ï¼Œä¼šè®¾ç½® <code>MASViewConstraint</code> å¯¹è±¡ä»£ç†ï¼Œå…¶ä½œç”¨å°±æ˜¯ä¸ºäº†èƒ½å¤ŸåŒæ—¶è®¾ç½®å¤šä¸ªçº¦æŸå±æ€§ï¼æˆ‘ä»¬æ¥çœ‹çœ‹ <code>make.height.width</code> ä¸­ <code>.width</code>çš„è°ƒç”¨é“¾ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//MASConstraint.m</span></div><div class="line"></div><div class="line">- (MASConstraint *)width &#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> addConstraintWithLayoutAttribute:<span class="built_in">NSLayoutAttributeWidth</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//MASViewConstraint.m</span></div><div class="line"></div><div class="line">- (MASConstraint *)addConstraintWithLayoutAttribute:(<span class="built_in">NSLayoutAttribute</span>)layoutAttribute &#123;</div><div class="line">    <span class="built_in">NSAssert</span>(!<span class="keyword">self</span>.hasLayoutRelation, <span class="string">@"Attributes should be chained before defining the constraint relation"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span>.delegate constraint:<span class="keyword">self</span> addConstraintWithLayoutAttribute:layoutAttribute];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//MASConstraintMaker.m</span></div><div class="line">- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(<span class="built_in">NSLayoutAttribute</span>)layoutAttribute &#123;</div><div class="line">	MASViewAttribute *viewAttribute = [[MASViewAttribute alloc] initWithView:<span class="keyword">self</span>.view layoutAttribute:layoutAttribute];</div><div class="line">    MASViewConstraint *newConstraint = [[MASViewConstraint alloc] initWithFirstViewAttribute:viewAttribute];</div><div class="line">    <span class="keyword">if</span> ([constraint isKindOfClass:MASViewConstraint.class]) &#123;</div><div class="line">        <span class="comment">//replace with composite constraint</span></div><div class="line">        <span class="built_in">NSArray</span> *children = @[constraint, newConstraint];</div><div class="line">        MASCompositeConstraint *compositeConstraint = [[MASCompositeConstraint alloc] initWithChildren:children];</div><div class="line">        compositeConstraint.delegate = <span class="keyword">self</span>;</div><div class="line">        [<span class="keyword">self</span> constraint:constraint shouldBeReplacedWithConstraint:compositeConstraint];</div><div class="line">        <span class="keyword">return</span> compositeConstraint;</div><div class="line">    &#125;</div><div class="line">    ....</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šé¢çš„è°ƒç”¨é“¾æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæœ€ç»ˆå°±æ˜¯é€šè¿‡ <code>delegate</code> çš„æ–¹å¼ï¼Œè°ƒç”¨ <code>MASConstraintMaker</code> å·¥å‚ç±»ä¸­çš„ <code>constraint:addConstraintWithLayoutAttribute:</code> æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯é“¾å¼è¯­æ³•èƒ½é“¾èµ·æ¥çš„åŸå› ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å‘ç°å› ä¸º <code>constraint</code> ä¸ä¸º <code>nil</code>ï¼Œæ‰€ä»¥è¿™æ¬¡åˆå§‹åŒ–å¹¶è¿”å›çš„ä¸æ˜¯ <code>MASViewConstraint</code> å¯¹è±¡ï¼Œè€Œæ˜¯ <code>MASCompositeConstraint</code> è¿™ä¸ªå¯¹è±¡äº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç±»ã€‚</p>
<h4 id="MASCompositeConstraint"><a href="#MASCompositeConstraint" class="headerlink" title="MASCompositeConstraint"></a>MASCompositeConstraint</h4><p>æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸‹å¼€å¤´æ˜¯æ€ä¹ˆä»‹ç» <code>MASCompositeConstraint</code> è¿™ä¸ªç±»çš„ï¼šâ€œ<code>MASCompositeConstraint</code> æ˜¯çº¦æŸçš„é›†åˆï¼Œå®ƒé‡Œé¢æœ‰ä¸ªç§æœ‰çš„æ•°ç»„ç”¨æ¥å­˜æ”¾å¤šä¸ª MASViewAttribute å¯¹è±¡â€ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€ä¸Šé¢çš„ä¾‹å­çœ‹ï¼š</p>
<h5 id="make-height-width-equalTo-20"><a href="#make-height-width-equalTo-20" class="headerlink" title="make.height.width.equalTo(@20)"></a>make.height.width.equalTo(@20)</h5><p>å½“èµ°åˆ° <code>.width</code>æ—¶ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(<span class="built_in">NSLayoutAttribute</span>)layoutAttribute &#123;</div><div class="line">    MASViewAttribute *viewAttribute = [[MASViewAttribute alloc] initWithView:<span class="keyword">self</span>.view layoutAttribute:layoutAttribute];</div><div class="line">    MASViewConstraint *newConstraint = [[MASViewConstraint alloc] initWithFirstViewAttribute:viewAttribute];</div><div class="line">    <span class="keyword">if</span> ([constraint isKindOfClass:MASViewConstraint.class]) &#123;</div><div class="line">        <span class="comment">//replace with composite constraint</span></div><div class="line">        <span class="built_in">NSArray</span> *children = @[constraint, newConstraint];</div><div class="line">        MASCompositeConstraint *compositeConstraint = [[MASCompositeConstraint alloc] initWithChildren:children];</div><div class="line">        compositeConstraint.delegate = <span class="keyword">self</span>;</div><div class="line">        [<span class="keyword">self</span> constraint:constraint shouldBeReplacedWithConstraint:compositeConstraint];</div><div class="line">        <span class="keyword">return</span> compositeConstraint;</div><div class="line">    &#125;</div><div class="line">   ....</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆåŠŸçš„èµ°è¿› <code>if</code> åˆ¤è¯»é‡Œé¢ï¼Œå°† <code>.height.wight</code> ä¸¤æ¡çº¦æŸ <code>MASViewConstraint</code> å¯¹è±¡å¡åˆ°æ•°ç»„é‡Œï¼Œåˆ›å»º <code>MASCompositeConstraint</code> å¯¹è±¡ï¼Œå¹¶ä¸”åŒæ ·è®¾ç½®äº† <code>delegate</code>ï¼Œæœ€åè¿˜æŠŠ <code>self.constraints</code> é‡Œé¢äº‹å…ˆæ·»åŠ å¥½çš„çº¦æŸ <code>MASViewConstraint</code> å¯¹è±¡æ›¿æ¢æˆäº† <code>MASCompositeConstraint</code> å¯¹è±¡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)constraint:(MASConstraint *)constraint shouldBeReplacedWithConstraint:(MASConstraint *)replacementConstraint &#123;</div><div class="line">    <span class="built_in">NSUInteger</span> index = [<span class="keyword">self</span>.constraints indexOfObject:constraint];</div><div class="line">    <span class="built_in">NSAssert</span>(index != <span class="built_in">NSNotFound</span>, <span class="string">@"Could not find constraint %@"</span>, constraint);</div><div class="line">    [<span class="keyword">self</span>.constraints replaceObjectAtIndex:index withObject:replacementConstraint];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ç‚¹å‡» <code>MASCompositeConstraint</code> åˆå§‹åŒ–æ–¹æ³•é‡Œçœ‹çœ‹ï¼Œå®ƒå†…éƒ¨ä¼šé€šè¿‡ <code>for</code> å¾ªç¯ï¼ŒæŠŠæ•°ç»„é‡Œé¢çš„<strong>æ‰€æœ‰</strong> <code>MASViewConstraint</code> å¯¹è±¡åŒæ ·è®¾ç½®äº† <code>delegate</code>ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)initWithChildren:(<span class="built_in">NSArray</span> *)children &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line"></div><div class="line">    _childConstraints = [children mutableCopy];</div><div class="line">    <span class="keyword">for</span> (MASConstraint *constraint <span class="keyword">in</span> _childConstraints) &#123;</div><div class="line">        constraint.delegate = <span class="keyword">self</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¹ˆåšçš„ç›®çš„åŒæ—¶æ˜¯ä¸ºäº†èƒ½å¤Ÿç»§ç»­é“¾å¼è°ƒç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å†åŠ ä¸ª <code>.left</code>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make.height.width.left.equalTo(@<span class="number">20</span>);</div></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™çš„è°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//MASConstraint.m</span></div><div class="line"></div><div class="line">- (MASConstraint *)left &#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> addConstraintWithLayoutAttribute:<span class="built_in">NSLayoutAttributeLeft</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//MASCompositeConstraint.m</span></div><div class="line"></div><div class="line">- (MASConstraint *)addConstraintWithLayoutAttribute:(<span class="built_in">NSLayoutAttribute</span>)layoutAttribute &#123;</div><div class="line">    [<span class="keyword">self</span> constraint:<span class="keyword">self</span> addConstraintWithLayoutAttribute:layoutAttribute];</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (MASConstraint *)constraint:(MASConstraint __unused *)constraint addConstraintWithLayoutAttribute:(<span class="built_in">NSLayoutAttribute</span>)layoutAttribute &#123;</div><div class="line">    <span class="keyword">id</span>&lt;MASConstraintDelegate&gt; strongDelegate = <span class="keyword">self</span>.delegate;</div><div class="line">    MASConstraint *newConstraint = [strongDelegate constraint:<span class="keyword">self</span> addConstraintWithLayoutAttribute:layoutAttribute];</div><div class="line">    newConstraint.delegate = <span class="keyword">self</span>;</div><div class="line">    [<span class="keyword">self</span>.childConstraints addObject:newConstraint];</div><div class="line">    <span class="keyword">return</span> newConstraint;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ï¼Œè¿™é‡Œåˆæ˜¯é€šè¿‡ <code>delegate</code> æ–¹å¼ï¼Œè°ƒç”¨ <code>MASConstraintMaker</code> å·¥å‚ç±»ä¸­çš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(<span class="built_in">NSLayoutAttribute</span>)layoutAttribute &#123;</div><div class="line">    MASViewAttribute *viewAttribute = [[MASViewAttribute alloc] initWithView:<span class="keyword">self</span>.view layoutAttribute:layoutAttribute];</div><div class="line">    MASViewConstraint *newConstraint = [[MASViewConstraint alloc] initWithFirstViewAttribute:viewAttribute];</div><div class="line">    </div><div class="line">    ....</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> newConstraint;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸è¿‡è¿™æ¬¡ä»…ä»…æ˜¯åˆå§‹åŒ–äº†ä¸ª <code>MASViewConstraint</code> å¯¹è±¡å°±ç›´æ¥è¿”å›äº†ï¼Œç„¶åå›åˆ°ä¸Šä¸ªæ–¹æ³•ä¸­æ·»åŠ åˆ° <code>MASCompositeConstraint</code> çš„ç§æœ‰æ•°ç»„ <code>self.childConstraints</code> ä¸­è¿”å›å¤‡ç”¨ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">equalTo(@<span class="number">20</span>)</div></pre></td></tr></table></figure>
<p>å› ä¸ºåˆ°<code>.left</code> æ—¶ï¼Œè¿”å›çš„æ˜¯ <code>MASCompositeConstraint</code> å¯¹è±¡ï¼Œåˆ°è¿™ä¸€æ­¥çš„æ—¶å€™ä¼šæœ‰ç‚¹å˜åŒ–ï¼Œè°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//MASConstraint.m</span></div><div class="line"></div><div class="line">- (MASConstraint * (^)(<span class="keyword">id</span>))equalTo &#123;</div><div class="line">    <span class="keyword">return</span> ^<span class="keyword">id</span>(<span class="keyword">id</span> attribute) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.equalToWithRelation(attribute, <span class="built_in">NSLayoutRelationEqual</span>);</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//MASCompositeConstraint.m</span></div><div class="line"></div><div class="line">- (MASConstraint * (^)(<span class="keyword">id</span>, <span class="built_in">NSLayoutRelation</span>))equalToWithRelation &#123;</div><div class="line">    <span class="keyword">return</span> ^<span class="keyword">id</span>(<span class="keyword">id</span> attr, <span class="built_in">NSLayoutRelation</span> relation) &#123;</div><div class="line">        <span class="keyword">for</span> (MASConstraint *constraint <span class="keyword">in</span> <span class="keyword">self</span>.childConstraints.copy) &#123;</div><div class="line">            constraint.equalToWithRelation(attr, relation);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ï¼Œè¿™é‡Œä¼šå¾ªç¯ä¹‹å‰å‡†å¤‡å¥½çš„ç§æœ‰æ•°ç»„ <code>self.childConstraints</code>ï¼Œè°ƒç”¨ <code>MASViewConstraint.m</code> çš„ <code>equalToWithRelation</code> æ–¹æ³•ï¼Œå’Œä¸Šé¢è®²çš„ä¸€æ ·äº†ã€‚</p>
<h5 id="make-edges-equalTo-view"><a href="#make-edges-equalTo-view" class="headerlink" title="make.edges.equalTo(view)"></a>make.edges.equalTo(view)</h5><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ç§å†™æ³•ï¼Œè°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//MASConstraintMaker.m</span></div><div class="line"></div><div class="line">- (MASConstraint *)edges &#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> addConstraintWithAttributes:MASAttributeTop | MASAttributeLeft | MASAttributeRight | MASAttributeBottom];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (MASConstraint *)addConstraintWithAttributes:(MASAttribute)attrs &#123;</div><div class="line">    __unused MASAttribute anyAttribute = (MASAttributeLeft | MASAttributeRight | MASAttributeTop | MASAttributeBottom | MASAttributeLeading</div><div class="line">                                          | MASAttributeTrailing | MASAttributeWidth | MASAttributeHeight | MASAttributeCenterX</div><div class="line">                                          | MASAttributeCenterY | </div><div class="line">                                          </div><div class="line">                    ......</div><div class="line">                        </div><div class="line">    <span class="built_in">NSMutableArray</span> *attributes = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (attrs &amp; MASAttributeLeft) [attributes addObject:<span class="keyword">self</span>.view.mas_left];</div><div class="line">    <span class="keyword">if</span> (attrs &amp; MASAttributeRight) [attributes addObject:<span class="keyword">self</span>.view.mas_right];</div><div class="line">    <span class="keyword">if</span> (attrs &amp; MASAttributeTop) [attributes addObject:<span class="keyword">self</span>.view.mas_top];</div><div class="line">    </div><div class="line">    				......    </div><div class="line">    </div><div class="line">    <span class="built_in">NSMutableArray</span> *children = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:attributes.count];</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (MASViewAttribute *a <span class="keyword">in</span> attributes) &#123;</div><div class="line">        [children addObject:[[MASViewConstraint alloc] initWithFirstViewAttribute:a]];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    MASCompositeConstraint *constraint = [[MASCompositeConstraint alloc] initWithChildren:children];</div><div class="line">    constraint.delegate = <span class="keyword">self</span>;</div><div class="line">    [<span class="keyword">self</span>.constraints addObject:constraint];</div><div class="line">    <span class="keyword">return</span> constraint;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»£ç å¤ªå¤šçœç•¥äº†ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥å‘ç°è¿™æ®µä»£ç ä½œç”¨å°±æ˜¯è¿”å›ä¸€ä¸ªåŒ…å«å¤šæ¡çº¦æŸçš„ <code>MASCompositeConstraint</code> å¯¹è±¡ï¼Œæ¥ç€åé¢çš„æ“ä½œä¹Ÿéƒ½æ˜¯ä¸€æ ·çš„äº†ã€‚</p>
<p>ä¸Šé¢è¿™ç§å†™æ³•è¿˜å¯ä»¥è¿™æ ·ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make.edges.equalTo(<span class="built_in">UIEdgeInsetsMake</span>(<span class="number">0.0</span>f, <span class="number">0.0</span>f, <span class="number">0.0</span>f, <span class="number">0.0</span>f));</div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ <code>equalTo</code> éœ€è¦æ³¨æ„ä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ª<strong>å®</strong>ï¼Œå®šä¹‰åœ¨ <code>MASConstraint.h</code> ä¸­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#define mas_equalTo(...)                 equalTo(MASBoxValue((__VA_ARGS__)))</span></div><div class="line"><span class="meta">#define mas_greaterThanOrEqualTo(...)    greaterThanOrEqualTo(MASBoxValue((__VA_ARGS__)))</span></div><div class="line"><span class="meta">#define mas_lessThanOrEqualTo(...)       lessThanOrEqualTo(MASBoxValue((__VA_ARGS__)))</span></div><div class="line"></div><div class="line"><span class="meta">#define mas_offset(...)                  valueOffset(MASBoxValue((__VA_ARGS__)))</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#ifdef MAS_SHORTHAND_GLOBALS</span></div><div class="line"></div><div class="line"><span class="meta">#define equalTo(...)                     mas_equalTo(__VA_ARGS__)</span></div><div class="line"><span class="meta">#define greaterThanOrEqualTo(...)        mas_greaterThanOrEqualTo(__VA_ARGS__)</span></div><div class="line"><span class="meta">#define lessThanOrEqualTo(...)           mas_lessThanOrEqualTo(__VA_ARGS__)</span></div><div class="line"></div><div class="line"><span class="meta">#define offset(...)                      mas_offset(__VA_ARGS__)</span></div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥ä¿®æ”¹ä¸‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make.edges.equalTo(MASBoxValue(<span class="built_in">UIEdgeInsetsMake</span>(<span class="number">0.0</span>f, <span class="number">0.0</span>f, <span class="number">0.0</span>f, <span class="number">0.0</span>f)));</div></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ï¼Œå…¶å®é‡Œé¢è°ƒç”¨çš„æ˜¯ <code>MASBoxValue</code> è¿™ä¸ªå®ï¼Œå®ƒå°† <code>C</code> å’Œ <code>Objective-C</code> è¯­è¨€ä¸­çš„ä¸€äº›åŸºæœ¬æ•°æ®ç»“æ„æ¯”å¦‚è¯´ <code>double</code> <code>CGPoint</code> <code>CGSize</code> è¿™äº›å€¼ç”¨ <code>NSValue</code> è¿›è¡ŒåŒ…è£…ã€‚</p>
<p>è¿™é‡Œè¿˜æ”¯æŒç›´æ¥è°ƒç”¨ <code>size</code>ã€<code>center</code> ç­‰ï¼Œå…·ä½“å®ç°éƒ½å·®ä¸å¤šï¼Œå°±ä¸ç†¬è¿°äº†ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">make.center.equalTo(<span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">50</span>));</div><div class="line">make.size.equalTo(<span class="built_in">CGSizeMake</span>(<span class="number">200</span>, <span class="number">100</span>));</div></pre></td></tr></table></figure>
<h5 id="make-height-equalTo-redView-blueView"><a href="#make-height-equalTo-redView-blueView" class="headerlink" title="make.height.equalTo(@[redView, blueView])"></a>make.height.equalTo(@[redView, blueView])</h5><p>æˆ‘å†æ¥çœ‹çœ‹è¿™ç§ä¼ æ•°ç»„çš„ï¼Œåœ¨èµ°åˆ° <code>.equalTo</code> æ—¶ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ <code>MASViewConstraint.m</code> é‡Œé¢çš„ <code>equalToWithRelation</code> æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (MASConstraint * (^)(<span class="keyword">id</span>, <span class="built_in">NSLayoutRelation</span>))equalToWithRelation &#123;</div><div class="line">    <span class="keyword">return</span> ^<span class="keyword">id</span>(<span class="keyword">id</span> attribute, <span class="built_in">NSLayoutRelation</span> relation) &#123;</div><div class="line">        <span class="keyword">if</span> ([attribute isKindOfClass:<span class="built_in">NSArray</span>.class]) &#123;</div><div class="line">            <span class="built_in">NSAssert</span>(!<span class="keyword">self</span>.hasLayoutRelation, <span class="string">@"Redefinition of constraint relation"</span>);</div><div class="line">            <span class="built_in">NSMutableArray</span> *children = <span class="built_in">NSMutableArray</span>.new;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">id</span> attr <span class="keyword">in</span> attribute) &#123;</div><div class="line">                MASViewConstraint *viewConstraint = [<span class="keyword">self</span> <span class="keyword">copy</span>];</div><div class="line">                viewConstraint.layoutRelation = relation;</div><div class="line">                viewConstraint.secondViewAttribute = attr;</div><div class="line">                [children addObject:viewConstraint];</div><div class="line">            &#125;</div><div class="line">            MASCompositeConstraint *compositeConstraint = [[MASCompositeConstraint alloc] initWithChildren:children];</div><div class="line">            compositeConstraint.delegate = <span class="keyword">self</span>.delegate;</div><div class="line">            [<span class="keyword">self</span>.delegate constraint:<span class="keyword">self</span> shouldBeReplacedWithConstraint:compositeConstraint];</div><div class="line">            <span class="keyword">return</span> compositeConstraint;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;   ....    &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™è¾¹è¿˜æ˜¯éå†æ•°ç»„ï¼Œå¹¶ä¸” <code>MASViewConstraint</code> å®ç° <code>NSCopying</code> åè®®ï¼Œè°ƒç”¨ <code>[self copy]</code> ä¼šåˆ›å»º <code>MASViewConstraint</code> å¯¹è±¡ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> __unused *)zone &#123;</div><div class="line">    MASViewConstraint *constraint = [[MASViewConstraint alloc] initWithFirstViewAttribute:<span class="keyword">self</span>.firstViewAttribute];</div><div class="line">    constraint.layoutConstant = <span class="keyword">self</span>.layoutConstant;</div><div class="line">    constraint.layoutRelation = <span class="keyword">self</span>.layoutRelation;</div><div class="line">    constraint.layoutPriority = <span class="keyword">self</span>.layoutPriority;</div><div class="line">    constraint.layoutMultiplier = <span class="keyword">self</span>.layoutMultiplier;</div><div class="line">    constraint.delegate = <span class="keyword">self</span>.delegate;</div><div class="line">    <span class="keyword">return</span> constraint;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åä¼šæ ¹æ®ä¼ çš„æ•°ç»„é‡Œé¢çš„ <code>Value</code> ç±»å‹æ¥åšä¸åŒçš„æ“ä½œï¼Œå‰é¢è®²è¿‡å°±ä¸ç†¬è¿°äº†ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setSecondViewAttribute:(<span class="keyword">id</span>)secondViewAttribute &#123;</div><div class="line">    <span class="keyword">if</span> ([secondViewAttribute isKindOfClass:<span class="built_in">NSValue</span>.class]) &#123;</div><div class="line">        [<span class="keyword">self</span> setLayoutConstantWithValue:secondViewAttribute];</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([secondViewAttribute isKindOfClass:MAS_VIEW.class]) &#123;</div><div class="line">        _secondViewAttribute = [[MASViewAttribute alloc] initWithView:secondViewAttribute layoutAttribute:<span class="keyword">self</span>.firstViewAttribute.layoutAttribute];</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([secondViewAttribute isKindOfClass:MASViewAttribute.class]) &#123;</div><div class="line">        _secondViewAttribute = secondViewAttribute;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">NSAssert</span>(<span class="literal">NO</span>, <span class="string">@"attempting to add unsupported attribute: %@"</span>, secondViewAttribute);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€åä¾¿æ˜¯ç”Ÿæˆ <code>MASCompositeConstraint</code> å¯¹è±¡ï¼Œå¹¶é€šè¿‡ <code>delegate</code> æ–¹å¼ï¼Œè°ƒç”¨ <code>MASConstraintMaker</code> çš„æ–¹æ³•ï¼Œæ›¿æ¢ <code>self.constraints</code> æ•°ç»„é‡Œçš„çº¦æŸï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)constraint:(MASConstraint *)constraint shouldBeReplacedWithConstraint:(MASConstraint *)replacementConstraint &#123;</div><div class="line">    <span class="built_in">NSUInteger</span> index = [<span class="keyword">self</span>.constraints indexOfObject:constraint];</div><div class="line">    <span class="built_in">NSAssert</span>(index != <span class="built_in">NSNotFound</span>, <span class="string">@"Could not find constraint %@"</span>, constraint);</div><div class="line">    [<span class="keyword">self</span>.constraints replaceObjectAtIndex:index withObject:replacementConstraint];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="æ·»åŠ çº¦æŸåˆ°è§†å›¾"><a href="#æ·»åŠ çº¦æŸåˆ°è§†å›¾" class="headerlink" title="æ·»åŠ çº¦æŸåˆ°è§†å›¾"></a>æ·»åŠ çº¦æŸåˆ°è§†å›¾</h4><p> <code>mas_makeConstraints</code> æ–¹æ³•çš„æœ€åä¼šè°ƒç”¨ <code>[constraintMaker install]</code> æ–¹æ³•æ¥æ·»åŠ æ‰€æœ‰å­˜å‚¨åœ¨ <code>self.constraints</code> æ•°ç»„ä¸­çš„æ‰€æœ‰çº¦æŸã€‚</p>
 <figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// MASConstraintMaker.m</span></div><div class="line"> </div><div class="line"> - (<span class="built_in">NSArray</span> *)install &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.removeExisting) &#123;</div><div class="line">        <span class="built_in">NSArray</span> *installedConstraints = [MASViewConstraint installedConstraintsForView:<span class="keyword">self</span>.view];</div><div class="line">        <span class="keyword">for</span> (MASConstraint *constraint <span class="keyword">in</span> installedConstraints) &#123;</div><div class="line">            [constraint uninstall];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSArray</span> *constraints = <span class="keyword">self</span>.constraints.copy;</div><div class="line">    <span class="keyword">for</span> (MASConstraint *constraint <span class="keyword">in</span> constraints) &#123;</div><div class="line">        constraint.updateExisting = <span class="keyword">self</span>.updateExisting;</div><div class="line">        [constraint install];</div><div class="line">    &#125;</div><div class="line">    [<span class="keyword">self</span>.constraints removeAllObjects];</div><div class="line">    <span class="keyword">return</span> constraints;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> å¦‚æœéœ€è¦<strong>é‡æ–°æ„å»º</strong>çº¦æŸï¼Œä¹Ÿå°±æ˜¯ è°ƒç”¨ <code>mas_remakeConstraints:</code> æ–¹æ³•ï¼Œä¼šå…ˆå–å‡ºè§†å›¾çš„æ‰€æœ‰çº¦æŸï¼Œç„¶åé€šè¿‡ä¸€ä¸ª <code>for</code> å¾ªç¯ï¼Œè°ƒç”¨ <code>uninstall</code> æ¥æ¸…ç©ºæ‰€æœ‰çº¦æŸï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)uninstall &#123;</div><div class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span> supportsActiveProperty]) &#123;</div><div class="line">        <span class="keyword">self</span>.layoutConstraint.active = <span class="literal">NO</span>;</div><div class="line">        [<span class="keyword">self</span>.firstViewAttribute.view.mas_installedConstraints removeObject:<span class="keyword">self</span>];</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.installedView removeConstraint:<span class="keyword">self</span>.layoutConstraint];</div><div class="line">    <span class="keyword">self</span>.layoutConstraint = <span class="literal">nil</span>;</div><div class="line">    <span class="keyword">self</span>.installedView = <span class="literal">nil</span>;</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.firstViewAttribute.view.mas_installedConstraints removeObject:<span class="keyword">self</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœä¸éœ€è¦<strong>é‡æ–°æ„å»º</strong>çº¦æŸï¼Œä¼šå–å‡º <code>self.constraints</code> æ•°ç»„ä¸­å‡†å¤‡å¥½çš„çº¦æŸï¼Œé€šè¿‡ <code>for</code> å¾ªç¯ï¼Œè°ƒç”¨ <code>install</code> æ¥æŠŠçº¦æŸæ·»åŠ åˆ°è§†å›¾ä¸Šï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.hasBeenInstalled) &#123;</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœçº¦æŸä»¥åŠå­˜åœ¨å¹¶æ˜¯ <code>active</code> ä¼šç›´æ¥è¿”å›ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ([<span class="keyword">self</span> supportsActiveProperty] &amp;&amp; <span class="keyword">self</span>.layoutConstraint) &#123;</div><div class="line">     <span class="keyword">self</span>.layoutConstraint.active = <span class="literal">YES</span>;</div><div class="line">     [<span class="keyword">self</span>.firstViewAttribute.view.mas_installedConstraints addObject:<span class="keyword">self</span>];</div><div class="line">     <span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœ <code>self.layoutConstraint</code> å“åº”äº† <code>isActive</code> æ–¹æ³•å¹¶ä¸”ä¸ä¸ºç©ºï¼Œä¼šæ¿€æ´»è¿™æ¡çº¦æŸå¹¶æ·»åŠ åˆ° <code>mas_installedConstraints</code> æ•°ç»„ä¸­ï¼Œæœ€åè¿”å›ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MAS_VIEW *firstLayoutItem = <span class="keyword">self</span>.firstViewAttribute.item;</div><div class="line"><span class="built_in">NSLayoutAttribute</span> firstLayoutAttribute = <span class="keyword">self</span>.firstViewAttribute.layoutAttribute;</div><div class="line">MAS_VIEW *secondLayoutItem = <span class="keyword">self</span>.secondViewAttribute.item;</div><div class="line"><span class="built_in">NSLayoutAttribute</span> secondLayoutAttribute = <span class="keyword">self</span>.secondViewAttribute.layoutAttribute;</div></pre></td></tr></table></figure>
<p>è¿™è¾¹æ˜¯è·å–å³å°†ç”¨äºåˆå§‹åŒ– <code>NSLayoutConstraint</code> çš„å­ç±» <code>MASLayoutConstraint</code> çš„å‡ ä¸ªå±æ€§ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (!<span class="keyword">self</span>.firstViewAttribute.isSizeAttribute &amp;&amp; !<span class="keyword">self</span>.secondViewAttribute) &#123;</div><div class="line">     secondLayoutItem = <span class="keyword">self</span>.firstViewAttribute.view.superview;</div><div class="line">     secondLayoutAttribute = firstLayoutAttribute;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™è¾¹æ˜¯åˆ¤æ–­å½“å‰å³å°†æ·»åŠ çš„çº¦æŸæ˜¯å¦æ˜¯ <code>size</code> ç±»å‹çš„å¹¶ä¸” <code>self.secondViewAttribute</code> ä¹Ÿå°±æ˜¯çº¦æŸçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ <code>nil</code>ï¼Œï¼ˆ<code>eg make.left.equalTo(@10)</code>ï¼‰ä¼šè‡ªåŠ¨å°†çº¦æŸæ·»åŠ åˆ°çº¦æŸçš„ç¬¬ä¸€ä¸ªå‚æ•°è§†å›¾çš„ <code>superview</code> ä¸Šã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">MASLayoutConstraint *layoutConstraint = [MASLayoutConstraint</div><div class="line">                                 constraintWithItem:firstLayoutItem</div><div class="line">                                        attribute:firstLayoutAttribute</div><div class="line">                                        relatedBy:<span class="keyword">self</span>.layoutRelation</div><div class="line">                                           toItem:secondLayoutItem</div><div class="line">                                        attribute:secondLayoutAttribute</div><div class="line">                                       multiplier:<span class="keyword">self</span>.layoutMultiplier</div><div class="line">                                         constant:<span class="keyword">self</span>.layoutConstant];</div><div class="line">    </div><div class="line">layoutConstraint.priority = <span class="keyword">self</span>.layoutPriority;</div><div class="line">layoutConstraint.mas_key = <span class="keyword">self</span>.mas_key;</div></pre></td></tr></table></figure>
<p>ç„¶åå°±ä¼šåˆå§‹åŒ– <code>NSLayoutConstraint</code> çš„å­ç±» <code>MASLayoutConstraint</code>ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.secondViewAttribute.view) &#123;</div><div class="line">    MAS_VIEW *closestCommonSuperview = [<span class="keyword">self</span>.firstViewAttribute.view mas_closestCommonSuperview:<span class="keyword">self</span>.secondViewAttribute.view];</div><div class="line">    <span class="built_in">NSAssert</span>(closestCommonSuperview,</div><div class="line">                 <span class="string">@"couldn't find a common superview for %@ and %@"</span>,</div><div class="line">                 <span class="keyword">self</span>.firstViewAttribute.view, <span class="keyword">self</span>.secondViewAttribute.view);</div><div class="line">    <span class="keyword">self</span>.installedView = closestCommonSuperview;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span>.firstViewAttribute.isSizeAttribute) &#123;</div><div class="line">    <span class="keyword">self</span>.installedView = <span class="keyword">self</span>.firstViewAttribute.view;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">self</span>.installedView = <span class="keyword">self</span>.firstViewAttribute.view.superview;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç ä¼šå…ˆåˆ¤æ–­æ˜¯å¦æœ‰çº¦æŸç¬¬äºŒä¸ªå‚æ•°çš„è§†å›¾ï¼Œæœ‰çš„è¯ä¼šå¯»æ‰¾çº¦æŸç¬¬ä¸€ä¸ªå’Œç¬¬äºŒå‚æ•°è§†å›¾çš„å…¬å…± <code>Superview</code>ï¼Œç›¸å½“äºæ±‚ä¸¤ä¸ªæ•°çš„æœ€å°å…¬å€æ•°ï¼›å¦‚æœä¸æ»¡è¶³ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œä¼šåˆ¤æ–­çº¦æŸç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦æ˜¯ <code>size</code> ç±»å‹çš„ï¼Œæ˜¯çš„è¯ç›´æ¥å–åˆ°å®ƒçš„è§†å›¾ï¼›æœ€åéƒ½ä¸æ»¡è¶³ä¼šç›´æ¥å–åˆ°çº¦æŸç¬¬ä¸€ä¸ªå‚æ•°è§†å›¾çˆ¶è§†å›¾ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">MASLayoutConstraint *existingConstraint = <span class="literal">nil</span>;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.updateExisting) &#123;</div><div class="line">    existingConstraint = [<span class="keyword">self</span> layoutConstraintSimilarTo:layoutConstraint];</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (existingConstraint) &#123;</div><div class="line">   <span class="comment">// just update the constant</span></div><div class="line">    existingConstraint.constant = layoutConstraint.constant;</div><div class="line">    <span class="keyword">self</span>.layoutConstraint = existingConstraint;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    [<span class="keyword">self</span>.installedView addConstraint:layoutConstraint];</div><div class="line">    <span class="keyword">self</span>.layoutConstraint = layoutConstraint;</div><div class="line">    [firstLayoutItem.mas_installedConstraints addObject:<span class="keyword">self</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœéœ€è¦å‡çº§å½“å‰çš„çº¦æŸå°±ä¼šè·å–åŸæœ‰çš„çº¦æŸï¼Œå¹¶æ›¿æ¢ä¸ºæ–°çš„çº¦æŸï¼Œè¿™æ ·å°±ä¸éœ€è¦å†æ¬¡ä¸º <code>view</code> å®‰è£…çº¦æŸã€‚å¦‚æœåŸæ¥çš„ <code>view</code> ä¸­ä¸å­˜åœ¨å¯ä»¥å‡çº§çš„çº¦æŸï¼Œé‚£ä¹ˆå°±ä¼šåœ¨ä¸Šä¸€æ­¥å¯»æ‰¾åˆ°çš„ <code>installedView</code> ä¸Šé¢æ·»åŠ çº¦æŸã€‚</p>
<h4 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h4><p>é˜…è¯»æ‡‚æºç çœŸæ˜¯ä¸€ä»¶å¾ˆçˆ½çš„äº‹æƒ…ï¼Œå¦‚æœæœ‰ä»€ä¹ˆç†è§£çš„ä¸åˆ°ä½çš„åœ°æ–¹å¤§å®¶å¤šå¤šæŒ‡æ­£ã€‚ä¹Ÿå¸Œæœ›å¤§å®¶èƒ½å¤Ÿè€å¿ƒçš„çœ‹ä¸‹å»ï¼Œä¸€å®šä¼šæœ‰æ‰€æ”¶è·çš„ã€‚</p>
<p>å‚è€ƒé“¾æ¥</p>
<p><a href="http://www.cnblogs.com/ludashi/p/5591572.html" target="_blank" rel="external">http://www.cnblogs.com/ludashi/p/5591572.html</a></p>
<p><a href="https://github.com/Draveness/iOS-Source-Code-Analyze/blob/master/contents/Masonry/iOS%20%E6%BA%90%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%20---%20Masonry.md" target="_blank" rel="external">https://github.com/Draveness/iOS-Source-Code-Analyze/blob/master/contents/Masonry/iOS%20%E6%BA%90%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%20â€”%20Masonry.md</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://github.com/SnapKit/Masonry&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Masonry&lt;/a&gt; æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ç”¨äºè‡ªåŠ¨å¸ƒå±€ï¼ˆAutoLayoutï¼‰çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œä»¥å…¶ç®€æ´çš„ä½¿ç”¨æ–¹å¼ï¼Œå—åˆ°å¹¿å¤§å¼€å‘è€…
    
    </summary>
    
    
      <category term="ObjC" scheme="http://yoursite.com/tags/ObjC/"/>
    
      <category term="æºç è§£æ" scheme="http://yoursite.com/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>æµ…è°ˆ Method Swizzling</title>
    <link href="http://yoursite.com/2017/01/25/Method-Swizzling/"/>
    <id>http://yoursite.com/2017/01/25/Method-Swizzling/</id>
    <published>2017-01-25T13:28:02.000Z</published>
    <updated>2018-02-13T09:04:20.161Z</updated>
    
    <content type="html"><![CDATA[<p>å¦‚æœå¯¹ Runtime æœ‰ä¸€å®šäº†è§£çš„è¯ï¼Œä¸€å®šå¬è¯´è¿‡æˆ–è€…ç”¨è¿‡è¿™ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">OBJC_EXPORT <span class="keyword">void</span> method_exchangeImplementations(Method m1, Method m2)</div></pre></td></tr></table></figure>
<p>å®ƒé€šå¸¸å«åš Method Swizzlingï¼Œç®—æ˜¯<code>objc</code>çš„ â€œé»‘é­”æ³•â€ äº†ï¼Œä½œç”¨å°±æ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´åŠ¨æ€çš„ç»™ä¸¤ä¸ªæ–¹æ³•äº’æ¢å®ç°ã€‚</p>
<p>æœ€è¿‘æœ‰ç”¨åˆ°è¿™ä¸ªï¼Œæ€»ç»“ä¸‹é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼š</p>
<h4 id="é™æ€ï¼ˆç±»ï¼‰æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•çš„äº¤æ¢å®ç°æ–¹å¼ä¸€æ ·å—ï¼Ÿ"><a href="#é™æ€ï¼ˆç±»ï¼‰æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•çš„äº¤æ¢å®ç°æ–¹å¼ä¸€æ ·å—ï¼Ÿ" class="headerlink" title="é™æ€ï¼ˆç±»ï¼‰æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•çš„äº¤æ¢å®ç°æ–¹å¼ä¸€æ ·å—ï¼Ÿ"></a>é™æ€ï¼ˆç±»ï¼‰æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•çš„äº¤æ¢å®ç°æ–¹å¼ä¸€æ ·å—ï¼Ÿ</h4><p>äº¤æ¢é™æ€ï¼ˆç±»ï¼‰æ–¹æ³•çš„æ­£ç¡®å§¿åŠ¿ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">void</span>)load &#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        SEL s1 = <span class="keyword">@selector</span>(go);</div><div class="line">        SEL s2 = <span class="keyword">@selector</span>(stop);</div><div class="line">        Class <span class="keyword">class</span> = object_getClass((<span class="keyword">id</span>)<span class="keyword">self</span>);</div><div class="line">        Method m1 = class_getClassMethod(<span class="keyword">class</span>, s1);</div><div class="line">        Method m2 = class_getClassMethod(<span class="keyword">class</span>, s2);</div><div class="line">        <span class="built_in">BOOL</span> success = class_addMethod(<span class="keyword">class</span>, s1, method_getImplementation(m2), method_getTypeEncoding(m2));</div><div class="line">        <span class="keyword">if</span> (success)&#123;</div><div class="line">            class_replaceMethod(<span class="keyword">class</span>, s2, method_getImplementation(m1), method_getTypeEncoding(m1));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            method_exchangeImplementations(m1, m2);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)go &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Go!"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)stop &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Stop!"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>äº¤æ¢å®ä¾‹æ–¹æ³•çš„æ­£ç¡®å§¿åŠ¿ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">void</span>)load &#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        SEL s1 = <span class="keyword">@selector</span>(go);</div><div class="line">        SEL s2 = <span class="keyword">@selector</span>(stop);</div><div class="line">        Class <span class="keyword">class</span> = [<span class="keyword">self</span> <span class="keyword">class</span>];</div><div class="line">        Method m1 = class_getInstanceMethod(<span class="keyword">class</span>, s1);</div><div class="line">        Method m2 = class_getInstanceMethod(<span class="keyword">class</span>, s2);</div><div class="line">        <span class="built_in">BOOL</span> success = class_addMethod(<span class="keyword">class</span>, s1, method_getImplementation(m2), method_getTypeEncoding(m2));</div><div class="line">        <span class="keyword">if</span> (success)&#123;</div><div class="line">            class_replaceMethod(<span class="keyword">class</span>, s2, method_getImplementation(m1), method_getTypeEncoding(m1));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            method_exchangeImplementations(m1, m2);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)go &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Go!"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)stop &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Stop!"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ä¸Šé¢ä¸¤æ®µæ–¹æ³•çš„åŒºåˆ«åœ¨äºï¼š</p>
<p>é™æ€ï¼ˆç±»ï¼‰æ–¹æ³•çš„<code>Class</code>å’Œ<code>Method</code>æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Class <span class="keyword">class</span> = object_getClass((<span class="keyword">id</span>)<span class="keyword">self</span>);</div><div class="line">Method m1 = class_getClassMethod(<span class="keyword">class</span>, s1);</div><div class="line">Method m2 = class_getClassMethod(<span class="keyword">class</span>, s2);</div></pre></td></tr></table></figure>
<p>å®ä¾‹æ–¹æ³•çš„<code>Class</code>å’Œ<code>Method</code>æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Class <span class="keyword">class</span> = [<span class="keyword">self</span> <span class="keyword">class</span>];</div><div class="line">Method m1 = class_getInstanceMethod(<span class="keyword">class</span>, s1);</div><div class="line">Method m2 = class_getInstanceMethod(<span class="keyword">class</span>, s2);</div></pre></td></tr></table></figure>
<p>Runtime ä¸­<code>class_getClassMethod</code>çš„å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Method class_getClassMethod(Class cls, SEL sel)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (!cls  ||  !sel) <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> class_getInstanceMethod(cls-&gt;getMeta(), sel);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¤§å®¶å¯ä»¥ä¸‹è½½ <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank" rel="external">Runtime æºç </a> çœ‹çœ‹ã€‚</p>
<p>å…¶å®<code>class_getClassMethod</code>å†…å°±æ˜¯è°ƒäº†ä¸‹<code>class_getInstanceMethod</code>ï¼Œåªæ˜¯ä¼ çš„<code>Class</code>å‚æ•°ä¸ä¸€æ ·ï¼š</p>
<ul>
<li><code>class_getClassMethod</code> ä¸­<code>Class</code>å‚æ•°ä¼ çš„æ˜¯å…ƒç±»ï¼Œä¹Ÿå°±æ˜¯ç±»å¯¹è±¡çš„ç±»ã€‚ï¼ˆå…³äºå…ƒç±»å¤§å®¶å¯ä»¥çœ‹çœ‹è¿™ç¯‡ç¿»è¯‘çš„æ–‡ç«  <a href="http://ios.jobbole.com/81657/" target="_blank" rel="external">Objective-C ä¸­çš„å…ƒç±»ï¼ˆmeta classï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</a>ï¼‰</li>
<li><code>class_getInstanceMethod</code>ä¸­<code>Class</code> å‚æ•°çœ‹åå­—å°±å¯ä»¥ç†è§£ï¼Œæ—¢ç„¶æ˜¯è·å¾—å®ä¾‹æ–¹æ³•ï¼Œè‡ªç„¶ä¼ çš„å°±æ˜¯å®ä¾‹å¯¹è±¡çš„ç±»ã€‚</li>
</ul>
<p>é‚£ <code>object_getClass(id obj)</code> åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿˜æ˜¯çœ‹æºç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Class object_getClass(<span class="keyword">id</span> obj)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (obj) <span class="keyword">return</span> obj-&gt;getIsa();</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> Nil;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>object_getClass()</code> å°±æ˜¯é¡ºç€ isa çš„æŒ‡å‘é“¾æ‰¾åˆ°å¯¹åº”çš„ç±»ã€‚</p>
<p>æœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="http://ios.jobbole.com/91962/" target="_blank" rel="external">ä¸ºä»€ä¹ˆ object_getClass(obj) ä¸ [OBJ class] è¿”å›çš„æŒ‡é’ˆä¸åŒ</a></p>
<h4 id="é™æ€ï¼ˆç±»ï¼‰æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•é‡Œé¢çš„-self-è¡¨ç¤ºçš„å«ä¹‰ä¸€æ ·å—ï¼Ÿ"><a href="#é™æ€ï¼ˆç±»ï¼‰æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•é‡Œé¢çš„-self-è¡¨ç¤ºçš„å«ä¹‰ä¸€æ ·å—ï¼Ÿ" class="headerlink" title="é™æ€ï¼ˆç±»ï¼‰æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•é‡Œé¢çš„ self è¡¨ç¤ºçš„å«ä¹‰ä¸€æ ·å—ï¼Ÿ"></a>é™æ€ï¼ˆç±»ï¼‰æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•é‡Œé¢çš„ self è¡¨ç¤ºçš„å«ä¹‰ä¸€æ ·å—ï¼Ÿ</h4><p>å…ˆè¯´æ˜ä¸‹ä¸ºä»€ä¹ˆæˆ‘ä¼šçªç„¶æœ‰è¿™ä¸ªç–‘é—®ï¼š</p>
<p>å½“åˆä¸ºäº†æ–¹ä¾¿æµ‹è¯•äº¤æ¢ä¸¤ä¸ªé™æ€æ–¹æ³•çš„å®ç°ï¼Œæˆ‘ç›´æ¥æ’¸äº†è¿™ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        SEL s1 = <span class="keyword">@selector</span>(test1);</div><div class="line">        SEL s2 = <span class="keyword">@selector</span>(test2);</div><div class="line">        Class <span class="keyword">class</span> = object_getClass((<span class="keyword">id</span>)<span class="keyword">self</span>);</div><div class="line">        Method m1 = class_getClassMethod(<span class="keyword">class</span>, s1);</div><div class="line">        Method m2 = class_getClassMethod(<span class="keyword">class</span>, s2);</div><div class="line">        <span class="built_in">BOOL</span> success = class_addMethod(<span class="keyword">class</span>, s1, method_getImplementation(m2), method_getTypeEncoding(m2));</div><div class="line">        <span class="keyword">if</span> (success)&#123;</div><div class="line">            class_replaceMethod(<span class="keyword">class</span>, s2, method_getImplementation(m1), method_getTypeEncoding(m1));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            method_exchangeImplementations(m1, m2);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    [ViewController test1];</div><div class="line">    [ViewController test2];</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)test1 &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"test1"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)test2 &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"test2"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2017-01-25 17:13:53.356 RuntimeDemo[16180:4689887] test1</div><div class="line">2017-01-25 17:13:53.356 RuntimeDemo[16180:4689887] test2</div></pre></td></tr></table></figure>
<p>å±…ç„¶äº¤æ¢å¤±è´¥äº†ï¼</p>
<p>ç„¶åæˆ‘å°è¯•ç€æŠŠä»£ç æŒªåˆ° <code>+ (void)load{}</code> é‡Œé¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">+ (void)load &#123;</div><div class="line">    static dispatch_once_t onceToken;</div><div class="line">    dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">        SEL s1 = @selector(test1);</div><div class="line">        SEL s2 = @selector(test2);</div><div class="line">        Class class = object_getClass((id)self);</div><div class="line">        Method m1 = class_getClassMethod(class, s1);</div><div class="line">        Method m2 = class_getClassMethod(class, s2);</div><div class="line">        BOOL success = class_addMethod(class, s1, method_getImplementation(m2), method_getTypeEncoding(m2));</div><div class="line">        if (success)&#123;</div><div class="line">            class_replaceMethod(class, s2, method_getImplementation(m1), method_getTypeEncoding(m1));</div><div class="line">        &#125;</div><div class="line">        else&#123;</div><div class="line">            method_exchangeImplementations(m1, m2);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line"></div><div class="line">    [ViewController test1];</div><div class="line">    [ViewController test2];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2017-01-25 17:23:32.739 RuntimeDemo[16212:4705811] test2</div><div class="line">2017-01-25 17:23:32.739 RuntimeDemo[16212:4705811] test1</div></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°äº¤æ¢æˆåŠŸäº†ï¼</p>
<p>åœ¨æ‰¾åŸå› ä¹‹å‰æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€å¼ ç»å…¸çš„å›¾ï¼š</p>
<p><img src="/images/011.png" alt=""></p>
<p>ä»å·¦åˆ°å³ä¾æ¬¡æ˜¯ï¼šå®ä¾‹å¯¹è±¡ã€ç±»å¯¹è±¡ã€å…ƒç±»ï¼ˆç±»å¯¹è±¡çš„ç±»ï¼‰ã€‚</p>
<p>æˆ‘ä»¬é€šå¸¸è¿™æ ·æ¥è·å–è¿™ä¸‰ä¸ªå¯¹è±¡ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Person *obj = [Person new];</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"instance         :%p"</span>, obj);</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"class            :%p"</span>, object_getClass(obj));</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"meta class       :%p"</span>, object_getClass(object_getClass(obj)));</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥å¤§èƒ†çŒœæƒ³ä¸‹ï¼š<strong>åœ¨å®ä¾‹æ–¹æ³•ä¸­ï¼Œ<code>self</code>è¡¨ç¤ºçš„æ˜¯å®ä¾‹å¯¹è±¡è¿™ä¸ªå¤§å®¶éƒ½çŸ¥é“ï¼Œé‚£åœ¨ç±»ï¼ˆé™æ€ï¼‰æ–¹æ³•ä¸­<code>self</code>è¡¨ç¤ºçš„æ˜¯ä¸æ˜¯å°±æ˜¯å®ä¾‹å¯¹è±¡çš„ç±»ï¼Œä¹Ÿå°±æ˜¯ç±»å¯¹è±¡å‘¢ï¼Ÿ</strong>æˆ‘ä»¬ç›´æ¥æ’¸ä»£ç æ¥éªŒè¯ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> test1];</div><div class="line">    [ViewController test2];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)test1 &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%p"</span>,<span class="keyword">self</span>);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%p"</span>,object_getClass((<span class="keyword">id</span>)<span class="keyword">self</span>));</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)test2 &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%p"</span>,<span class="keyword">self</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2017-01-25 22:54:37.325 RuntimeDemo[3841:159827] 0x7ff6ee50ac00</div><div class="line">2017-01-25 22:54:38.752 RuntimeDemo[3841:159827] 0x100ec0fe0</div><div class="line">2017-01-25 22:54:42.740 RuntimeDemo[3841:159827] 0x100ec0fe0</div></pre></td></tr></table></figure>
<p>æœç„¶ä¸å‡ºæ‰€æ–™ï¼Œæˆ‘ä»¬çš„å¤§èƒ†çŒœæƒ³æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>å›è¿‡å¤´ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸‹å®ä¾‹æ–¹æ³•ä¸­äº¤æ¢çš„å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">       	Â·Â·Â·Â·</div><div class="line">       	</div><div class="line">       	Class <span class="keyword">class</span> = object_getClass(object_getClass((<span class="keyword">id</span>)<span class="keyword">self</span>));</div><div class="line">      </div><div class="line">      	Â·Â·Â·Â·</div><div class="line">       &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    [ViewController test1];</div><div class="line">    [ViewController test2];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœä¹Ÿè‡ªç„¶è€Œç„¶çš„äº¤æ¢æˆåŠŸäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2017-01-25 23:02:12.579 RuntimeDemo[3926:164600] test2</div><div class="line">2017-01-25 23:02:12.580 RuntimeDemo[3926:164600] test1</div></pre></td></tr></table></figure>
<h4 id="ç½‘ä¸Šçš„-Method-Swizzling-æœ‰ä¸¤ç§å†™æ³•ï¼Œåˆ°åº•å“ªç§é è°±ï¼Ÿ"><a href="#ç½‘ä¸Šçš„-Method-Swizzling-æœ‰ä¸¤ç§å†™æ³•ï¼Œåˆ°åº•å“ªç§é è°±ï¼Ÿ" class="headerlink" title="ç½‘ä¸Šçš„ Method Swizzling æœ‰ä¸¤ç§å†™æ³•ï¼Œåˆ°åº•å“ªç§é è°±ï¼Ÿ"></a>ç½‘ä¸Šçš„ Method Swizzling æœ‰ä¸¤ç§å†™æ³•ï¼Œåˆ°åº•å“ªç§é è°±ï¼Ÿ</h4><p>ä¸¤ç§å†™æ³•åˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">void</span>)load &#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        SEL s1 = <span class="keyword">@selector</span>(go);</div><div class="line">        SEL s2 = <span class="keyword">@selector</span>(stop);</div><div class="line">        Class <span class="keyword">class</span> = object_getClass((<span class="keyword">id</span>)<span class="keyword">self</span>);</div><div class="line">        Method m1 = class_getClassMethod(<span class="keyword">class</span>, s1);</div><div class="line">        Method m2 = class_getClassMethod(<span class="keyword">class</span>, s2);</div><div class="line">        <span class="built_in">BOOL</span> success = class_addMethod(<span class="keyword">class</span>, s1, method_getImplementation(m2), method_getTypeEncoding(m2));</div><div class="line">        <span class="keyword">if</span> (success)&#123;</div><div class="line">            class_replaceMethod(<span class="keyword">class</span>, s2, method_getImplementation(m1), method_getTypeEncoding(m1));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            method_exchangeImplementations(m1, m2);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">void</span>)load &#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        SEL s1 = <span class="keyword">@selector</span>(go);</div><div class="line">        SEL s2 = <span class="keyword">@selector</span>(stop);</div><div class="line">        Class <span class="keyword">class</span> = object_getClass((<span class="keyword">id</span>)<span class="keyword">self</span>);</div><div class="line">        Method m1 = class_getClassMethod(<span class="keyword">class</span>, s1);</div><div class="line">        Method m2 = class_getClassMethod(<span class="keyword">class</span>, s2);</div><div class="line">        method_exchangeImplementations(m1, m2);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ç§å¤šäº†ä¸ªåˆ¤æ–­ï¼Œç¬¬äºŒç§æ˜¯ç›´æ¥äº¤æ¢ã€‚</p>
<p>æ–‡ç« ä¸€å¼€å§‹ä¹Ÿè¯´äº†ï¼Œç¬¬ä¸€ç§æ˜¯æ¯”è¾ƒä¸¥è°¨çš„å†™æ³•ï¼›è€Œç¬¬äºŒç§ï¼Œ<strong>å½“æˆ‘ä»¬æƒ³äº¤æ¢æœ‰å¤šä¸ªç»§æ‰¿å…³ç³»çš„å­ç±»é‡Œé¢çš„æ–¹æ³•å¹¶ä¸”å­ç±»æ²¡æœ‰å®ç°çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œç›´æ¥<code>method_exchangeImplementations</code>ä¼šæŠŠçˆ¶ç±»çš„æ–¹æ³•ä¹Ÿç»™äº¤æ¢äº†</strong>ï¼Œä¸€èˆ¬è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œä¸‹é¢æˆ‘ä»¬ç›´æ¥æ’¸ä»£ç æ¥éªŒè¯ä¸‹ï¼š</p>
<p>çˆ¶ç±» Person</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">.h</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="comment">//é™æ€(ç±») æ–¹æ³•</span></div><div class="line">+ (<span class="keyword">void</span>)go;</div><div class="line">+ (<span class="keyword">void</span>)stop;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line">.m</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)go &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Go!"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)stop &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Stop!"</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>å­ç±» Programmer</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">.h</div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Programmer</span> : <span class="title">Person</span></span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line">.m</div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"Programmer.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Programmer</span></span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)load &#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        SEL s1 = <span class="keyword">@selector</span>(go);</div><div class="line">        SEL s2 = <span class="keyword">@selector</span>(stop);</div><div class="line">        Class <span class="keyword">class</span> = object_getClass((<span class="keyword">id</span>)<span class="keyword">self</span>);</div><div class="line">        Method m1 = class_getClassMethod(<span class="keyword">class</span>, s1);</div><div class="line">        Method m2 = class_getClassMethod(<span class="keyword">class</span>, s2);</div><div class="line">        method_exchangeImplementations(m1, m2);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//+ (void)go &#123;</span></div><div class="line"><span class="comment">//    NSLog(@"Programmer - go");</span></div><div class="line"><span class="comment">//&#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//+ (void)stop &#123;</span></div><div class="line"><span class="comment">//    NSLog(@"Programmer - stop");</span></div><div class="line"><span class="comment">//&#125;</span></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>è°ƒç”¨</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    [Person go];</div><div class="line">    [Person stop];</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---------"</span>);</div><div class="line">    [Programmer go];</div><div class="line">    [Programmer stop];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åªå®ç°çˆ¶ç±»çš„ <code>go</code> å’Œ <code>stop</code> è¿™ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œæ‰“å°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">2017-01-25 23:30:12.850 RuntimeDemo[4180:180408] Stop!</div><div class="line">2017-01-25 23:30:12.851 RuntimeDemo[4180:180408] Go!</div><div class="line">2017-01-25 23:30:12.851 RuntimeDemo[4180:180408] ---------</div><div class="line">2017-01-25 23:30:12.851 RuntimeDemo[4180:180408] Stop!</div><div class="line">2017-01-25 23:30:12.852 RuntimeDemo[4180:180408] Go!</div></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ï¼Œ<strong>å­ç±»<code>Programmer</code>æ²¡æœ‰å®ç°çˆ¶ç±»çš„æ–¹æ³•ç›´æ¥äº¤æ¢æ—¶ï¼Œ çˆ¶ç±»<code>Person</code>çš„æ–¹æ³•ä¹Ÿè¢«äº¤æ¢äº†ï¼</strong></p>
<p>æˆ‘ä»¬æ¥ç€æ‰“å¼€å­ç±»çš„ <code>go</code> å’Œ <code>stop</code> è¿™ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œæ‰“å°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">2017-01-25 23:32:22.953 RuntimeDemo[4215:181987] Go!</div><div class="line">2017-01-25 23:32:22.954 RuntimeDemo[4215:181987] Stop!</div><div class="line">2017-01-25 23:32:22.956 RuntimeDemo[4215:181987] ---------</div><div class="line">2017-01-25 23:32:22.956 RuntimeDemo[4215:181987] Programmer - stop</div><div class="line">2017-01-25 23:32:22.956 RuntimeDemo[4215:181987] Programmer - go</div></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ï¼Œ<strong>å­ç±»å®ç°äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œç›´æ¥äº¤æ¢ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼</strong></p>
<p>æˆ‘ä»¬åŠ ä¸Šåˆ¤æ–­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">+ (void)load &#123;</div><div class="line">    static dispatch_once_t onceToken;</div><div class="line">    dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">        ...</div><div class="line">        </div><div class="line">        BOOL success =  class_addMethod(class, s1, method_getImplementation(m2), method_getTypeEncoding(m2));</div><div class="line">        if (success)&#123;</div><div class="line">            class_replaceMethod(class, s2, method_getImplementation(m1), method_getTypeEncoding(m1));</div><div class="line">        &#125;else&#123;</div><div class="line">            method_exchangeImplementations(m1, m2);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        ...</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æŠŠä¸Šé¢ä¸¤ç§æƒ…å†µåœ¨è¯•éªŒä¸‹ï¼Œå¯ä»¥å‘ç°<strong>äº¤æ¢çš„ä»…ä»…æ˜¯å­ç±»<code>Programmer</code>çš„æ–¹æ³•ï¼Œçˆ¶ç±»<code>Person</code>æ˜¯æ²¡æœ‰è¢«äº¤æ¢çš„ï¼</strong>å¤§å®¶å¯ä»¥è‡ªå·±å°è¯•ä¸‹ã€‚</p>
<p>ç¨ç¨çš„è§£é‡Šä¸‹ï¼š</p>
<p><code>class_addMethod</code>å‡½æ•°ä¼šæ£€æŸ¥æ–¹æ³•æœ‰æ²¡æœ‰å®ç°ï¼Œå¦‚æœå·²ç»å®ç°ä¼šè¿”å› NO ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥èµ°<code>method_exchangeImplementations</code>æ–¹æ³•ï¼›æ²¡æœ‰å®ç°ä¼šå…ˆåœ¨å½“å‰ç±»å¢åŠ ä¸€ä¸ªæ–°çš„å®ç°æ–¹æ³•ï¼Œå†æŠŠç›®æ ‡ç±»ä¸­çš„æ–¹æ³•é€šè¿‡<code>class_replaceMethod</code>å‡½æ•°æ›¿æ¢ä¸ºæ—§æœ‰çš„å®ç°ï¼›</p>
<h4 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h4><p>ä»¥ä¸Šå°±æ˜¯æˆ‘é‡åˆ°çš„é—®é¢˜ï¼Œå¸Œæœ›å¯¹å¤§å®¶èƒ½æœ‰ç‚¹å¸®åŠ©ã€‚æœ€åä¹Ÿå¸Œæœ›å¤§å®¶èƒ½å¤Ÿäº²è‡ªåŠ¨æ‰‹æ•²ä¸€éï¼ŒåŠ æ·±ä¸‹å°è±¡ã€‚</p>
<p>å‚è€ƒé“¾æ¥</p>
<p><a href="http://ios.jobbole.com/91962/" target="_blank" rel="external">http://ios.jobbole.com/91962/</a></p>
<p><a href="http://ios.jobbole.com/81657/" target="_blank" rel="external">http://ios.jobbole.com/81657/</a></p>
<p><a href="http://blog.csdn.net/horkychen/article/details/8532087" target="_blank" rel="external">http://blog.csdn.net/horkychen/article/details/8532087</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¦‚æœå¯¹ Runtime æœ‰ä¸€å®šäº†è§£çš„è¯ï¼Œä¸€å®šå¬è¯´è¿‡æˆ–è€…ç”¨è¿‡è¿™ä¸ªå‡½æ•°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;
    
    </summary>
    
    
      <category term="ObjC" scheme="http://yoursite.com/tags/ObjC/"/>
    
      <category term="runtime" scheme="http://yoursite.com/tags/runtime/"/>
    
  </entry>
  
  <entry>
    <title>My title</title>
    <link href="http://yoursite.com/2017/01/02/Xcode-VC-Template/"/>
    <id>http://yoursite.com/2017/01/02/Xcode-VC-Template/</id>
    <published>2017-01-02T11:46:23.000Z</published>
    <updated>2018-02-13T09:03:36.241Z</updated>
    
    <content type="html"><![CDATA[<p>è¯ä¸å¤šè¯´æˆ‘ä»¬å…ˆæ¥ä½“éªŒä¸‹ :</p>
<p><img src="/images/VC.gif" alt=""></p>
<h3 id="ä»€ä¹ˆæ˜¯-Xcode-ç±»æ¨¡æ¿-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Xcode-ç±»æ¨¡æ¿-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Xcode ç±»æ¨¡æ¿ ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Xcode ç±»æ¨¡æ¿ ï¼Ÿ</h3><p>è¯´åˆ° Xcode ç±»æ¨¡æ¿æœ‰äº›äººå¯èƒ½è§‰å¾—é™Œç”Ÿï¼Œå…¶å®ä½œä¸ºä¸€å iOS å¼€å‘ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½ä¼šç”¨åˆ° Xcode ç±»æ¨¡æ¿ï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ª UIViewControllerï¼Œä¸€ä¸ª Category ç­‰ç­‰ï¼Œè¿™äº›å…¶å®éƒ½æ˜¯ Xcode å¸®æˆ‘ä»¬é›†æˆå¥½çš„æ¨¡æ¿ã€‚</p>
<p><a name="options" style="color:#666;border-bottom:none;" ;="">åˆ›å»ºç³»ç»Ÿ VC æ¨¡ç‰ˆ :</a></p>
<p><img src="/images/01.png" alt=""></p>
<h3 id="ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰-Xcode-ç±»æ¨¡æ¿-ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰-Xcode-ç±»æ¨¡æ¿-ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ Xcode ç±»æ¨¡æ¿ ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ Xcode ç±»æ¨¡æ¿ ï¼Ÿ</h3><p>å½“æˆ‘ä»¬ç”¨ Xcode è‡ªå¸¦çš„æ¨¡æ¿åˆ›å»ºä¸€ä¸ª UIViewController çš„å­ç±»æ—¶ï¼Œæˆ‘ä»¬ä¼šå‘ç° <code>.m</code> æ–‡ä»¶ä¼šå¤šå‡ºä¸€äº›æ–¹æ³• :</p>
<p><img src="/images/02.png" alt=""></p>
<p>è€Œæˆ‘ä»¬å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œæˆ–å¤šæˆ–å°‘éƒ½æœ‰è‡ªå·±çš„ä¸€äº›è§„èŒƒï¼Œå°¤å…¶æ˜¯åœ¨å¤šäººåˆä½œå¼€å‘çš„æƒ…å†µä¸‹ï¼Œä¸€äº›å¥½çš„å¼€å‘è§„èŒƒæ˜¯ç›¸å½“å¿…è¦çš„ã€‚</p>
<p><a name="æˆ‘çš„VCæ¨¡ç‰ˆ" style="color:#666;border-bottom:none;">æˆ‘çš„ UIViewController è§„èŒƒ</a> :</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"MyViewController.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyViewController</span> ()</span></div><div class="line"><span class="comment">// &lt;UITableViewDelegate,UITableViewDataSource&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyViewController</span></span></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - LifeCyle</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">[<span class="keyword">super</span> viewDidLoad];</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">- (void)viewWillAppear:(BOOL)animated &#123;</div><div class="line">[super viewWillAppear:animated];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)viewDidAppear:(BOOL)animated &#123;</div><div class="line">[super viewDidAppear:animated];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)viewWillDisappear:(BOOL)animated &#123;</div><div class="line">[super viewWillDisappear:animated];</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)viewDidDisappear:(BOOL)animated &#123;</div><div class="line">[super viewDidDisappear:animated];</div><div class="line">&#125;</div><div class="line">**/</div><div class="line">- (<span class="keyword">void</span>)dealloc &#123;</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@-é‡Šæ”¾äº†"</span>,<span class="keyword">self</span>.class);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - Intial Methods</span></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - Target Methods</span></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - Private Method</span></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - Setter Getter Methods</span></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - External Delegate</span></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - UITableViewDelegate,UITableViewDataSource</span></div><div class="line"><span class="comment">/*</span></div><div class="line">- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView &#123;</div><div class="line">return &lt;#section#&gt;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section &#123;</div><div class="line">return &lt;#row#&gt;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</div><div class="line">return &lt;# UITableViewCell #&gt;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</div><div class="line">return &lt;#height#&gt;;</div><div class="line">&#125;</div><div class="line">**/</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>è¿™ä¹ˆä¸€å †ä¸œè¥¿å†™èµ·æ¥ä¹Ÿæ˜¯è¦ç‚¹æ—¶é—´çš„ï¼Œå¦‚æœæ¯åˆ›å»ºä¸ª VC å°±è¦å†™ä¸€éä¹Ÿå¤ªä¸ä¼˜é›…äº†ã€‚</p>
<p><strong>æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•èƒ½å¤Ÿåœ¨æˆ‘ä»¬åˆ›å»º VC çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆè¿™äº›å‘¢ï¼Ÿ</strong></p>
<h3 id="åˆ›å»ºè‡ªå·±çš„-Xcode-ç±»æ¨¡æ¿"><a href="#åˆ›å»ºè‡ªå·±çš„-Xcode-ç±»æ¨¡æ¿" class="headerlink" title="åˆ›å»ºè‡ªå·±çš„ Xcode ç±»æ¨¡æ¿"></a>åˆ›å»ºè‡ªå·±çš„ Xcode ç±»æ¨¡æ¿</h3><p>ä¸€ä»½æˆå“æ¨¡ç‰ˆç»“æ„å¤§æ¦‚è¿™æ · :</p>
<p><img src="/images/03.png" alt=""></p>
<p>ä»‹ç»ä¸‹é‡Œé¢çš„ä¸œè¥¿ (<code>xxx</code> å°±æ˜¯ä½ è‡ªå®šä¹‰æ¨¡ç‰ˆçš„åå­—) :</p>
<blockquote>
<p><strong>xxx.xctemplateï¼š</strong>æ¨¡ç‰ˆæ–‡ä»¶ã€‚</p>
<p><strong>xxxObjective-Cï¼š</strong>OC æ¨¡ç‰ˆæ–‡ä»¶ï¼Œé‡Œé¢åŒ…å« <code>___FILEBASENAME___.h</code> å’Œ <code>___FILEBASENAME___.m</code> ä¸¤ä¸ªæ–‡ä»¶ã€‚</p>
<p><strong>xxxXIBObjective-Cï¼š</strong>æ¯” <code>xxxObjective-C</code> å¤šäº†ä¸ª <code>___FILEBASENAME___.xib</code> æ–‡ä»¶ï¼Œå¯è‡ªå®šä¹‰ã€‚</p>
<p><strong>xxxSwiftï¼š</strong>Swiftæ¨¡ç‰ˆæ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«ä¸€ä¸ª <code>___FILEBASENAME___.swift</code> æ–‡ä»¶ã€‚</p>
<p><strong>xxxXIBSwiftï¼š</strong>æ¯” <code>xxxSwift</code> å¤šäº†ä¸ª <code>___FILEBASENAME___.xib</code> æ–‡ä»¶ï¼Œå¯è‡ªå®šä¹‰ã€‚</p>
<p><strong>TemplateIcon.pngï¼š</strong>æ¨¡ç‰ˆæ˜¾ç¤ºçš„å›¾ç‰‡ã€‚</p>
<p><strong>TemplateInfo.plistï¼š</strong>æ¨¡ç‰ˆçš„é…ç½®ä¿¡æ¯ï¼Œ<strong><a href="#TemplateInfo.plist">ä»‹ç»</a></strong>ã€‚</p>
</blockquote>
<p>é‡æ–°å†™ä¸€ä»½æ¨¡ç‰ˆå¤ªç¹çï¼Œæˆ‘ä»¬<strong>ç›´æ¥æ‹·è´ä¸€ä»½ç³»ç»Ÿçš„æ¨¡ç‰ˆæ¥ä¿®æ”¹</strong> ï¼š</p>
<ul>
<li>æ‹·è´ <code>Cocoa Class.xctemplate</code>ï¼Œä¿®æ”¹åç§°å¹¶åˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶ã€‚ï¼ˆæˆ‘è¿™è¾¹æ˜¯  <code>Xcode 8.2.1</code>, ä»¥åè·¯å¾„å¯èƒ½æœ‰å˜ï¼‰</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/Xcode/Templates/File Templates/Source</div></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹ <code>.h</code> ä¸º ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  ___FILENAME___</span></div><div class="line"><span class="comment">//  ___PROJECTNAME___</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  Created by ___FULLUSERNAME___ on ___DATE___.</span></div><div class="line"><span class="comment">//___COPYRIGHT___</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line">___IMPORTHEADER_cocoaSubclass___</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">___FILEBASENAMEASIDENTIFIER___</span> : <span class="title">UIViewController</span></span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹ <code>.m</code> åªéœ€è¦æ·»åŠ è‡ªå·±éœ€è¦çš„è§„èŒƒå°±è¡Œï¼Œå¯ä»¥å‚è€ƒ <strong><a href="#æˆ‘çš„VCæ¨¡ç‰ˆ">æˆ‘çš„VCæ¨¡ç‰ˆ</a></strong>ã€‚</li>
<li><p>ä¿®æ”¹ <code>.swift</code> ä¸º: </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//  ___FILENAME___</span></div><div class="line"> <span class="comment">//  ___PROJECTNAME___</span></div><div class="line"> <span class="comment">//</span></div><div class="line"> <span class="comment">//  Created by ___FULLUSERNAME___ on ___DATE___.</span></div><div class="line"> <span class="comment">//___COPYRIGHT___</span></div><div class="line"> <span class="comment">//</span></div><div class="line"> </div><div class="line"></div><div class="line">import <span class="built_in">UIKit</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> ___FILEBASENAMEASIDENTIFIER___: <span class="built_in">UIViewController</span> &#123;</div><div class="line"></div><div class="line"><span class="comment">//MARK: - LifeCyle</span></div><div class="line"></div><div class="line">override func viewDidLoad() &#123;</div><div class="line"><span class="keyword">super</span>.viewDidLoad()</div><div class="line">&#125;</div><div class="line"></div><div class="line">deinit &#123;</div><div class="line">print(<span class="string">"\(object_getClassName(self)) - é‡Šæ”¾äº†!"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//MARK: - Intial Methods</span></div><div class="line"></div><div class="line"><span class="comment">//MARK: - Target Methods</span></div><div class="line"></div><div class="line"><span class="comment">//MARK: - Private Method</span></div><div class="line"></div><div class="line"><span class="comment">//MARK: - Setter Getter Methods</span></div><div class="line"></div><div class="line"><span class="comment">//MARK: - External Delegate</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>æ–°å»º <code>.xib</code> é‡å‘½å <code>___FILEBASENAME___.xib</code> å¹¶æŒ‰ç…§ä¸‹å›¾ä¿®æ”¹:</p>
</li>
</ul>
<p><img src="/images/04.png" alt=""></p>
<p><img src="/images/05.png" alt=""></p>
<p>ä¸Šé¢ <code>.h</code> <code>.m</code> é‡Œé¢ æœ‰äº›è¯å¯èƒ½ä¸æ˜ç™½ï¼Œè¿™é‡Œå†ç¨ç¨è§£é‡Šä¸‹ï¼š</p>
<blockquote>
<p>1ï¼‰<strong>DATEï¼š</strong>æ ‡è¯†å½“å‰æ—¶é—´ï¼›</p>
<p>2ï¼‰<strong>FILENAMEï¼š</strong>å¸¦æ–‡ä»¶åç¼€çš„å…¨åï¼›</p>
<p>3ï¼‰<strong>FILEBASENAMEï¼š</strong>ä¸å¸¦æ–‡ä»¶åç¼€çš„åå­—ï¼›</p>
<p>4ï¼‰<strong>FULLUSERNAMEï¼š</strong>å½“å‰çš„ç”¨æˆ·åï¼›</p>
<p>6ï¼‰<strong>PROJECTNAMEï¼š</strong>å·¥ç¨‹åå­—ï¼›</p>
<p>7ï¼‰<strong>FILEBASENAMEASIDENTIFIERï¼š</strong> VCç±»åç§°ï¼›</p>
<p>8ï¼‰<strong>IMPORTHEADER_cocoaSubclassï¼š</strong> å¯¼å…¥çš„å¤´æ–‡ä»¶ã€‚</p>
</blockquote>
<h4 id="TemplateInfo-plist"><a href="#TemplateInfo-plist" class="headerlink" title="TemplateInfo.plist"></a><a name="TemplateInfo.plist" style="color:#666;border-bottom:none;">TemplateInfo.plist</a></h4><p><img src="/images/06.png" alt=""></p>
<p>è®²è§£ä¸€äº›éœ€è¦æ”¹åŠ¨çš„ä¸œè¥¿ :</p>
<blockquote>
<p><strong>SortOrderï¼š</strong>æ¨¡ç‰ˆåœ¨ç•Œé¢ä¸­çš„ä½ç½®ï¼›</p>
<p><strong>Optionsï¼š</strong>å¯¹åº” <strong><a href="#options">å›¾ä¸­</a></strong> å››è¡Œï¼›</p>
<p><strong>FallbackHeaderï¼š</strong><code>.h</code> å¯¼å…¥çš„å¤´æ–‡ä»¶ï¼›</p>
<p><strong>RequiredOptions -&gt; cocoaSubclassï¼š</strong>æ˜¯å¦æ”¯æŒé€‰æ‹© xibï¼›<code>Default</code> é»˜è®¤ <code>true</code> è‡ªåŠ¨å‹¾é€‰ï¼›</p>
<p><strong>Valuesï¼š</strong>è‡ªå®šä¹‰æ¨¡ç‰ˆçš„åç§°(ä¸€å®šè¦ä¿æŒä¸€è‡´);</p>
<p><strong>Suffixesï¼š</strong>æ¨¡ç‰ˆé»˜è®¤ç±»åï¼Œæ•ˆæœå¦‚ä¸‹å›¾ã€‚</p>
</blockquote>
<p><img src="/images/07.gif" alt=""></p>
<p>æœ€åæŠŠåˆ›å»ºå¥½çš„ <code>xxx.xctemplate</code> æ–‡ä»¶ç›´æ¥æ‹·è´åˆ°ç³»ç»Ÿè·¯å¾„ä¸‹å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/Xcode/Templates/File Templates/Source</div></pre></td></tr></table></figure>
<h3 id="ä¿®æ”¹ç³»ç»Ÿæ¨¡æ¿"><a href="#ä¿®æ”¹ç³»ç»Ÿæ¨¡æ¿" class="headerlink" title="ä¿®æ”¹ç³»ç»Ÿæ¨¡æ¿"></a>ä¿®æ”¹ç³»ç»Ÿæ¨¡æ¿</h3><p>å¹³å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨<code>xib</code>æ¥ç”»ä¸€ä¸ª<code>View</code>ï¼Œä¹‹å‰ç”¨ç³»ç»Ÿçš„æ¨¡æ¿åˆ›å»º<code>View</code>çš„æ—¶å€™æ˜¯æœ‰å‹¾é€‰æ˜¯å¦åˆ›å»ºå¯¹åº”<code>xib</code>çš„è¿™ä¸ªé€‰é¡¹çš„ï¼Œè‹¹æœä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™æ”¹äº†ï¼Œç°åœ¨è²Œä¼¼ä¸è¡Œäº†ï¼š</p>
<p><img src="/images/08.png" alt=""></p>
<p>è¿™æ ·å¯¼è‡´æˆ‘ä»¬åˆ›å»ºå®Œ<code>View</code>åï¼Œè¿˜éœ€è¦å†åˆ›å»ºä¸ªå¯¹åº”çš„<code>xib</code>æ–‡ä»¶ï¼Œç®€ç›´ç¥çƒ¦ï¼<br>æ€ä¹ˆèƒ½è‡ªåŠ¨åˆ›å»º<code>xib</code>æ–‡ä»¶å‘¢ï¼Ÿæˆ‘ä»¬å®Œå…¨å¯ä»¥ä¿®æ”¹ç³»ç»Ÿçš„æ¨¡æ¿æ¥æ»¡è¶³æˆ‘ä»¬çš„åˆšéœ€ï¼š</p>
<ul>
<li><p>è¿›å…¥ç›®å½•ï¼Œæ‰¾åˆ°<code>Cocoa Touch Class.xctemplate</code>æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/Xcode/Templates/File Templates/Source</div></pre></td></tr></table></figure>
</li>
<li><p>æ‹·è´ä¸€ä»½ <code>UIViewObjective-C</code>æ–‡ä»¶å¹¶æ”¹åä¸º<code>UIViewXIBObjective-C</code>ï¼Œç„¶ååˆ°å…¶ä»–æœ‰<code>xib</code>çš„æ–‡ä»¶å¤¹é‡Œé¢ï¼Œæ‹·è´ä¸€ä»½<code>xib</code>åˆ°<code>UIViewXIBObjective-C</code>é‡Œé¢ï¼Œ<code>xib</code>å¯è‡ªè¡Œä¿®æ”¹ã€‚ï¼ˆæˆ‘è¿™é‡Œåªé…ç½®äº†<code>Objective-C</code>çš„ï¼Œ<code>Swift</code>æ­¥éª¤ç±»ä¼¼ï¼‰</p>
</li>
<li>æ‰¾åˆ° å½“å‰ç›®å½•çš„<code>TemplateInfo.plist</code>æ–‡ä»¶ï¼Œå¦‚ä¸‹ä¿®æ”¹ï¼š</li>
</ul>
<p><img src="/images/09.png" alt=""></p>
<ul>
<li>é‡æ–°åˆ›å»ºç³»ç»Ÿ <code>View</code>æ¨¡æ¿ï¼š</li>
</ul>
<p><img src="/images/10.png" alt=""></p>
<p>å¤§åŠŸå‘Šæˆï¼</p>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><p>æ”¾ä¸Šæˆ‘è‡ªå·±çš„ä¸€ä¸ª <strong><a href="https://github.com/ifelseboyxx/CustomXcodeTempate" target="_blank" rel="external">UIViewController æ¨¡æ¿</a></strong> æ‡’å¾—è‡ªå·±å†™çš„å¯ä»¥ç›´æ¥ç”¨æˆ–è€…åœ¨æˆ‘çš„æ¨¡æ¿åŸºç¡€ä¸Šä¿®æ”¹ï¼</p>
<h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><p><a href="http://www.jianshu.com/p/93527682d8d3" target="_blank" rel="external">http://www.jianshu.com/p/93527682d8d3</a></p>
<p><a href="http://www.bobmccune.com/2012/03/04/creating-custom-xcode-4-file-templates/" target="_blank" rel="external">http://www.bobmccune.com/2012/03/04/creating-custom-xcode-4-file-templates/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¯ä¸å¤šè¯´æˆ‘ä»¬å…ˆæ¥ä½“éªŒä¸‹ :&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/VC.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;ä»€ä¹ˆæ˜¯-Xcode-ç±»æ¨¡æ¿-ï¼Ÿ&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯-Xcode-ç±»æ¨¡æ¿-ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;
    
    </summary>
    
    
      <category term="ObjC" scheme="http://yoursite.com/tags/ObjC/"/>
    
  </entry>
  
</feed>
